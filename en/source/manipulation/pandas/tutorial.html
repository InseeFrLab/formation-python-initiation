<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with tabular data using Pandas – SSPy training course </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Data handling</a></li><li class="breadcrumb-item"><a href="../../../source/manipulation/pandas/tutorial.html">Processing tabular data with Pandas</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">SSPy training course <i class="fa-brands fa-python" aria-label="python"></i></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/types-variables/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic types and variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/data-structures1/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data structures 1: lists and tuples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/data-structures2/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data structures 2: dictionaries and sets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/tests/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tests and conditions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/loops/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/functions/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/oop/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to object-oriented programming</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data handling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/modules-files/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">File manipulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/csv-json-files/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with CSV and JSON files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/numpy/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numerical computation with NumPy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/pandas/tutorial.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Processing tabular data with Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/dataviz/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to data visualization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/puissance4/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 1 - Connect 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/meteo/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 2 - API interaction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/RP/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 3 - Population census analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-structures" id="toc-data-structures" class="nav-link active" data-scroll-target="#data-structures">Data structures</a>
  <ul class="collapse">
  <li><a href="#the-series" id="toc-the-series" class="nav-link" data-scroll-target="#the-series">The <code>Series</code></a></li>
  <li><a href="#the-dataframe" id="toc-the-dataframe" class="nav-link" data-scroll-target="#the-dataframe">The <code>DataFrame</code></a></li>
  </ul></li>
  <li><a href="#selecting-data" id="toc-selecting-data" class="nav-link" data-scroll-target="#selecting-data">Selecting data</a>
  <ul class="collapse">
  <li><a href="#selecting-columns" id="toc-selecting-columns" class="nav-link" data-scroll-target="#selecting-columns">Selecting columns</a></li>
  <li><a href="#selecting-rows" id="toc-selecting-rows" class="nav-link" data-scroll-target="#selecting-rows">Selecting rows</a></li>
  </ul></li>
  <li><a href="#exploring-tabular-data" id="toc-exploring-tabular-data" class="nav-link" data-scroll-target="#exploring-tabular-data">Exploring tabular data</a>
  <ul class="collapse">
  <li><a href="#importing-and-exporting-data" id="toc-importing-and-exporting-data" class="nav-link" data-scroll-target="#importing-and-exporting-data">Importing and exporting data</a></li>
  <li><a href="#viewing-a-sample-of-data" id="toc-viewing-a-sample-of-data" class="nav-link" data-scroll-target="#viewing-a-sample-of-data">Viewing a sample of data</a></li>
  <li><a href="#getting-an-overview-of-the-data" id="toc-getting-an-overview-of-the-data" class="nav-link" data-scroll-target="#getting-an-overview-of-the-data">Getting an overview of the data</a></li>
  <li><a href="#calculating-descriptive-statistics" id="toc-calculating-descriptive-statistics" class="nav-link" data-scroll-target="#calculating-descriptive-statistics">Calculating descriptive statistics</a></li>
  </ul></li>
  <li><a href="#main-data-manipulations" id="toc-main-data-manipulations" class="nav-link" data-scroll-target="#main-data-manipulations">Main data manipulations</a>
  <ul class="collapse">
  <li><a href="#transforming-data" id="toc-transforming-data" class="nav-link" data-scroll-target="#transforming-data">Transforming data</a></li>
  <li><a href="#sorting-values" id="toc-sorting-values" class="nav-link" data-scroll-target="#sorting-values">Sorting values</a></li>
  <li><a href="#aggregating-data" id="toc-aggregating-data" class="nav-link" data-scroll-target="#aggregating-data">Aggregating data</a></li>
  <li><a href="#handling-missing-values" id="toc-handling-missing-values" class="nav-link" data-scroll-target="#handling-missing-values">Handling missing values</a></li>
  <li><a href="#handling-data-of-specific-types" id="toc-handling-data-of-specific-types" class="nav-link" data-scroll-target="#handling-data-of-specific-types">Handling data of specific types</a></li>
  <li><a href="#joining-tables" id="toc-joining-tables" class="nav-link" data-scroll-target="#joining-tables">Joining tables</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#comprehension-questions" id="toc-comprehension-questions" class="nav-link" data-scroll-target="#comprehension-questions">Comprehension questions</a></li>
  <li><a href="#multiple-ways-to-create-a-dataframe" id="toc-multiple-ways-to-create-a-dataframe" class="nav-link" data-scroll-target="#multiple-ways-to-create-a-dataframe">Multiple ways to create a DataFrame</a></li>
  <li><a href="#data-selection-in-a-dataframe" id="toc-data-selection-in-a-dataframe" class="nav-link" data-scroll-target="#data-selection-in-a-dataframe">Data selection in a DataFrame</a></li>
  <li><a href="#exploring-the-first-names-file" id="toc-exploring-the-first-names-file" class="nav-link" data-scroll-target="#exploring-the-first-names-file">Exploring the first names file</a></li>
  <li><a href="#calculation-of-a-carbon-footprint-per-inhabitant-at-the-municipal-level" id="toc-calculation-of-a-carbon-footprint-per-inhabitant-at-the-municipal-level" class="nav-link" data-scroll-target="#calculation-of-a-carbon-footprint-per-inhabitant-at-the-municipal-level">Calculation of a carbon footprint per inhabitant at the municipal level</a></li>
  <li><a href="#analysis-of-the-evolution-of-a-production-index" id="toc-analysis-of-the-evolution-of-a-production-index" class="nav-link" data-scroll-target="#analysis-of-the-evolution-of-a-production-index">Analysis of the evolution of a production index</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Data handling</a></li><li class="breadcrumb-item"><a href="../../../source/manipulation/pandas/tutorial.html">Processing tabular data with Pandas</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Working with tabular data using Pandas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Statistical analysis is generally based on <strong>tabular data</strong>, where each row represents an observation and each column a variable. To handle this type of data and easily apply standard data analysis methods, dedicated objects have been designed: <code>DataFrames</code>. Users of <code>R</code> are well acquainted with this data structure, which is native to this statistics-oriented language. In <code>Python</code>, a general-purpose language, this object does not exist natively. Fortunately, a very comprehensive and convenient library, designed as an overlay to <code>NumPy</code>, introduces the <code>DataFrame</code> object in <code>Python</code> and allows for simple and intuitive data manipulation and analysis: <code>Pandas</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pandas is the central element of the data science ecosystem in Python, offering virtually infinite data processing capabilities. Moreover, there are generally multiple ways to perform the same operation in Pandas. Consequently, this chapter is particularly long and dense with new features. The goal is not to memorize all the methods presented throughout this chapter, but rather to have a general overview of what is possible in order to use the right tools in projects. In particular, the end-of-chapter exercises and the mini-projects at the end of the course will provide an opportunity to apply this new knowledge to concrete problems.</p>
</div>
</div>
<p>Let’s start by importing the <code>Pandas</code> library. The common usage is to give it the alias <code>pd</code> to simplify future calls to the package’s objects and functions. We also import <code>NumPy</code> as we will compare the fundamental objects of the two packages.</p>
<div id="6a0bd46d" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-structures" class="level2">
<h2 class="anchored" data-anchor-id="data-structures">Data structures</h2>
<p>To fully understand how <code>Pandas</code> works, it is important to focus on its fundamental objects. We will therefore first study the <code>Series</code>, whose concatenation allows us to build a <code>DataFrame</code>.</p>
<section id="the-series" class="level3">
<h3 class="anchored" data-anchor-id="the-series">The <code>Series</code></h3>
<p>A Series is a one-dimensional data container that can hold any type of data (integers, strings, Python objects…). However, a Series is of a given type: a Series containing only integers will be of type <code>int</code>, and a Series containing objects of different natures will be of type <code>object</code>. Let’s build our first Series from a list to check this behavior.</p>
<div id="36242bed" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> [<span class="dv">1</span>, <span class="st">"X"</span>, <span class="dv">3</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series(l)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1
1    X
2    3
dtype: object</code></pre>
</div>
</div>
<p>In particular, we can access the data of a Series by position, as for a list or an array.</p>
<div id="de756784" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X</code></pre>
</div>
</div>
<p>At first glance, we do not see much difference between a Series and a one-dimensional <code>NumPy</code> array. However, there is a significant difference: the presence of an index. The observations have an associated label. When we create a Series without specifying anything, the index is automatically set to the integers from 0 to n-1 (with n being the number of elements in the Series). But it is possible to pass a specific index (e.g., dates, town names, etc.).</p>
<div id="3b262e06" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series(l, index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a    1
b    X
c    3
dtype: object</code></pre>
</div>
</div>
<p>This allows us to access the data by label:</p>
<div id="33087ff5" class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>s[<span class="st">"b"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>'X'</code></pre>
</div>
</div>
<p>This difference may seem minor at first, but it becomes essential for constructing the DataFrame. For the rest, Series behave very similarly to NumPy arrays: calculations are vectorized, we can directly sum two Series, etc. Moreover, we can easily convert a Series into an array via the <code>values</code> attribute. This naturally loses the index…</p>
<div id="b9cfc757" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series(l, index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>s.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>array([1, 'X', 3], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="the-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="the-dataframe">The <code>DataFrame</code></h3>
<p>Fundamentally, a DataFrame consists of a collection of Series, aligned by their indexes. This concatenation thus constructs a data table, with Series corresponding to columns, and the index identifying the rows. The following figure (<a href="https://www.geeksforgeeks.org/creating-a-pandas-dataframe/">source</a>) helps to understand this data structure.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/structure_df.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="800"></p>
</figure>
</div>
<p>A DataFrame can be constructed in multiple ways. In practice, we generally build a DataFrame directly from tabular data files (e.g., CSV, Excel), rarely by hand. So, we will only illustrate the most common manual construction method: from a data dictionary.</p>
<div id="8cf566bf" class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>, <span class="st">"2022-01-05"</span>, <span class="st">"2022-01-06"</span>],</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: <span class="st">"sample1"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
<td>2022-01-01</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
<td>2022-01-02</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>2022-01-03</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>-3</td>
<td>train</td>
<td>2022-01-04</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
<td>2022-01-05</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
<td>2022-01-06</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A Pandas DataFrame has a set of useful attributes that we will discover throughout this tutorial. For now, let’s focus on the most basic ones: the index and the column names. By default, the index is initialized, as for Series, to the list of positions of the observations. We could have specified an alternative index when constructing the DataFrame by specifying the <code>index</code> argument of the <code>pd.DataFrame</code> function.</p>
<div id="6d5d5d2c" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>RangeIndex(start=0, stop=6, step=1)</code></pre>
</div>
</div>
<div id="80c87071" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>Index(['var1', 'var2', 'experiment', 'date', 'sample'], dtype='object')</code></pre>
</div>
</div>
<p>Often, rather than specifying an index manually during the construction of the DataFrame, we will want to use a certain column of the DataFrame as an index. We use the <code>set_index</code> method associated with DataFrames for this.</p>
<div id="9ee9a134" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">"date"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-01</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-02</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-03</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-04</td>
<td>NaN</td>
<td>-3</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-05</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-06</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The index attribute has naturally changed:</p>
<div id="4971eb2d" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">
<pre><code>Index(['2022-01-01', '2022-01-02', '2022-01-03', '2022-01-04', '2022-01-05',
       '2022-01-06'],
      dtype='object', name='date')</code></pre>
</div>
</div>
</section>
</section>
<section id="selecting-data" class="level2">
<h2 class="anchored" data-anchor-id="selecting-data">Selecting data</h2>
<p>When manipulating tabular data, it is common to want to extract specific columns from a <code>DataFrame</code>. This extraction is simple with <code>Pandas</code> using square brackets.</p>
<section id="selecting-columns" class="level3">
<h3 class="anchored" data-anchor-id="selecting-columns">Selecting columns</h3>
<section id="selecting-a-single-column" class="level4">
<h4 class="anchored" data-anchor-id="selecting-a-single-column">Selecting a single column</h4>
<p>To extract a single column, we can use the following syntax:</p>
<div id="31adecc5" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>selected_column <span class="op">=</span> df[<span class="st">"var1"</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>selected_column</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<pre><code>date
2022-01-01    1.3
2022-01-02    5.6
2022-01-03    NaN
2022-01-04    NaN
2022-01-05    0.0
2022-01-06    NaN
Name: var1, dtype: float64</code></pre>
</div>
</div>
<p>The <code>selected_column</code> object here returns the column named <code>var1</code> from the <code>DataFrame</code> <code>df</code>. But what type is this object? To answer this question, we use the <code>type()</code> function:</p>
<div id="7451a621" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(selected_column)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<pre><code>pandas.core.series.Series</code></pre>
</div>
</div>
<p>As we can see, the result is a <code>Series</code>, which is a one-dimensional object in <code>Pandas</code>.</p>
<p>Another useful attribute to know is <code>shape</code>. It allows us to know the dimension of the object. For a <code>Series</code>, <code>shape</code> will return a tuple whose first element indicates the number of rows.</p>
<div id="18c81dc1" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>selected_column.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<pre><code>(6,)</code></pre>
</div>
</div>
</section>
<section id="selecting-multiple-columns" class="level4">
<h4 class="anchored" data-anchor-id="selecting-multiple-columns">Selecting multiple columns</h4>
<p>To extract multiple columns, just pass a list of the desired column names:</p>
<div id="a5d5d3da" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> df[[<span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"experiment"</span>]]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>selected_columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-01</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-02</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-03</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-04</td>
<td>NaN</td>
<td>-3</td>
<td>train</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-05</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-06</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This snippet shows the columns <code>var1</code>, <code>var2</code>, and <code>experiment</code> from the <code>DataFrame</code> <code>df</code>. Let’s now check its type:</p>
<div id="737d8eb3" class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(selected_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="153">
<pre><code>pandas.core.frame.DataFrame</code></pre>
</div>
</div>
<p>The result is a <code>DataFrame</code> because it is a two-dimensional object. We can also check its shape with the <code>shape</code> attribute. In this case, the tuple returned by <code>shape</code> will contain two elements: the number of rows and the number of columns.</p>
<div id="1d92182f" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>selected_columns.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="154">
<pre><code>(6, 3)</code></pre>
</div>
</div>
</section>
</section>
<section id="selecting-rows" class="level3">
<h3 class="anchored" data-anchor-id="selecting-rows">Selecting rows</h3>
<section id="using-loc-and-iloc" class="level4">
<h4 class="anchored" data-anchor-id="using-loc-and-iloc">Using <code>loc</code> and <code>iloc</code></h4>
<p>When we want to select specific rows in a DataFrame, we can use two main methods: <code>loc</code> and <code>iloc</code>.</p>
<ul>
<li><code>iloc</code> allows selecting rows and columns by their position, i.e., by numeric indices.</li>
</ul>
<p>Example, selecting the first 3 rows:</p>
<div id="e4315192" class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">0</span>:<span class="dv">3</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-01</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-02</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-03</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li><code>loc</code> works with labels. If the DataFrame’s indexes are numbers, they resemble positions, but this is not necessarily the case. It is crucial to note that, unlike <code>iloc</code>, with <code>loc</code>, the end index is included in the selection.</li>
</ul>
<div id="511df3b5" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">"2022-01-01"</span>:<span class="st">"2022-01-03"</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-01</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-02</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-03</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="filtering-data-based-on-conditions" class="level4">
<h4 class="anchored" data-anchor-id="filtering-data-based-on-conditions">Filtering data based on conditions</h4>
<p>In practice, rather than selecting rows based on positions or labels, we often want to filter a DataFrame based on certain conditions. In this case, we primarily use boolean filters.</p>
<ul>
<li><strong>Inequalities</strong>: We might want to keep only the rows that meet a certain condition.</li>
</ul>
<p>Example, filtering rows where the value of the <code>var2</code> column is greater than 0:</p>
<div id="65a29d1d" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'var2'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="157">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-01</td>
<td>1.3</td>
<td>4</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-06</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li><strong>Membership with <code>isin</code></strong>: If we want to filter data based on a list of possible values, the <code>isin</code> method is very useful.</li>
</ul>
<p>Example, to keep only the rows where the <code>experiment</code> column has values ‘test’ or ‘validation’:</p>
<div id="c4610a92" class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'experiment'</span>].isin([<span class="st">'train'</span>, <span class="st">'validation'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="158">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-02</td>
<td>5.6</td>
<td>-6</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-04</td>
<td>NaN</td>
<td>-3</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-05</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-01-06</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These methods can be combined to create more complex conditions. It is also possible to use logical operators (<code>&amp;</code> for “and”, <code>|</code> for “or”) to combine multiple conditions. Be careful to enclose each condition in parentheses when combining them.</p>
<p>Example, selecting rows where <code>var2</code> is greater than 0 and <code>experiment</code> is equal to ‘test’ or ‘validation’:</p>
<div id="cc762225" class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df[(df[<span class="st">'var2'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'experiment'</span>].isin([<span class="st">'train'</span>, <span class="st">'validation'</span>]))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="159">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-01-06</td>
<td>NaN</td>
<td>5</td>
<td>validation</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="exploring-tabular-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-tabular-data">Exploring tabular data</h2>
<p>In public statistics, the starting point is generally not the manual generation of data but rather pre-existing tab</p>
<p>ular files. These files, whether from surveys, administrative databases, or other sources, constitute the raw material for any subsequent analysis. Pandas offers powerful tools to import these tabular files and explore them for further manipulations.</p>
<section id="importing-and-exporting-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-and-exporting-data">Importing and exporting data</h3>
<section id="importing-a-csv-file" class="level4">
<h4 class="anchored" data-anchor-id="importing-a-csv-file">Importing a CSV file</h4>
<p>As we saw in a previous lab, the CSV format is one of the most common formats for storing tabular data. We previously used the <code>csv</code> library to handle them as text files, but it was not very convenient. To recall, the syntax for reading a CSV file and displaying the first lines was as follows:</p>
<div id="0bfbdccd" class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data/departement2021.csv"</span>) <span class="im">as</span> file_in:</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.reader(file_in)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        rows.append(row)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>rows[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="160">
<pre><code>[['DEP', 'REG', 'CHEFLIEU', 'TNCC', 'NCC', 'NCCENR', 'LIBELLE'],
 ['01', '84', '01053', '5', 'AIN', 'Ain', 'Ain'],
 ['02', '32', '02408', '5', 'AISNE', 'Aisne', 'Aisne'],
 ['03', '84', '03190', '5', 'ALLIER', 'Allier', 'Allier'],
 ['04',
  '93',
  '04070',
  '4',
  'ALPES DE HAUTE PROVENCE',
  'Alpes-de-Haute-Provence',
  'Alpes-de-Haute-Provence']]</code></pre>
</div>
</div>
<p>With Pandas, just use the <code>read_csv()</code> function to import the file as a DataFrame, then the <code>head()</code> function.</p>
<div id="b0b02dc0" class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_departements <span class="op">=</span> pd.read_csv(<span class="st">'data/departement2021.csv'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_departements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="161">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>84</td>
<td>01053</td>
<td>5</td>
<td>AIN</td>
<td>Ain</td>
<td>Ain</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>02</td>
<td>32</td>
<td>02408</td>
<td>5</td>
<td>AISNE</td>
<td>Aisne</td>
<td>Aisne</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>03</td>
<td>84</td>
<td>03190</td>
<td>5</td>
<td>ALLIER</td>
<td>Allier</td>
<td>Allier</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>04</td>
<td>93</td>
<td>04070</td>
<td>4</td>
<td>ALPES DE HAUTE PROVENCE</td>
<td>Alpes-de-Haute-Provence</td>
<td>Alpes-de-Haute-Provence</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>05</td>
<td>93</td>
<td>05061</td>
<td>4</td>
<td>HAUTES ALPES</td>
<td>Hautes-Alpes</td>
<td>Hautes-Alpes</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It is also possible to import a CSV file directly from a URL. This is particularly convenient when the data is regularly updated on a website, and we want to access the latest version without manually downloading the file each time. Let’s take the example of a CSV file available on the INSEE website: the file of given names, from civil status data. We also note another handy feature: the CSV file is compressed (in <code>zip</code> format), but Pandas can recognize and decompress it before importing.</p>
<div id="b131ad80" class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing a CSV file from a URL</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.insee.fr/fr/statistiques/fichier/2540004/nat2021_csv.zip"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df_prenoms_url <span class="op">=</span> pd.read_csv(url, sep<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>df_prenoms_url.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="162">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sexe</th>
<th data-quarto-table-cell-role="th">preusuel</th>
<th data-quarto-table-cell-role="th">annais</th>
<th data-quarto-table-cell-role="th">nombre</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>_PRENOMS_RARES</td>
<td>1900</td>
<td>1249</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>_PRENOMS_RARES</td>
<td>1901</td>
<td>1342</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>_PRENOMS_RARES</td>
<td>1902</td>
<td>1330</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>_PRENOMS_RARES</td>
<td>1903</td>
<td>1286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>_PRENOMS_RARES</td>
<td>1904</td>
<td>1430</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>When working with CSV files, there are many optional arguments available in the <code>read_csv()</code> function that allow us to adjust the import process according to the specifics of the file. These arguments can, for example, define a specific delimiter (as above for the given names file), skip certain lines at the beginning of the file, or define data types for each column, and many others. All these parameters and their usage are detailed in the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">official documentation</a>.</p>
</section>
<section id="exporting-to-csv-format" class="level4">
<h4 class="anchored" data-anchor-id="exporting-to-csv-format">Exporting to CSV format</h4>
<p>Once the data has been processed and modified within Pandas, it is common to want to export the result as a CSV file for sharing, archiving, or use in other tools. Pandas offers a simple method for this operation: <code>to_csv()</code>. Suppose we want to export the data from the <code>df_departements</code> DataFrame specific to the five overseas departments.</p>
<div id="9cbdce44" class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_departements_dom <span class="op">=</span> df_departements[df_departements[<span class="st">"DEP"</span>].isin([<span class="st">"971"</span>, <span class="st">"972"</span>, <span class="st">"973"</span>, <span class="st">"974"</span>, <span class="st">"975"</span>])]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df_departements_dom.to_csv(<span class="st">'output/departements2021_dom.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One of the key arguments of the <code>to_csv()</code> method is <code>index</code>. By default, <code>index=True</code>, which means that the DataFrame’s index will also be written in the CSV file. We can verify this by printing the first lines of our CSV file: Pandas has added an unnamed column, which contains the index of the retained rows.</p>
<div id="ce5cc719" class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"output/departements2021_dom.csv"</span>) <span class="im">as</span> file_in:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> <span class="bu">next</span>(file_in).strip()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>,DEP,REG,CHEFLIEU,TNCC,NCC,NCCENR,LIBELLE
96,971,1,97105,3,GUADELOUPE,Guadeloupe,Guadeloupe
97,972,2,97209,3,MARTINIQUE,Martinique,Martinique
98,973,3,97302,3,GUYANE,Guyane,Guyane
99,974,4,97411,0,LA REUNION,La Réunion,La Réunion</code></pre>
</div>
</div>
<p>In some cases, notably when the index does not provide useful information or is simply automatically generated by Pandas, we might want to exclude it from the exported file. To do this, we can set <code>index=False</code>.</p>
<div id="c5b2baa6" class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_departements_dom.to_csv(<span class="st">'output/departements2021_dom_noindex.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-a-parquet-file" class="level4">
<h4 class="anchored" data-anchor-id="importing-a-parquet-file">Importing a Parquet file</h4>
<p>The Parquet format is another format for storing tabular data, increasingly used. Without going into technical details, the Parquet format has various characteristics that make it a preferred choice for storing and processing large volumes of data. Due to these advantages, this format is increasingly used for data dissemination at INSEE. It is therefore essential to know how to import and query Parquet files with Pandas.</p>
<p>Importing a Parquet file into a Pandas DataFrame is as easy as for a CSV file. The function is called <code>read_parquet()</code>.</p>
<div id="1b00bfe9" class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_departements <span class="op">=</span> pd.read_parquet(<span class="st">'data/departement2021.parquet'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_departements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="166">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>84</td>
<td>01053</td>
<td>5</td>
<td>AIN</td>
<td>Ain</td>
<td>Ain</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>02</td>
<td>32</td>
<td>02408</td>
<td>5</td>
<td>AISNE</td>
<td>Aisne</td>
<td>Aisne</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>03</td>
<td>84</td>
<td>03190</td>
<td>5</td>
<td>ALLIER</td>
<td>Allier</td>
<td>Allier</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>04</td>
<td>93</td>
<td>04070</td>
<td>4</td>
<td>ALPES DE HAUTE PROVENCE</td>
<td>Alpes-de-Haute-Provence</td>
<td>Alpes-de-Haute-Provence</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>05</td>
<td>93</td>
<td>05061</td>
<td>4</td>
<td>HAUTES ALPES</td>
<td>Hautes-Alpes</td>
<td>Hautes-Alpes</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="exporting-to-parquet-format" class="level4">
<h4 class="anchored" data-anchor-id="exporting-to-parquet-format">Exporting to Parquet format</h4>
<p>Again, everything works as in the CSV world: we use the <code>to_parquet()</code> method to export a DataFrame to a Parquet file. Similarly, we can choose to export or not the index, using the <code>index</code> parameter (which defaults to <code>True</code>).</p>
<div id="99e4c6c9" class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_departements_dom <span class="op">=</span> df_departements[df_departements[<span class="st">"DEP"</span>].isin([<span class="st">"971"</span>, <span class="st">"972"</span>, <span class="st">"973"</span>, <span class="st">"974"</span>, <span class="st">"975"</span>])]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_departements_dom.to_parquet(<span class="st">'output/departements2021_dom.parquet'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One of the major strengths of the Parquet format, compared to text formats like CSV, is its ability to store metadata, i.e., data that helps better understand the data contained in the file. In particular, a Parquet file includes in its metadata the data schema (variable names, variable types, etc.), making it a very suitable format for data dissemination. Let’s verify this behavior by revisiting the DataFrame we defined earlier.</p>
<div id="a6abdb41" class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>, <span class="st">"2022-01-05"</span>, <span class="st">"2022-01-06"</span>],</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: <span class="st">"sample1"</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.assign(</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    experiment<span class="op">=</span>pd.Categorical(df[<span class="st">"experiment"</span>]),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    date<span class="op">=</span>pd.to_datetime(df[<span class="st">"date"</span>])</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This time, we use two specific data types, for categorical data (<code>category</code>) and for temporal data (<code>datetime</code>). We will see later in the tutorial how to use these types. For now, let’s simply note that Pandas stores these types in the data schema.</p>
<div id="41aea7ef" class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype         
---  ------      --------------  -----         
 0   var1        3 non-null      float64       
 1   var2        6 non-null      int64         
 2   experiment  6 non-null      category      
 3   date        6 non-null      datetime64[ns]
 4   sample      6 non-null      object        
dtypes: category(1), datetime64[ns](1), float64(1), int64(1), object(1)
memory usage: 458.0+ bytes</code></pre>
</div>
</div>
<p>Let’s now verify that exporting and re-importing this data in Parquet preserves the schema.</p>
<div id="63b6d88b" class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df.to_parquet(<span class="st">"output/df_test_schema.parquet"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df_test_schema_parquet <span class="op">=</span> pd.read_parquet(<span class="st">'output/df_test_schema.parquet'</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>df_test_schema_parquet.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype         
---  ------      --------------  -----         
 0   var1        3 non-null      float64       
 1   var2        6 non-null      int64         
 2   experiment  6 non-null      category      
 3   date        6 non-null      datetime64[ns]
 4   sample      6 non-null      object        
dtypes: category(1), datetime64[ns](1), float64(1), int64(1), object(1)
memory usage: 458.0+ bytes</code></pre>
</div>
</div>
<p>Conversely, a CSV file, which by definition only contains text, does not preserve this data. The variables for which we specified the type are imported as strings (type <code>object</code> in Pandas).</p>
<div id="9a3043ea" class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"output/df_test_schema.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_test_schema_csv <span class="op">=</span> pd.read_csv(<span class="st">'output/df_test_schema.csv'</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>df_test_schema_csv.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   var1        3 non-null      float64
 1   var2        6 non-null      int64  
 2   experiment  6 non-null      object 
 3   date        6 non-null      object 
 4   sample      6 non-null      object 
dtypes: float64(1), int64(1), object(3)
memory usage: 368.0+ bytes</code></pre>
</div>
</div>
</section>
</section>
<section id="viewing-a-sample-of-data" class="level3">
<h3 class="anchored" data-anchor-id="viewing-a-sample-of-data">Viewing a sample of data</h3>
<p>When working with large datasets, it is often useful to quickly view a sample of the data to get an idea of its structure, format, or even to detect potential problems. Pandas offers several methods for this.</p>
<p>The <code>head()</code> method displays the first rows of the DataFrame. By default, it returns the first 5 rows, but we can specify another number as an argument if necessary.</p>
<div id="8dd4c605" class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_departements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="172">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>84</td>
<td>01053</td>
<td>5</td>
<td>AIN</td>
<td>Ain</td>
<td>Ain</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>02</td>
<td>32</td>
<td>02408</td>
<td>5</td>
<td>AISNE</td>
<td>Aisne</td>
<td>Aisne</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>03</td>
<td>84</td>
<td>03190</td>
<td>5</td>
<td>ALLIER</td>
<td>Allier</td>
<td>Allier</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>04</td>
<td>93</td>
<td>04070</td>
<td>4</td>
<td>ALPES DE HAUTE PROVENCE</td>
<td>Alpes-de-Haute-Provence</td>
<td>Alpes-de-Haute-Provence</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>05</td>
<td>93</td>
<td>05061</td>
<td>4</td>
<td>HAUTES ALPES</td>
<td>Hautes-Alpes</td>
<td>Hautes-Alpes</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ad9623c9" class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_departements.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="173">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>84</td>
<td>01053</td>
<td>5</td>
<td>AIN</td>
<td>Ain</td>
<td>Ain</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>02</td>
<td>32</td>
<td>02408</td>
<td>5</td>
<td>AISNE</td>
<td>Aisne</td>
<td>Aisne</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>03</td>
<td>84</td>
<td>03190</td>
<td>5</td>
<td>ALLIER</td>
<td>Allier</td>
<td>Allier</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>04</td>
<td>93</td>
<td>04070</td>
<td>4</td>
<td>ALPES DE HAUTE PROVENCE</td>
<td>Alpes-de-Haute-Provence</td>
<td>Alpes-de-Haute-Provence</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>05</td>
<td>93</td>
<td>05061</td>
<td>4</td>
<td>HAUTES ALPES</td>
<td>Hautes-Alpes</td>
<td>Hautes-Alpes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>06</td>
<td>93</td>
<td>06088</td>
<td>4</td>
<td>ALPES MARITIMES</td>
<td>Alpes-Maritimes</td>
<td>Alpes-Maritimes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>07</td>
<td>84</td>
<td>07186</td>
<td>5</td>
<td>ARDECHE</td>
<td>Ardèche</td>
<td>Ardèche</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>08</td>
<td>44</td>
<td>08105</td>
<td>4</td>
<td>ARDENNES</td>
<td>Ardennes</td>
<td>Ardennes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>09</td>
<td>76</td>
<td>09122</td>
<td>5</td>
<td>ARIEGE</td>
<td>Ariège</td>
<td>Ariège</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>44</td>
<td>10387</td>
<td>5</td>
<td>AUBE</td>
<td>Aube</td>
<td>Aube</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Conversely, the <code>tail()</code> method gives a preview of the last rows of the DataFrame.</p>
<div id="5fa5721a" class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_departements.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="174">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>971</td>
<td>1</td>
<td>97105</td>
<td>3</td>
<td>GUADELOUPE</td>
<td>Guadeloupe</td>
<td>Guadeloupe</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>972</td>
<td>2</td>
<td>97209</td>
<td>3</td>
<td>MARTINIQUE</td>
<td>Martinique</td>
<td>Martinique</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>973</td>
<td>3</td>
<td>97302</td>
<td>3</td>
<td>GUYANE</td>
<td>Guyane</td>
<td>Guyane</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>974</td>
<td>4</td>
<td>97411</td>
<td>0</td>
<td>LA REUNION</td>
<td>La Réunion</td>
<td>La Réunion</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>976</td>
<td>6</td>
<td>97608</td>
<td>0</td>
<td>MAYOTTE</td>
<td>Mayotte</td>
<td>Mayotte</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Displaying the first or last rows may sometimes not be representative of the entire dataset, especially when the data is sorted. To minimize the risk of obtaining a biased overview of the data, we can use the <code>sample()</code> method, which selects a random sample of rows. By default, it returns a single row, but we can request a specific number of rows using the <code>n</code> argument.</p>
<div id="ad199544" class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_departements.sample(n<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="175">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEP</th>
<th data-quarto-table-cell-role="th">REG</th>
<th data-quarto-table-cell-role="th">CHEFLIEU</th>
<th data-quarto-table-cell-role="th">TNCC</th>
<th data-quarto-table-cell-role="th">NCC</th>
<th data-quarto-table-cell-role="th">NCCENR</th>
<th data-quarto-table-cell-role="th">LIBELLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>47</td>
<td>75</td>
<td>47001</td>
<td>2</td>
<td>LOT ET GARONNE</td>
<td>Lot-et-Garonne</td>
<td>Lot-et-Garonne</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>29</td>
<td>53</td>
<td>29232</td>
<td>2</td>
<td>FINISTERE</td>
<td>Finistère</td>
<td>Finistère</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>38</td>
<td>84</td>
<td>38185</td>
<td>5</td>
<td>ISERE</td>
<td>Isère</td>
<td>Isère</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>67</td>
<td>44</td>
<td>67482</td>
<td>2</td>
<td>BAS RHIN</td>
<td>Bas-Rhin</td>
<td>Bas-Rhin</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">94</td>
<td>94</td>
<td>11</td>
<td>94028</td>
<td>2</td>
<td>VAL DE MARNE</td>
<td>Val-de-Marne</td>
<td>Val-de-Marne</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="getting-an-overview-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-an-overview-of-the-data">Getting an overview of the data</h3>
<p>One of the first steps when exploring new data is to understand the general structure of the dataset. The <code>info()</code> method in Pandas provides a quick overview of the data, including data types, the presence of missing values, and memory usage.</p>
<div id="eb297748" class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 6 entries, 0 to 5
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype         
---  ------      --------------  -----         
 0   var1        3 non-null      float64       
 1   var2        6 non-null      int64         
 2   experiment  6 non-null      category      
 3   date        6 non-null      datetime64[ns]
 4   sample      6 non-null      object        
dtypes: category(1), datetime64[ns](1), float64(1), int64(1), object(1)
memory usage: 458.0+ bytes</code></pre>
</div>
</div>
<p>Several key pieces of information can be extracted from this result:</p>
<ul>
<li><p><strong>index</strong>: The DataFrame has a <code>RangeIndex</code>, which means the index is a simple numeric sequence. Here, the index ranges from 0 to 5, for a total of 6 entries.</p></li>
<li><p><strong>schema</strong>: The list of columns is displayed with very useful information about the data schema:</p>
<ul>
<li><p><strong>Non-Null Count</strong>: The number of <strong>non-missing</strong> (non-<code>nan</code>) values in the column. If this number is less than the total number of entries (in our case, 6), it means the column contains missing values. Note the possible ambiguity on “null”: this indeed means missing values, not values equal to 0. Thus, in our case, the number of “non-null” values for the <code>var1</code> variable is 5.</p></li>
<li><p><strong>Dtype</strong>: The data type of the column, which helps understand the nature of the information stored in each column. For example, <code>float64</code></p></li>
</ul></li>
</ul>
<p>(real numbers), <code>int32</code> (integers), <code>category</code> (categorical variable), <code>datetime64[ns]</code> (temporal information), and <code>object</code> (text or mixed data).</p>
<p>Using <code>info()</code> is a quick and effective way to get an overview of a DataFrame, quickly identify columns containing missing values, and understand the data structure.</p>
</section>
<section id="calculating-descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="calculating-descriptive-statistics">Calculating descriptive statistics</h3>
<p>In addition to the information returned by the <code>info()</code> method, we might want to obtain simple descriptive statistics to quickly visualize the distributions of variables. The <code>describe()</code> method provides a synthetic view of the distribution of data in each column.</p>
<div id="52f7b715" class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="177">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>3.00000</td>
<td>6.000000</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2.30000</td>
<td>-4.166667</td>
<td>2022-01-03 12:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">min</td>
<td>0.00000</td>
<td>-10.000000</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.65000</td>
<td>-9.500000</td>
<td>2022-01-02 06:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50%</td>
<td>1.30000</td>
<td>-5.500000</td>
<td>2022-01-03 12:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75%</td>
<td>3.45000</td>
<td>0.000000</td>
<td>2022-01-04 18:00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">max</td>
<td>5.60000</td>
<td>5.000000</td>
<td>2022-01-06 00:00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>2.93087</td>
<td>6.242329</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It should be noted that <code>describe()</code> only returns statistics for numeric columns by default. If we want to include columns of other types, we need to specify this via the <code>include</code> argument. For example, <code>df.describe(include='all')</code> will return statistics for all columns, including metrics such as the unique count, the most frequent value, and the frequency of the most frequent value for non-numeric columns.</p>
<div id="c3ad4ca4" class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df.describe(include<span class="op">=</span><span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>3.00000</td>
<td>6.000000</td>
<td>6</td>
<td>6</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>NaN</td>
<td>NaN</td>
<td>3</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>NaN</td>
<td>NaN</td>
<td>train</td>
<td>NaN</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>NaN</td>
<td>NaN</td>
<td>3</td>
<td>NaN</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean</td>
<td>2.30000</td>
<td>-4.166667</td>
<td>NaN</td>
<td>2022-01-03 12:00:00</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.00000</td>
<td>-10.000000</td>
<td>NaN</td>
<td>2022-01-01 00:00:00</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.65000</td>
<td>-9.500000</td>
<td>NaN</td>
<td>2022-01-02 06:00:00</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1.30000</td>
<td>-5.500000</td>
<td>NaN</td>
<td>2022-01-03 12:00:00</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3.45000</td>
<td>0.000000</td>
<td>NaN</td>
<td>2022-01-04 18:00:00</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>5.60000</td>
<td>5.000000</td>
<td>NaN</td>
<td>2022-01-06 00:00:00</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.93087</td>
<td>6.242329</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note again that the <code>count</code> variable returns the number of <strong>non-missing</strong> values in each variable.</p>
</section>
</section>
<section id="main-data-manipulations" class="level2">
<h2 class="anchored" data-anchor-id="main-data-manipulations">Main data manipulations</h2>
<section id="transforming-data" class="level3">
<h3 class="anchored" data-anchor-id="transforming-data">Transforming data</h3>
<p>Data transformation operations are essential for shaping, cleaning, and preparing data for analysis. Transformations can apply to the entire DataFrame, specific columns, or specific rows.</p>
<section id="transforming-a-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="transforming-a-dataframe">Transforming a DataFrame</h4>
<p>To transform an entire DataFrame (or a sub-DataFrame), it is possible to use vectorized functions, which allow quickly applying an operation to all elements of the DataFrame. This includes a number of methods available for <code>Series</code>, as well as NumPy mathematical functions, etc.</p>
<p>For example, raising each numeric value in a DataFrame to the power of 2:</p>
<div id="5dd55824" class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">**</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="179">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.69</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>31.36</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.00</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>or taking the absolute value:</p>
<div id="c694f476" class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">abs</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="180">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Some methods available for <code>Series</code> can also be used to transform an entire DataFrame. For example, the very useful <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html">replace()</a> method, which allows replacing all occurrences of a given value with another value. For example, suppose the value 0 in the <code>var1</code> column actually indicates a measurement error. It would be preferable to replace it with a missing value.</p>
<div id="e49cb614" class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df.replace(<span class="dv">0</span>, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>-4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-6.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>-2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>-1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Assignment or in-place methods?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assignment or in-place methods?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the previous example, applying the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html">replace()</a> method does not directly modify the DataFrame. To make the modification persistent, one possibility is to assign the result to an object:</p>
<div id="26a1bf38" class="cell" data-execution_count="182">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.replace(<span class="dv">0</span>, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A second possibility is, when methods offer it, to use the <code>inplace</code> argument. When <code>inplace=True</code>, the operation is performed “in place”, and the DataFrame is therefore directly modified.</p>
<div id="117ba7af" class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df.replace(<span class="dv">0</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In practice, it is better to limit <code>inplace</code> operations. They do not favor the reproducibility of analyses, as the re-execution of the same cell will give different results each time.</p>
</div>
</div>
</section>
<section id="transforming-columns" class="level4">
<h4 class="anchored" data-anchor-id="transforming-columns">Transforming columns</h4>
<p>In some cases, we will not want to apply transformations to the entire data but to specific variables. Transformations possible at the DataFrame level (vectorized functions, methods like <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.replace.html">replace()</a>, etc.) naturally remain possible at the column level.</p>
<div id="7ba13849" class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">abs</span>(df[<span class="st">"var2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="184">
<pre><code>0    1
1    8
2    0
3    3
4    0
5    3
Name: var2, dtype: int64</code></pre>
</div>
</div>
<div id="89e39c05" class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"var1"</span>].replace(<span class="dv">0</span>, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="185">
<pre><code>0    1.3
1    5.6
2    NaN
3    NaN
4    NaN
5    NaN
Name: var1, dtype: float64</code></pre>
</div>
</div>
<p>But there are other transformations that are generally applied at the level of one or a few columns. For example, when the schema has not been properly recognized upon import, it may happen that numeric variables are defined as strings (type <code>object</code> in Pandas).</p>
<div id="2047e87e" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan],</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="st">"1"</span>, <span class="st">"5"</span>, <span class="st">"18"</span>],</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 3 entries, 0 to 2
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   var1    2 non-null      float64
 1   var2    3 non-null      object 
dtypes: float64(1), object(1)
memory usage: 176.0+ bytes</code></pre>
</div>
</div>
<p>In this case, we can use the <code>astype</code> method to convert the column to the desired type.</p>
<div id="1b150be8" class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var2'</span>] <span class="op">=</span> df[<span class="st">'var2'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 3 entries, 0 to 2
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   var1    2 non-null      float64
 1   var2    3 non-null      int64  
dtypes: float64(1), int64(1)
memory usage: 176.0 bytes</code></pre>
</div>
</div>
<p>Another frequent operation is renaming one or more columns. To do this, we can use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html">rename()</a> method, passing a dictionary containing as many key-value pairs as variables to be renamed, where each key-value pair is of the form <code>'old_name': 'new_name'</code>.</p>
<div id="b0ee3425" class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{<span class="st">'var2'</span>: <span class="st">'age'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="188">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, we might want to remove columns from the DataFrame that are not or no longer useful for analysis. For this, we use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html">drop()</a> method, to which we pass either a string (name of a column if we want to remove only one) or a list of column names to remove.</p>
<div id="c67a5c2a" class="cell" data-execution_count="189">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'var1'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="189">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="transforming-rows" class="level4">
<h4 class="anchored" data-anchor-id="transforming-rows">Transforming rows</h4>
<p>In statistics, we generally apply transformations involving one or more columns. However, in some cases, it is necessary to apply transformations at the row level. For this, we can use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html">apply()</a> method of Pandas, applied to the row axis (<code>axis=1</code>). Let’s illustrate its operation with a simple case. First, we generate data.</p>
<div id="8d381ae8" class="cell" data-execution_count="190">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span>],</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">15</span>],</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>],</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="190">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We now apply the <code>apply()</code> function to the DataFrame to calculate a new variable that is the sum of the two existing ones.</p>
<div id="94fe6343" class="cell" data-execution_count="191">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sum_row'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: row[<span class="st">'var1'</span>] <span class="op">+</span> row[<span class="st">'var2'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="191">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sum_row</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
<td>28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Lambda functions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lambda functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <code>lambda</code> function is a small anonymous function. It can take any number of arguments but can have only one expression. In the example above, the <code>lambda</code> function takes a row as an argument and returns the sum of the <code>var1</code> and <code>var2</code> columns for that row.</p>
<p>Lambda functions allow defining simple functions “on the fly” without having to give them a name. In our example, this would have been perfectly equivalent to the following code:</p>
<div id="3e9c2c43" class="cell" data-execution_count="192">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sum_row(row):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row[<span class="st">'var1'</span>] <span class="op">+</span> row[<span class="st">'var2'</span>]</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sum_row'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(sum_row, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Although <code>apply()</code> offers great flexibility, it is not the most efficient method, especially for large datasets. Vectorized operations are always preferable as they process data in blocks rather than row by row. In our case, it would have been preferable to create our variable using column operations.</p>
<div id="d9e1fea0" class="cell" data-execution_count="193">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sum_row_vect'</span>] <span class="op">=</span> df[<span class="st">'var1'</span>] <span class="op">+</span> df[<span class="st">'var2'</span>]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="193">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sum_row</th>
<th data-quarto-table-cell-role="th">sum_row_vect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
<td>12</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
<td>20</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
<td>28</td>
<td>28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>However, we might find ourselves in certain (rare) cases where an operation cannot be easily vectorized or where the logic is complex. Suppose, for example, we want to combine the values of several columns based on certain conditions.</p>
<div id="62c35ba2" class="cell" data-execution_count="194">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_columns(row):</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'var1'</span>] <span class="op">&gt;</span> <span class="dv">6</span>:</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(row[<span class="st">'var2'</span>])</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(row[<span class="st">'var2'</span>]) <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> row[<span class="st">'date'</span>]</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'combined_column'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(combine_columns, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="194">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sum_row</th>
<th data-quarto-table-cell-role="th">sum_row_vect</th>
<th data-quarto-table-cell-role="th">combined_column</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
<td>4</td>
<td>4</td>
<td>3_2022-01-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
<td>12</td>
<td>12</td>
<td>7_2022-01-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
<td>20</td>
<td>20</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
<td>28</td>
<td>28</td>
<td>15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="sorting-values" class="level3">
<h3 class="anchored" data-anchor-id="sorting-values">Sorting values</h3>
<p>Sorting data is particularly useful for exploring and visualizing data. With Pandas, we use the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html">sort_values()</a> method to sort the values of a DataFrame based on one or more columns.</p>
<div id="ffb45040" class="cell" data-execution_count="195">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span>],</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">15</span>],</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>],</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="195">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To sort the values based on a single column, just pass the column name as a parameter.</p>
<div id="f5a490a3" class="cell" data-execution_count="196">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'var1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="196">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By default, the sorting is done in ascending</p>
<p>order. To sort the values in descending order, just set <code>ascending=False</code>.</p>
<div id="63addefe" class="cell" data-execution_count="197">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'var1'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="197">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2022-01-04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2022-01-03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If we want to sort the DataFrame on multiple columns, we can provide a list of column names. We can also choose to sort in ascending order for some columns and descending order for others.</p>
</section>
<section id="aggregating-data" class="level3">
<h3 class="anchored" data-anchor-id="aggregating-data">Aggregating data</h3>
<p>Aggregating data is a process where the data is broken down into groups based on certain criteria and then aggregated using an aggregation function applied independently to each group. This operation is common in exploratory analysis or when preprocessing data for visualization or statistical modeling.</p>
<div id="22c6a563" class="cell" data-execution_count="198">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>, <span class="st">"2022-01-05"</span>, <span class="st">"2022-01-06"</span>],</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: <span class="st">"sample1"</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="198">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>2022-01-01</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>0</td>
<td>train</td>
<td>2022-01-02</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>9</td>
<td>test</td>
<td>2022-01-03</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>-8</td>
<td>train</td>
<td>2022-01-04</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>-8</td>
<td>train</td>
<td>2022-01-05</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="the-groupby-operation" class="level4">
<h4 class="anchored" data-anchor-id="the-groupby-operation">The <code>groupBy</code> operation</h4>
<p>The <code>groupBy</code> method in Pandas allows dividing the DataFrame into subsets based on the values of one or more columns, and then applying an aggregation function to each subset. It returns a <code>DataFrameGroupBy</code> object that is not very useful by itself but is an essential intermediate step to then apply one or more aggregation function(s) to the different groups.</p>
<div id="bec7f4a9" class="cell" data-execution_count="199">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'experiment'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="199">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7fe44ec52620&gt;</code></pre>
</div>
</div>
</section>
<section id="aggregation-functions" class="level4">
<h4 class="anchored" data-anchor-id="aggregation-functions">Aggregation functions</h4>
<p>Once the data is grouped, we can apply aggregation functions to obtain a statistical summary. Pandas includes a number of these functions, the complete list of which is detailed in the <a href="https://pandas.pydata.org/docs/user_guide/groupby.html#built-in-aggregation-methods">documentation</a>. Here are some examples of using these methods.</p>
<p>For example, count the number of occurrences in each group.</p>
<div id="ab481b57" class="cell" data-execution_count="200">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'experiment'</span>).size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="200">
<pre><code>experiment
test          2
train         3
validation    1
dtype: int64</code></pre>
</div>
</div>
<p>Calculate the sum of a variable by group.</p>
<div id="9f83f900" class="cell" data-execution_count="201">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'experiment'</span>)[<span class="st">'var1'</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="201">
<pre><code>experiment
test          1.3
train         5.6
validation    0.0
Name: var1, dtype: float64</code></pre>
</div>
</div>
<p>Or count the number of unique values of a variable by group. The possibilities are numerous.</p>
<div id="427223ae" class="cell" data-execution_count="202">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the number of unique values of 'var2' in each group</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'experiment'</span>)[<span class="st">'var2'</span>].nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="202">
<pre><code>experiment
test          2
train         2
validation    1
Name: var2, dtype: int64</code></pre>
</div>
</div>
<p>When we want to apply multiple aggregation functions at once or custom functions, we use the <code>agg</code> method. This method accepts a list of functions or a dictionary that associates column names with functions to apply. This allows for finer application of aggregation functions.</p>
<div id="6e66fcfe" class="cell" data-execution_count="203">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'experiment'</span>).agg({<span class="st">'var1'</span>: <span class="st">'mean'</span>, <span class="st">'var2'</span>: <span class="st">'count'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="203">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">test</td>
<td>1.3</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">train</td>
<td>2.8</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">validation</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Method chaining">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Method chaining
</div>
</div>
<div class="callout-body-container callout-body">
<p>The previous examples illustrate an important concept in Pandas: method chaining. This term refers to the possibility of chaining transformations applied to a DataFrame by applying methods to it in a chain. At each applied method, an intermediate DataFrame is created (but not assigned to a variable), which becomes the input of the next method.</p>
<p>Method chaining allows combining several operations into a single code expression. This can improve efficiency by avoiding intermediate assignments and making the code more fluid and readable. It also favors a functional programming style where data flows smoothly through a chain of transformations.</p>
</div>
</div>
</section>
<section id="effects-on-the-index" class="level4">
<h4 class="anchored" data-anchor-id="effects-on-the-index">Effects on the index</h4>
<p>It is interesting to note the effects of the aggregation process on the DataFrame’s index. The last example above illustrates this well: the groups, i.e., the modalities of the variable used for aggregation, become the values of the index.</p>
<p>We might want to reuse this information in subsequent analyses and therefore want it as a column. For this, just reset the index with the <code>reset_index()</code> method.</p>
<div id="f4fa2c60" class="cell" data-execution_count="204">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df_agg <span class="op">=</span> df.groupby(<span class="st">'experiment'</span>).agg({<span class="st">'var1'</span>: <span class="st">'mean'</span>, <span class="st">'var2'</span>: <span class="st">'count'</span>})</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>df_agg.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="204">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>test</td>
<td>1.3</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>train</td>
<td>2.8</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>validation</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="handling-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="handling-missing-values">Handling missing values</h3>
<p>Missing values are a common reality in real-world data processing and can occur for various reasons, such as non-responses to a questionnaire, data entry errors, data loss during transmission, or simply because the information is not applicable. Pandas offers several tools to handle missing values.</p>
<section id="representation-of-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="representation-of-missing-values">Representation of missing values</h4>
<p>In Pandas, missing values are generally represented by <code>np.nan</code>, a special marker provided by the <code>NumPy</code> library. While it is preferable to use this object to denote missing values, note that the <code>None</code> object in <code>Python</code> is also understood as a missing value by <code>Pandas</code>.</p>
<p>Let’s verify this property. To identify where the missing values are, we use the <code>isna()</code> function, which returns a boolean DataFrame indicating <code>True</code> where the values are <code>NaN</code>.</p>
<div id="eadb925c" class="cell" data-execution_count="205">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="va">None</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: <span class="st">"sample1"</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>df.isna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="205">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="calculations-on-columns-containing-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="calculations-on-columns-containing-missing-values">Calculations on columns containing missing values</h4>
<p>During statistical calculations, missing values are generally ignored. For example, the <code>.mean()</code> method calculates the mean of non-missing values.</p>
<div id="4b5e4265" class="cell" data-execution_count="206">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var1'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="206">
<pre><code>np.float64(2.3)</code></pre>
</div>
</div>
<p>However, calculations involving multiple columns do not always ignore missing values and can often result in <code>NaN</code>.</p>
<div id="1aba79f6" class="cell" data-execution_count="207">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var3'</span>] <span class="op">=</span> df[<span class="st">'var1'</span>] <span class="op">+</span> df[<span class="st">'var2'</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="207">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">var3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>-2</td>
<td>test</td>
<td>sample1</td>
<td>-0.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>-8</td>
<td>train</td>
<td>sample1</td>
<td>-2.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>5</td>
<td>test</td>
<td>sample1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>8</td>
<td>None</td>
<td>sample1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
<td>sample1</td>
<td>-10.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>0</td>
<td>validation</td>
<td>sample1</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="removing-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="removing-missing-values">Removing missing values</h4>
<p>The <code>dropna()</code> method allows us to remove rows (<code>axis=0</code>) or columns (<code>axis=1</code>) containing missing values. By default, any row containing at least one missing value is removed.</p>
<div id="74a32281" class="cell" data-execution_count="208">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="208">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">var3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>-2</td>
<td>test</td>
<td>sample1</td>
<td>-0.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>-8</td>
<td>train</td>
<td>sample1</td>
<td>-2.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>-10</td>
<td>train</td>
<td>sample1</td>
<td>-10.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By changing the <code>axis</code> parameter, we can request that any column containing at least one missing value be removed.</p>
<div id="1dbc93d5" class="cell" data-execution_count="209">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df.dropna(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="209">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-2</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-8</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-10</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, the <code>how</code> parameter defines the deletion mode. By default, a row or column is removed when at least one value is missing (<code>how=any</code>), but it is possible to remove the row/column only when all values are missing (<code>how=all</code>).</p>
</section>
<section id="replacing-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="replacing-missing-values">Replacing missing values</h4>
<p>To handle missing values in a DataFrame, a common approach is imputation, which involves replacing the missing values with other values. The <code>fillna()</code> method allows us to perform this operation in various ways. One possibility is replacement by a constant value.</p>
<div id="5407e46a" class="cell" data-execution_count="210">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var1'</span>].fillna(value<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="210">
<pre><code>0    1.3
1    5.6
2    0.0
3    0.0
4    0.0
5    0.0
Name: var1, dtype: float64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Changing the representation of missing values">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Changing the representation of missing values
</div>
</div>
<div class="callout-body-container callout-body">
<p>It can sometimes be tempting to change the manifestation of a missing value for visibility reasons, for example by replacing it with a string:</p>
<div id="03fbfc4c" class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var1'</span>].fillna(value<span class="op">=</span><span class="st">"MISSING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="211">
<pre><code>0        1.3
1        5.6
2    MISSING
3    MISSING
4        0.0
5    MISSING
Name: var1, dtype: object</code></pre>
</div>
</div>
<p>In practice, this is not recommended. It is indeed preferable to stick to Pandas’ standard convention (using <code>np.nan</code>), firstly for standardization purposes that facilitate reading and maintaining the code, but also because the standard convention is optimized for performance and calculations from data containing missing values.</p>
</div>
</div>
<p>Another frequent imputation method is to use a statistical value, such as the mean or median of the variable.</p>
<div id="8d148ec0" class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'var1'</span>].fillna(value<span class="op">=</span>df[<span class="st">'var1'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="212">
<pre><code>0    1.3
1    5.6
2    2.3
3    2.3
4    0.0
5    2.3
Name: var1, dtype: float64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Imputation bias">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Imputation bias
</div>
</div>
<div class="callout-body-container callout-body">
<p>Replacing missing values with a constant value, such as zero, the mean, or the median, can be problematic. If the data is not missing at random (MNAR), this can introduce bias into the analysis. MNAR variables are variables whose probability of being missing is related to their own value or other variables in the data. In such cases, more sophisticated imputation may be necessary to minimize distortions. We will see an example in the end-of-tutorial exercise.</p>
</div>
</div>
</section>
</section>
<section id="handling-data-of-specific-types" class="level3">
<h3 class="anchored" data-anchor-id="handling-data-of-specific-types">Handling data of specific types</h3>
<section id="text-data" class="level4">
<h4 class="anchored" data-anchor-id="text-data">Text data</h4>
<p>Text data often requires cleaning and preparation before analysis. Pandas provides an array of vectorized operations via the <code>str</code> library that make preparing text data both simple and very efficient. Again, the possibilities are numerous and detailed in the <a href="https://pandas.pydata.org/docs/user_guide/text.html">documentation</a>. Here we present the most frequently used methods in data analysis.</p>
<div id="0209cd89" class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: [<span class="st">"  sample1"</span>, <span class="st">"sample1"</span>, <span class="st">"sample2"</span>, <span class="st">"   sample2   "</span>, <span class="st">"sample2  "</span>, <span class="st">"sample1"</span>]</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="213">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>2</td>
<td>train</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
<td>test</td>
<td>sample2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>6</td>
<td>train</td>
<td>sample2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
<td>validation</td>
<td>sample1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A first frequent operation is to extract certain characters from a string. We use the <code>str[n:]</code> function (with a somewhat peculiar syntax) for this. For example, if we want to extract the last character of the <code>sample</code> variable to retain only the sample number.</p>
<div id="a06cb120" class="cell" data-execution_count="214">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"sample_n"</span>] <span class="op">=</span> df[<span class="st">"sample"</span>].<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="214">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">sample_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>2</td>
<td>train</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
<td>test</td>
<td>sample2</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>6</td>
<td>train</td>
<td>sample2</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
<td>validation</td>
<td>sample1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The principle was correct, but the presence of extraneous spaces in our text data (which were not visible when viewing the DataFrame!) made the operation more difficult than expected. This is an opportunity to introduce the <code>strip</code> family of methods (<code>.str.strip()</code>, <code>.str.lstrip()</code>, and <code>.str.rstrip()</code>) that respectively remove extr</p>
<p>aneous spaces from both sides or one side.</p>
<div id="105f81e5" class="cell" data-execution_count="215">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"sample"</span>] <span class="op">=</span> df[<span class="st">"sample"</span>].<span class="bu">str</span>.strip()</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"sample_n"</span>] <span class="op">=</span> df[<span class="st">"sample"</span>].<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>:]</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="215">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">sample_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>2</td>
<td>train</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>6</td>
<td>train</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
<td>validation</td>
<td>sample1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We might also want to filter a DataFrame based on the presence or absence of a certain string (or substring) of characters. For this, we use the <code>.str.contains()</code> method.</p>
<div id="27631552" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'experiment'</span>].<span class="bu">str</span>.contains(<span class="st">'test'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="216">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">sample_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, we might want to replace a string (or substring) of characters with another, which the <code>str.replace()</code> method allows.</p>
<div id="66d08f63" class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'experiment'</span>] <span class="op">=</span> df[<span class="st">'experiment'</span>].<span class="bu">str</span>.replace(<span class="st">'validation'</span>, <span class="st">'val'</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="217">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
<th data-quarto-table-cell-role="th">sample</th>
<th data-quarto-table-cell-role="th">sample_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>2</td>
<td>test</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>2</td>
<td>train</td>
<td>sample1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-8</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>6</td>
<td>test</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>6</td>
<td>train</td>
<td>sample2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>1</td>
<td>val</td>
<td>sample1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="categorical-data" class="level4">
<h4 class="anchored" data-anchor-id="categorical-data">Categorical data</h4>
<p>Categorical data is variables that contain a limited number of categories. Similar to <code>R</code> with the notion of <code>factor</code>, Pandas has a special data type, <code>category</code>, which is useful for representing categorical data more efficiently and informatively. Categorical data is indeed optimized for certain types of data and can speed up operations like grouping and sorting. It is also useful for visualization, ensuring that categories are displayed in a coherent and logical order.</p>
<p>To convert a variable to the <code>category</code> format, we use the <code>astype()</code> method.</p>
<div id="a7f574a2" class="cell" data-execution_count="218">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="fl">1.3</span>, <span class="fl">5.6</span>, np.nan, np.nan, <span class="dv">0</span>, np.nan],</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: np.random.randint(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"experiment"</span>: [<span class="st">"test"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="va">None</span>, <span class="st">"train"</span>, <span class="st">"validation"</span>],</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1          float64
var2            int64
experiment     object
dtype: object</code></pre>
</div>
</div>
<div id="4b9cee2c" class="cell" data-execution_count="219">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'experiment'</span>] <span class="op">=</span> df[<span class="st">'experiment'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1           float64
var2             int64
experiment    category
dtype: object</code></pre>
</div>
</div>
<p>This conversion gives us access to some very useful methods, specific to handling categorical variables. For example, it can be useful to rename categories for clarity or standardization.</p>
<div id="bdf7e8ca" class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'experiment'</span>] <span class="op">=</span> df[<span class="st">'experiment'</span>].cat.rename_categories({<span class="st">'test'</span>: <span class="st">'Test'</span>, <span class="st">'train'</span>: <span class="st">'Train'</span>, <span class="st">'validation'</span>: <span class="st">'Validation'</span>})</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="220">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">experiment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.3</td>
<td>-5</td>
<td>Test</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.6</td>
<td>9</td>
<td>Train</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>-10</td>
<td>Test</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>-6</td>
<td>Train</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>-8</td>
<td>Validation</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Sometimes, the order of categories is significant, and we might want to modify it. This is particularly important for visualization, as the categories will by default be displayed in the specified order.</p>
<div id="76f95a92" class="cell" data-execution_count="221">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df_cat <span class="op">=</span> df[<span class="st">'experiment'</span>].cat.reorder_categories([<span class="st">'Test'</span>, <span class="st">'Train'</span>, <span class="st">'Validation'</span>], ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"experiment"</span>).mean().plot(kind<span class="op">=</span><span class="st">'bar'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_3473/419168969.py:2: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  df.groupby("experiment").mean().plot(kind='bar')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tutorial_files/figure-html/cell-222-output-2.png" width="569" height="482" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="temporal-data" class="level4">
<h4 class="anchored" data-anchor-id="temporal-data">Temporal data</h4>
<p>Temporal data is often present in tabular data to temporally identify the observations collected. Pandas offers functionalities for handling these types of data, particularly through the <code>datetime64</code> type, which allows precise manipulation of dates and times.</p>
<div id="8b06908c" class="cell" data-execution_count="222">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span>],</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">15</span>],</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>],</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: [<span class="st">"sample1"</span>, <span class="st">"sample1"</span>, <span class="st">"sample2"</span>, <span class="st">"sample2"</span>]</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="222">
<pre><code>var1       int64
var2       int64
date      object
sample    object
dtype: object</code></pre>
</div>
</div>
<p>To handle temporal data, it is necessary to convert the strings into <code>datetime</code> objects. Pandas does this via the <code>to_datetime()</code> function.</p>
<div id="ecfe12ba" class="cell" data-execution_count="223">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'date'</span>])</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="223">
<pre><code>var1               int64
var2               int64
date      datetime64[ns]
sample            object
dtype: object</code></pre>
</div>
</div>
<p>Once converted, dates can be formatted, compared, and used in calculations. In particular, Pandas now understands the “order” of the dates present in the data, allowing for filtering over given periods.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>df[(df[<span class="st">'date'</span>] <span class="op">&gt;=</span> <span class="st">"2022-01-01"</span>) <span class="op">&amp;</span> (df[<span class="st">'date'</span>] <span class="op">&lt;</span> <span class="st">"2022-01-03"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We might also want to perform less precise filtering, involving the year or month. Pandas allows us to easily extract specific components of the date, such as the year, month, day, hour, etc.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.year</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.month</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'day'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.day</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">2023</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, calculations involving dates become possible. We can add or subtract time periods from dates and compare them with each other. The functions used come from <code>Pandas</code> but are very similar in operation to those of the <a href="https://docs.python.org/fr/3/library/time.html">time</a> module in Python.</p>
<p>For example, we can add time intervals or calculate differences from a reference date.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date_plus_one'</span>] <span class="op">=</span> df[<span class="st">'date'</span>] <span class="op">+</span> pd.Timedelta(days<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date_diff'</span>] <span class="op">=</span> df[<span class="st">'date'</span>] <span class="op">-</span> pd.to_datetime(<span class="st">'2022-01-01'</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="joining-tables" class="level3">
<h3 class="anchored" data-anchor-id="joining-tables">Joining tables</h3>
<p>In data analysis, it is common to want to combine different data sources. This combination can be done vertically (one DataFrame on top of another), for example, when combining two years of the same survey for joint analysis. The combination can also be done horizontally (side by side) based on one or more join keys, often to enrich one data source with information from another source covering the same statistical units.</p>
<section id="concatenating-tables" class="level4">
<h4 class="anchored" data-anchor-id="concatenating-tables">Concatenating tables</h4>
<p>The vertical concatenation of tables is done using the <code>concat()</code> function in Pandas.</p>
<div id="a64fd381" class="cell" data-execution_count="224">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame(</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="dv">1</span>, <span class="dv">5</span>],</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="dv">3</span>, <span class="dv">7</span>],</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>],</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: [<span class="st">"sample1"</span>, <span class="st">"sample1"</span>]</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame(</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var1"</span>: [<span class="dv">9</span>, <span class="dv">13</span>],</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date"</span>: [<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>],</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"var2"</span>: [<span class="dv">11</span>, <span class="dv">15</span>],</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sample"</span>: [<span class="st">"sample2"</span>, <span class="st">"sample2"</span>]</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>df_concat <span class="op">=</span> pd.concat([df1, df2])</span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a>df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="224">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9</td>
<td>11</td>
<td>2023-01-01</td>
<td>sample2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>13</td>
<td>15</td>
<td>2023-01-02</td>
<td>sample2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that the order of variables in the two DataFrames is not important. Pandas does not “dumbly” juxtapose the two DataFrames; it matches the schemas to align the variables by name. If two variables have the same name but not the same type - for example, if a numeric variable has been interpreted as strings - Pandas will resolve the issue by taking the common denominator, usually converting to strings (type <code>object</code>).</p>
<p>However, the previous concatenation reveals an issue of repetition at the index level. This is logical: we did not specify an index for our initial two DataFrames, which therefore have the same position index ([0, 1]). In this case (where the index is not important), we can pass the <code>ignore_index=True</code> parameter to rebuild the final index from scratch.</p>
<div id="46cf8b25" class="cell" data-execution_count="225">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>df_concat <span class="op">=</span> pd.concat([df1, df2], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="225">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">var1</th>
<th data-quarto-table-cell-role="th">var2</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>3</td>
<td>2022-01-01</td>
<td>sample1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5</td>
<td>7</td>
<td>2022-01-02</td>
<td>sample1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>11</td>
<td>2023-01-01</td>
<td>sample2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>13</td>
<td>15</td>
<td>2023-01-02</td>
<td>sample2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Iterative construction of a DataFrame">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Iterative construction of a DataFrame
</div>
</div>
<div class="callout-body-container callout-body">
<p>One might have the idea of using <code>pd.concat()</code> to iteratively construct a DataFrame by adding a new row to the existing DataFrame in each iteration of a loop. However, this is not a good idea: as we have seen, a DataFrame is represented in memory as a juxtaposition of Series. Thus, adding a column to a DataFrame is not costly, but adding a row involves modifying each element constituting the DataFrame. To construct a DataFrame, it is therefore advisable to store the rows in a list of lists (one per column) or a dictionary, then call <code>pd.DataFrame()</code> to build the DataFrame, as we did at the beginning of this tutorial.</p>
</div>
</div>
</section>
<section id="merging-tables" class="level4">
<h4 class="anchored" data-anchor-id="merging-tables">Merging tables</h4>
<p>Merging tables is an operation that allows us to associate rows from two different DataFrames based on one or more common keys, similar to joins in SQL databases. Different types of joins are possible depending on the data we want to keep, the main ones being represented in the following diagram.</p>
<p><img src="img/joins.png" class="img-fluid"></p>
<p>Source: <a href="https://medium.com/swlh/merging-dataframes-with-pandas-pd-merge-7764c7e2d46d">link</a></p>
<p>In Pandas, joins are done with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">merge()</a> function. To perform a join, we must specify (at a minimum) two pieces of information:</p>
<ul>
<li><p>the type of join: by default, Pandas performs an <code>inner</code> join. The <code>how</code> parameter allows specifying other types of joins;</p></li>
<li><p>the join key. By default, Pandas tries to join the two DataFrames based on their indexes. In practice, we often specify a variable present in the DataFrames as the join key (the <code>on</code> parameter if the variable has the same name in both DataFrames, or <code>left_on</code> and <code>right_on</code> otherwise).</p></li>
</ul>
<p>Let’s analyze the difference between the different types of joins through examples.</p>
<div id="5973fa29" class="cell" data-execution_count="226">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>df_a <span class="op">=</span> pd.DataFrame({</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'key'</span>: [<span class="st">'K0'</span>, <span class="st">'K1'</span>, <span class="st">'K2'</span>, <span class="st">'K3'</span>, <span class="st">'K4'</span>],</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A'</span>: [<span class="st">'A0'</span>, <span class="st">'A1'</span>, <span class="st">'A2'</span>, <span class="st">'A3'</span>, <span class="st">'A4'</span>],</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'B'</span>: [<span class="st">'B0'</span>, <span class="st">'B1'</span>, <span class="st">'B2'</span>, <span class="st">'B3'</span>, <span class="st">'A4'</span>]</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>df_b <span class="op">=</span> pd.DataFrame({</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'key'</span>: [<span class="st">'K0'</span>, <span class="st">'K1'</span>, <span class="st">'K2'</span>, <span class="st">'K5'</span>, <span class="st">'K6'</span>],</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="st">'C0'</span>, <span class="st">'C1'</span>, <span class="st">'C2'</span>, <span class="st">'C5'</span>, <span class="st">'C6'</span>],</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D'</span>: [<span class="st">'D</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="er">0', 'D1', 'D2', 'D5', 'D6']</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="er">})</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="er">display</span>(df_a)</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>display(df_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">  Cell </span><span class="ansi-green-fg">In[226], line 10</span>
<span class="ansi-red-fg">    'D': ['D</span>
          ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> unterminated string literal (detected at line 10)
</pre>
</div>
</div>
</div>
<p>The <code>inner</code> join keeps the observations whose key is present in both DataFrames.</p>
<div id="1d35c02d" class="cell" data-execution_count="227">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df_merged_inner <span class="op">=</span> pd.merge(df_a, df_b, on<span class="op">=</span><span class="st">'key'</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>df_merged_inner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="227">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>K0</td>
<td>A0</td>
<td>B0</td>
<td>C0</td>
<td>D0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>K1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>D1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>K2</td>
<td>A2</td>
<td>B2</td>
<td>C2</td>
<td>D2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Inner joins">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Inner joins
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>inner</code> join is the most intuitive: it generally does not create missing values and therefore allows working directly on the merged table. But beware: if many keys are not present in both DataFrames, an <code>inner</code> join can result in significant data loss, leading to biased final results. In this case, it is better to choose a left or right join, depending on the source we want to enrich and for which it is most important to minimize data loss.</p>
</div>
</div>
<p>A <code>left</code> join keeps all observations in the left DataFrame (the first DataFrame specified in <code>pd.merge()</code>). As a result, if keys are present in the left DataFrame but not in the right one, the final DataFrame contains missing values at those observations (for the right DataFrame’s variables).</p>
<div id="0ec2cdb7" class="cell" data-execution_count="228">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>df_merged_left <span class="op">=</span> pd.merge(df_a, df_b, how<span class="op">=</span><span class="st">"left"</span>, on<span class="op">=</span><span class="st">'key'</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>df_merged_left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="228">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>K0</td>
<td>A0</td>
<td>B0</td>
<td>C0</td>
<td>D0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>K1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>D1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>K2</td>
<td>A2</td>
<td>B2</td>
<td>C2</td>
<td>D2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>K3</td>
<td>A3</td>
<td>B3</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>K4</td>
<td>A4</td>
<td>A4</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>outer</code> join contains all observations and variables in both DataFrames. Thus, the retained information is maximal, but on the other hand, missing values can be quite numerous. It will therefore be necessary to handle missing values well before proceeding with analyses.</p>
<div id="30609347" class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>df_merged_outer <span class="op">=</span> pd.merge(df_a, df_b, how<span class="op">=</span><span class="st">"outer"</span>, on<span class="op">=</span><span class="st">'key'</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>df_merged_outer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="229">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>K0</td>
<td>A0</td>
<td>B0</td>
<td>C0</td>
<td>D0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>K1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>D1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>K2</td>
<td>A2</td>
<td>B2</td>
<td>C2</td>
<td>D2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>K3</td>
<td>A3</td>
<td>B3</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>K4</td>
<td>A4</td>
<td>A4</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>K5</td>
<td>NaN</td>
<td>NaN</td>
<td>C5</td>
<td>D5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>K6</td>
<td>NaN</td>
<td>NaN</td>
<td>C6</td>
<td>D6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="comprehension-questions" class="level3">
<h3 class="anchored" data-anchor-id="comprehension-questions">Comprehension questions</h3>
<ol type="1">
<li>What is a DataFrame in the context of Pandas, and what type of data structure can it be compared to in Python?</li>
<li>What is the fundamental difference between a NumPy array and a Pandas Series?</li>
<li>What is the relationship between Series and DataFrame in Pandas?</li>
<li>How are data structured in a Pandas DataFrame?</li>
<li>What is the role of the index in a Pandas DataFrame, and how can it be used when manipulating data?</li>
<li>What methods can you use to explore an unknown DataFrame and learn more about its content and structure?</li>
<li>In Pandas, what is the difference between assigning the result of an operation to a new variable and using a method with the <code>inplace=True</code> argument?</li>
<li>How does the principle of vectorization apply in Pandas, and why is it advantageous for manipulating data?</li>
<li>How does Pandas represent missing values, and what impact does this have on calculations and data transformations?</li>
<li>What is the difference between concatenating two DataFrames and joining them via a merge, and when would you use one over the other?</li>
</ol>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<ol type="1">
<li><p>A DataFrame in Pandas is a two-dimensional data structure, comparable to a table or an Excel spreadsheet. In the Python context, it can be compared to a dictionary of NumPy arrays, where the keys are column names, and the values are the columns themselves.</p></li>
<li><p>The main difference between a NumPy array and a Pandas Series is that the Series can contain labeled data, meaning it has an associated index that allows access and manipulation by label.</p></li>
<li><p>A DataFrame is essentially a collection of Series. Each column of a DataFrame is a Series, and all these Series share the same index, which corresponds to the row labels of the DataFrame.</p></li>
<li><p>Data in a Pandas DataFrame are structured in columns and rows. Each column can contain a different type of data (numeric, string, boolean, etc.), and each row represents an observation.</p></li>
<li><p>The index in a Pandas DataFrame serves to uniquely identify each row in the DataFrame. It allows quick access to rows, performing joins, sorting data, and facilitating grouping operations.</p></li>
<li><p>To explore an unknown DataFrame, you can use <code>df.head()</code> to see the first rows, <code>df.tail()</code> for the last rows, <code>df.info()</code> to get a summary of data types and missing values, and <code>df.describe()</code> for descriptive statistics.</p></li>
<li><p>Assigning the result of an operation to a new variable creates a copy of the DataFrame with the applied modifications. Using a method with <code>inplace=True</code> modifies the original DataFrame without creating a copy, which can be more memory-efficient.</p></li>
<li><p>Pandas represents missing values with the <code>nan</code> (Not a Number) object from <code>NumPy</code> for numeric data and with <code>None</code> or <code>pd.NaT</code> for date/time data. These missing values are generally ignored in statistical calculations, which can affect the results if they are not handled properly.</p></li>
<li><p>Concatenating consists of stacking DataFrames vertically or aligning them horizontally, primarily used when the DataFrames have the same schema or when you want to stack the data. Merging, inspired by SQL JOIN operations, combines DataFrames based on common key values and is used to enrich one dataset with information from another.</p></li>
</ol>
</details>
</div>
</section>
<section id="multiple-ways-to-create-a-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="multiple-ways-to-create-a-dataframe">Multiple ways to create a DataFrame</h3>
<p>In the following cell, we have retrieved cash register data on sales from different stores. The data is presented in two different ways: one as observations (each list contains data from a row), and the other as variables (each list contains data from a column).</p>
<div id="76667b01" class="cell" data-execution_count="230">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>data_list1 <span class="op">=</span> [</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'01.1.1'</span>, <span class="dv">3</span>, <span class="fl">1.50</span>],</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Casino'</span>, <span class="st">'02.1.1'</span>, <span class="dv">2</span>, <span class="fl">2.30</span>],</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Lidl'</span>, <span class="st">'01.1.1'</span>, <span class="dv">7</span>, <span class="fl">0.99</span>],</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'03.1.1'</span>, <span class="dv">5</span>, <span class="fl">5.00</span>],</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Casino'</span>, <span class="st">'01.1.1'</span>, <span class="dv">10</span>, <span class="fl">1.20</span>],</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Lidl'</span>, <span class="st">'02.1.1'</span>, <span class="dv">1</span>, <span class="fl">3.10</span>]</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>data_list2 <span class="op">=</span> [</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>, <span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>],</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'03.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>],</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>],</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.50</span>, <span class="fl">2.30</span>, <span class="fl">0.99</span>, <span class="fl">5.00</span>, <span class="fl">1.20</span>, <span class="fl">3.10</span>]</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The goal is to build in both cases the same DataFrame containing each of the 6 observations and 4 variables, with the same names in both DataFrames. Each case will correspond to a more suitable input data structure, dictionary, or list of lists… make the right choice! We will verify that the two DataFrames are identical using the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.equals.html">equals()</a> method.</p>
<div id="0e1007dc" class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="47eaa347" class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>data_list1 <span class="op">=</span> [</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>, <span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>],</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'03.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>],</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>],</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.50</span>, <span class="fl">2.30</span>, <span class="fl">0.99</span>, <span class="fl">5.00</span>, <span class="fl">1.20</span>, <span class="fl">3.10</span>]</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>data_list2 <span class="op">=</span> [</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'01.1.1'</span>, <span class="dv">3</span>, <span class="fl">1.50</span>],</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Casino'</span>, <span class="st">'02.1.1'</span>, <span class="dv">2</span>, <span class="fl">2.30</span>],</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Lidl'</span>, <span class="st">'01.1.1'</span>, <span class="dv">7</span>, <span class="fl">0.99</span>],</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Carrefour'</span>, <span class="st">'03.1.1'</span>, <span class="dv">5</span>, <span class="fl">5.00</span>],</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Casino'</span>, <span class="st">'01.1.1'</span>, <span class="dv">10</span>, <span class="fl">1.20</span>],</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Lidl'</span>, <span class="st">'02.1.1'</span>, <span class="dv">1</span>, <span class="fl">3.10</span>]</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="co"># If the data is in column form: from a dictionary</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>data_dict <span class="op">=</span> {</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'store'</span>: data_list1[<span class="dv">0</span>],</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'product'</span>: data_list1[<span class="dv">1</span>],</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'quantity'</span>: data_list1[<span class="dv">2</span>],</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price'</span>: data_list1[<span class="dv">3</span>]</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>df_from_dict <span class="op">=</span> pd.DataFrame(data_dict)</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co"># If the data is in row form: from a list of lists</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'store'</span>, <span class="st">'product'</span>, <span class="st">'quantity'</span>, <span class="st">'price'</span>]</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>df_from_list <span class="op">=</span> pd.DataFrame(data_list2, columns<span class="op">=</span>columns)</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>df_from_dict.equals(df_from_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="232">
<pre><code>True</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="data-selection-in-a-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="data-selection-in-a-dataframe">Data selection in a DataFrame</h3>
<p>A Pandas DataFrame is created with cash register data (same data as the previous exercise).</p>
<div id="176c76ef" class="cell" data-execution_count="233">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'store'</span>: [<span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>, <span class="st">'Carrefour'</span>, <span class="st">'Casino'</span>, <span class="st">'Lidl'</span>],</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'product'</span>: [<span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'03.1.1'</span>, <span class="st">'01.1.1'</span>, <span class="st">'02.1.1'</span>],</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'quantity'</span>: [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>],</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price'</span>: [<span class="fl">1.50</span>, <span class="fl">2.30</span>, <span class="fl">0.99</span>, <span class="fl">5.00</span>, <span class="fl">1.20</span>, <span class="fl">3.10</span>],</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date_time'</span>: pd.to_datetime([<span class="st">"2022-01-01 14:05"</span>, <span class="st">"2022</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="er">-01-02 09:30", </span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"2022-01-03 17:45"</span>, <span class="st">"2022-01-04 08:20"</span>, </span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"2022-01-05 19:00"</span>, <span class="st">"2022-01-06 16:30"</span>])</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">  Cell </span><span class="ansi-green-fg">In[233], line 6</span>
<span class="ansi-red-fg">    'date_time': pd.to_datetime(["2022-01-01 14:05", "2022</span>
                                                     ^
<span class="ansi-red-fg">SyntaxError</span><span class="ansi-red-fg">:</span> unterminated string literal (detected at line 6)
</pre>
</div>
</div>
</div>
<p>Use the <code>loc</code> and <code>iloc</code> methods to select specific data:</p>
<ul>
<li>Select the data from the first row.</li>
</ul>
<div id="43dc0813" class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="44bc34ac" class="cell" data-execution_count="235">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iloc[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>var1                        1
var2                        3
date      2022-01-01 00:00:00
sample                sample1
Name: 0, dtype: object</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Select all data from the “price” column.</li>
</ul>
<div id="be275b54" class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="b345e983" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[:, <span class="st">'price'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'price'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[237], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">df</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">loc</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">price</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span>)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1184</span>, in <span class="ansi-cyan-fg">_LocationIndexer.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   1182</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_is_scalar_access(key):
<span class="ansi-green-fg ansi-bold">   1183</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>obj<span style="color:rgb(98,98,98)">.</span>_get_value(<span style="color:rgb(98,98,98)">*</span>key, takeable<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_takeable)
<span class="ansi-green-fg">-&gt; 1184</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_tuple</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1185</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">   1186</span>     <span style="font-style:italic;color:rgb(95,135,135)"># we by definition only have the 0th axis</span>
<span class="ansi-green-fg ansi-bold">   1187</span>     axis <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>axis <span style="font-weight:bold;color:rgb(175,0,255)">or</span> <span style="color:rgb(98,98,98)">0</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1368</span>, in <span class="ansi-cyan-fg">_LocIndexer._getitem_tuple</span><span class="ansi-blue-fg">(self, tup)</span>
<span class="ansi-green-fg ansi-bold">   1366</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> suppress(IndexingError):
<span class="ansi-green-fg ansi-bold">   1367</span>     tup <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_expand_ellipsis(tup)
<span class="ansi-green-fg">-&gt; 1368</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_lowerdim</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">tup</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1370</span> <span style="font-style:italic;color:rgb(95,135,135)"># no multi-index, so validate all of the indexers</span>
<span class="ansi-green-fg ansi-bold">   1371</span> tup <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_tuple_indexer(tup)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1065</span>, in <span class="ansi-cyan-fg">_LocationIndexer._getitem_lowerdim</span><span class="ansi-blue-fg">(self, tup)</span>
<span class="ansi-green-fg ansi-bold">   1061</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> i, key <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">enumerate</span>(tup):
<span class="ansi-green-fg ansi-bold">   1062</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_label_like(key):
<span class="ansi-green-fg ansi-bold">   1063</span>         <span style="font-style:italic;color:rgb(95,135,135)"># We don't need to check for tuples here because those are</span>
<span class="ansi-green-fg ansi-bold">   1064</span>         <span style="font-style:italic;color:rgb(95,135,135)">#  caught by the _is_nested_tuple_indexer check above.</span>
<span class="ansi-green-fg">-&gt; 1065</span>         section <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_axis</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">i</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1067</span>         <span style="font-style:italic;color:rgb(95,135,135)"># We should never have a scalar section here, because</span>
<span class="ansi-green-fg ansi-bold">   1068</span>         <span style="font-style:italic;color:rgb(95,135,135)">#  _getitem_lowerdim is only called after a check for</span>
<span class="ansi-green-fg ansi-bold">   1069</span>         <span style="font-style:italic;color:rgb(95,135,135)">#  is_scalar_access, which that would be.</span>
<span class="ansi-green-fg ansi-bold">   1070</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> section<span style="color:rgb(98,98,98)">.</span>ndim <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>ndim:
<span class="ansi-green-fg ansi-bold">   1071</span>             <span style="font-style:italic;color:rgb(95,135,135)"># we're in the middle of slicing through a MultiIndex</span>
<span class="ansi-green-fg ansi-bold">   1072</span>             <span style="font-style:italic;color:rgb(95,135,135)"># revise the key wrt to `section` by inserting an _NS</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1431</span>, in <span class="ansi-cyan-fg">_LocIndexer._getitem_axis</span><span class="ansi-blue-fg">(self, key, axis)</span>
<span class="ansi-green-fg ansi-bold">   1429</span> <span style="font-style:italic;color:rgb(95,135,135)"># fall thru to straight lookup</span>
<span class="ansi-green-fg ansi-bold">   1430</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_key(key, axis)
<span class="ansi-green-fg">-&gt; 1431</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_get_label</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1381</span>, in <span class="ansi-cyan-fg">_LocIndexer._get_label</span><span class="ansi-blue-fg">(self, label, axis)</span>
<span class="ansi-green-fg ansi-bold">   1379</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">_get_label</span>(<span style="color:rgb(0,135,0)">self</span>, label, axis: AxisInt):
<span class="ansi-green-fg ansi-bold">   1380</span>     <span style="font-style:italic;color:rgb(95,135,135)"># GH#5567 this will fail if the label is not present in the axis.</span>
<span class="ansi-green-fg">-&gt; 1381</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">xs</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">label</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/generic.py:4287</span>, in <span class="ansi-cyan-fg">NDFrame.xs</span><span class="ansi-blue-fg">(self, key, axis, level, drop_level)</span>
<span class="ansi-green-fg ansi-bold">   4285</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> axis <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4286</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> drop_level:
<span class="ansi-green-fg">-&gt; 4287</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg ansi-bold">   4288</span>     index <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns
<span class="ansi-green-fg ansi-bold">   4289</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'price'</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Select the rows corresponding to the store “Carrefour” only.</li>
</ul>
<div id="5e021d82" class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="9f65aeff" class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[df[<span class="st">'store'</span>] <span class="op">==</span> <span class="st">'Carrefour'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'store'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[239], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(df<span style="color:rgb(98,98,98)">.</span>loc[<span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">store</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span> <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Carrefour</span><span style="color:rgb(175,0,0)">'</span>])

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'store'</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Select the quantities purchased for products classified “01.1.1” (Bread).</li>
</ul>
<div id="e9f2d91e" class="cell" data-execution_count="240">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="45f46b9a" class="cell" data-execution_count="241">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[df[<span class="st">'product'</span>] <span class="op">==</span> <span class="st">'01.1.1'</span>, <span class="st">'quantity'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'product'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[241], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(df<span style="color:rgb(98,98,98)">.</span>loc[<span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">product</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span> <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">01.1.1</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">quantity</span><span style="color:rgb(175,0,0)">'</span>])

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'product'</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Select the data from the “store” and “price” columns for all rows.</li>
</ul>
<div id="b7b3fe00" class="cell" data-execution_count="242">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="060c81df" class="cell" data-execution_count="243">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[:, [<span class="st">'store'</span>, <span class="st">'price'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[243], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">df</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">loc</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">store</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">price</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">]</span>)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1184</span>, in <span class="ansi-cyan-fg">_LocationIndexer.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   1182</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_is_scalar_access(key):
<span class="ansi-green-fg ansi-bold">   1183</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>obj<span style="color:rgb(98,98,98)">.</span>_get_value(<span style="color:rgb(98,98,98)">*</span>key, takeable<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_takeable)
<span class="ansi-green-fg">-&gt; 1184</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_tuple</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1185</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">   1186</span>     <span style="font-style:italic;color:rgb(95,135,135)"># we by definition only have the 0th axis</span>
<span class="ansi-green-fg ansi-bold">   1187</span>     axis <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>axis <span style="font-weight:bold;color:rgb(175,0,255)">or</span> <span style="color:rgb(98,98,98)">0</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1377</span>, in <span class="ansi-cyan-fg">_LocIndexer._getitem_tuple</span><span class="ansi-blue-fg">(self, tup)</span>
<span class="ansi-green-fg ansi-bold">   1374</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_multi_take_opportunity(tup):
<span class="ansi-green-fg ansi-bold">   1375</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_multi_take(tup)
<span class="ansi-green-fg">-&gt; 1377</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_tuple_same_dim</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">tup</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1020</span>, in <span class="ansi-cyan-fg">_LocationIndexer._getitem_tuple_same_dim</span><span class="ansi-blue-fg">(self, tup)</span>
<span class="ansi-green-fg ansi-bold">   1017</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> com<span style="color:rgb(98,98,98)">.</span>is_null_slice(key):
<span class="ansi-green-fg ansi-bold">   1018</span>     <span style="font-weight:bold;color:rgb(0,135,0)">continue</span>
<span class="ansi-green-fg">-&gt; 1020</span> retval <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">getattr</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">retval</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">name</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_axis</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">i</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1021</span> <span style="font-style:italic;color:rgb(95,135,135)"># We should never have retval.ndim &lt; self.ndim, as that should</span>
<span class="ansi-green-fg ansi-bold">   1022</span> <span style="font-style:italic;color:rgb(95,135,135)">#  be handled by the _getitem_lowerdim call above.</span>
<span class="ansi-green-fg ansi-bold">   1023</span> <span style="font-weight:bold;color:rgb(0,135,0)">assert</span> retval<span style="color:rgb(98,98,98)">.</span>ndim <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>ndim

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1420</span>, in <span class="ansi-cyan-fg">_LocIndexer._getitem_axis</span><span class="ansi-blue-fg">(self, key, axis)</span>
<span class="ansi-green-fg ansi-bold">   1417</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">hasattr</span>(key, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">ndim</span><span style="color:rgb(175,0,0)">"</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> key<span style="color:rgb(98,98,98)">.</span>ndim <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   1418</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Cannot index with multidimensional key</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg">-&gt; 1420</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_getitem_iterable</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1422</span> <span style="font-style:italic;color:rgb(95,135,135)"># nested tuple slicing</span>
<span class="ansi-green-fg ansi-bold">   1423</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_nested_tuple(key, labels):

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1360</span>, in <span class="ansi-cyan-fg">_LocIndexer._getitem_iterable</span><span class="ansi-blue-fg">(self, key, axis)</span>
<span class="ansi-green-fg ansi-bold">   1357</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_validate_key(key, axis)
<span class="ansi-green-fg ansi-bold">   1359</span> <span style="font-style:italic;color:rgb(95,135,135)"># A collection of keys</span>
<span class="ansi-green-fg">-&gt; 1360</span> keyarr, indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_get_listlike_indexer</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1361</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>obj<span style="color:rgb(98,98,98)">.</span>_reindex_with_indexers(
<span class="ansi-green-fg ansi-bold">   1362</span>     {axis: [keyarr, indexer]}, copy<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">True</span>, allow_dups<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">True</span>
<span class="ansi-green-fg ansi-bold">   1363</span> )

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexing.py:1558</span>, in <span class="ansi-cyan-fg">_LocIndexer._get_listlike_indexer</span><span class="ansi-blue-fg">(self, key, axis)</span>
<span class="ansi-green-fg ansi-bold">   1555</span> ax <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>obj<span style="color:rgb(98,98,98)">.</span>_get_axis(axis)
<span class="ansi-green-fg ansi-bold">   1556</span> axis_name <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>obj<span style="color:rgb(98,98,98)">.</span>_get_axis_name(axis)
<span class="ansi-green-fg">-&gt; 1558</span> keyarr, indexer <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ax</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_get_indexer_strict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis_name</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1560</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> keyarr, indexer

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:6200</span>, in <span class="ansi-cyan-fg">Index._get_indexer_strict</span><span class="ansi-blue-fg">(self, key, axis_name)</span>
<span class="ansi-green-fg ansi-bold">   6197</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">   6198</span>     keyarr, indexer, new_indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_reindex_non_unique(keyarr)
<span class="ansi-green-fg">-&gt; 6200</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_raise_if_missing</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">keyarr</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">indexer</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis_name</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   6202</span> keyarr <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>take(indexer)
<span class="ansi-green-fg ansi-bold">   6203</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(key, Index):
<span class="ansi-green-fg ansi-bold">   6204</span>     <span style="font-style:italic;color:rgb(95,135,135)"># GH 42790 - Preserve name from an Index</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:6249</span>, in <span class="ansi-cyan-fg">Index._raise_if_missing</span><span class="ansi-blue-fg">(self, key, indexer, axis_name)</span>
<span class="ansi-green-fg ansi-bold">   6247</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> nmissing:
<span class="ansi-green-fg ansi-bold">   6248</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> nmissing <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(0,135,0)">len</span>(indexer):
<span class="ansi-green-fg">-&gt; 6249</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">None of [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>key<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">] are in the [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>axis_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">]</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">   6251</span>     not_found <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(ensure_index(key)[missing_mask<span style="color:rgb(98,98,98)">.</span>nonzero()[<span style="color:rgb(98,98,98)">0</span>]]<span style="color:rgb(98,98,98)">.</span>unique())
<span class="ansi-green-fg ansi-bold">   6252</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>not_found<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> not in index</span><span style="color:rgb(175,0,0)">"</span>)

<span class="ansi-red-fg">KeyError</span>: "None of [Index(['store', 'price'], dtype='object')] are in the [columns]"</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Select the rows where the purchased quantity is greater than 5.</li>
</ul>
<div id="079e936f" class="cell" data-execution_count="244">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="9bf4cd40" class="cell" data-execution_count="245">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[df[<span class="st">'quantity'</span>] <span class="op">&gt;</span> <span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'quantity'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[245], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(df<span style="color:rgb(98,98,98)">.</span>loc[<span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">quantity</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span> <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">5</span>])

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'quantity'</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Filter to select all transactions that occurred after 3 PM.</li>
</ul>
<div id="11a9e6f0" class="cell" data-execution_count="246">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="ed8c4cd7" class="cell" data-execution_count="247">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[df[<span class="st">'date_time'</span>].dt.hour <span class="op">&gt;</span> <span class="dv">15</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'date_time'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[247], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(df<span style="color:rgb(98,98,98)">.</span>loc[<span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">date_time</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span style="color:rgb(98,98,98)">.</span>dt<span style="color:rgb(98,98,98)">.</span>hour <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">15</span>])

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'date_time'</pre>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Select the transactions that took place on “2022-01-03”.</li>
</ul>
<div id="37e23422" class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="1e3e8946" class="cell" data-execution_count="249">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[df[<span class="st">'date_time'</span>].dt.date <span class="op">==</span> pd.to_datetime(<span class="st">'2022-01-03'</span>).date()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'date_time'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[249], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(0,135,0)">print</span>(df<span style="color:rgb(98,98,98)">.</span>loc[<span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">date_time</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span style="color:rgb(98,98,98)">.</span>dt<span style="color:rgb(98,98,98)">.</span>date <span style="color:rgb(98,98,98)">==</span> pd<span style="color:rgb(98,98,98)">.</span>to_datetime(<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">2022-01-03</span><span style="color:rgb(175,0,0)">'</span>)<span style="color:rgb(98,98,98)">.</span>date()])

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'date_time'</pre>
</div>
</div>
</div>
</details>
</div>
</section>
<section id="exploring-the-first-names-file" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-first-names-file">Exploring the first names file</h3>
<p>The first names file contains data on the first names given to children born in France between 1900 and 2021. This data is available at the national, department, and regional levels at the following address: <a href="https://www.insee.fr/fr/statistiques/2540004?sommaire=4767262">https://www.insee.fr/fr/statistiques/2540004?sommaire=4767262</a>. The goal of this tutorial is to propose an analysis of this file, from data cleaning to first name statistics.</p>
<section id="part-1-import-and-data-exploration" class="level4">
<h4 class="anchored" data-anchor-id="part-1-import-and-data-exploration">Part 1: Import and data exploration</h4>
<ul>
<li>Import the data into a DataFrame using this <a href="https://www.insee.fr/fr/statistiques/fichier/2540004/nat2021_csv.zip">URL</a>.</li>
<li>View a sample of the data. Do you notice any anomalies?</li>
<li>Display the main information about the DataFrame. Identify any variables with incorrect types or any missing values.</li>
</ul>
<div id="fffd4dd4" class="cell" data-execution_count="250">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="fd798219" class="cell" data-execution_count="251">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.insee.fr/fr/statistiques/fichier/2540004/nat2021_csv.zip"</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>df_first_names <span class="op">=</span> pd.read_csv(url, sep<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>df_first_names.head(<span class="dv">10</span>)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>df_first_names.sample(n<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>df_first_names.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 686538 entries, 0 to 686537
Data columns (total 4 columns):
 #   Column    Non-Null Count   Dtype 
---  ------    --------------   ----- 
 0   sexe      686538 non-null  int64 
 1   preusuel  686536 non-null  object
 2   annais    686538 non-null  object
 3   nombre    686538 non-null  int64 
dtypes: int64(2), object(2)
memory usage: 21.0+ MB</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="part-2-data-cleaning" class="level4">
<h4 class="anchored" data-anchor-id="part-2-data-cleaning">Part 2: Data cleaning</h4>
<ul>
<li>The output of the <code>info()</code> method suggests missing values in the first names column. Display these rows. Verify that these missing values are correctly specified.</li>
<li>The output of the <code>head()</code> method shows a recurring “_PRENOMS_RARES” modality in the first names column. What proportion of the individuals in the database does this represent? Convert these values to <code>np.nan</code>.</li>
</ul>
<div id="63d11953" class="cell" data-execution_count="252">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="c9a01027" class="cell" data-execution_count="253">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_first_names[df_first_names[<span class="st">"preusuel"</span>].isna()])</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>prop_rares <span class="op">=</span> df_first_names.groupby(<span class="st">"preusuel"</span>)[<span class="st">"nombre"</span>].<span class="bu">sum</span>()[<span class="st">"_PRENOMS_RARES"</span>] <span class="op">/</span> df_first_names[<span class="st">"nombre"</span>].<span class="bu">sum</span>()</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prop_rares)  <span class="co"># ~ 2% of the database</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>df_first_names <span class="op">=</span> df_first_names.replace(<span class="st">'_PRENOMS_RARES'</span>, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        sexe preusuel annais  nombre
579411     2      NaN   2003       3
579412     2      NaN   XXXX      29
0.01965912697163539</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>We notice that the first names of people whose year of birth is unknown are grouped under the “XXXX” modality. What proportion of the individuals in the database does this represent? Convert these values to <code>np.nan</code>.</li>
</ul>
<div id="f974d77e" class="cell" data-execution_count="254">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="79826305" class="cell" data-execution_count="255">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>prop_xxxx <span class="op">=</span> df_first_names.groupby(<span class="st">"annais"</span>)[<span class="st">"nombre"</span>].<span class="bu">sum</span>()[<span class="st">"XXXX"</span>] <span class="op">/</span> df_first_names[<span class="st">"nombre"</span>].<span class="bu">sum</span>()</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prop_xxxx)  <span class="co"># ~ 1% of the database</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>df_first_names <span class="op">=</span> df_first_names.replace(<span class="st">'XXXX'</span>, np.nan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.010007438242954967</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Remove the rows containing missing values from the sample.</li>
</ul>
<div id="5bc72cc5" class="cell" data-execution_count="256">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="0b1d9163" class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>df_first_names <span class="op">=</span> df_first_names.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<ul>
<li>Convert the <code>annais</code> column to numeric type and the <code>sexe</code> column to categorical type.</li>
</ul>
<div id="0e7e2f6e" class="cell" data-execution_count="258">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="fe785866" class="cell" data-execution_count="259">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>df_first_names[<span class="st">'annais'</span>] <span class="op">=</span> pd.to_numeric(df_first_names[<span class="st">'annais'</span>])</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>df_first_names[<span class="st">'sexe'</span>] <span class="op">=</span> df_first_names[<span class="st">'sexe'</span>].astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<ul>
<li>Verify with the <code>info()</code> method that the cleaning has been correctly applied.</li>
</ul>
<div id="baba092b" class="cell" data-execution_count="260">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="7557251d" class="cell" data-execution_count="261">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>df_first_names.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 648369 entries, 122 to 686536
Data columns (total 4 columns):
 #   Column    Non-Null Count   Dtype   
---  ------    --------------   -----   
 0   sexe      648369 non-null  category
 1   preusuel  648369 non-null  object  
 2   annais    648369 non-null  int64   
 3   nombre    648369 non-null  int64   
dtypes: category(1), int64(2), object(1)
memory usage: 20.4+ MB</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="part-3-descriptive-statistics-on-births" class="level4">
<h4 class="anchored" data-anchor-id="part-3-descriptive-statistics-on-births">Part 3: Descriptive statistics on births</h4>
<ul>
<li>The <a href="https://www.insee.fr/fr/statistiques/2540004?sommaire=4767262#documentation">documentation</a> of the file informs us that the data can be considered quasi-exhaustive from 1946 onwards. For this part only, filter the data to keep only data from 1946 onwards.</li>
</ul>
<div id="7bf57212" class="cell" data-execution_count="262">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="adaee083" class="cell" data-execution_count="263">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>df_first_names_post_1946 <span class="op">=</span> df_first_names[df_first_names[<span class="st">"annais"</span>] <span class="op">&gt;=</span> <span class="dv">1946</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<ul>
<li>Calculate the total number of births by sex.</li>
</ul>
<div id="2144026b" class="cell" data-execution_count="264">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="d777ed29" class="cell" data-execution_count="265">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>births_per_sex <span class="op">=</span> df_first_names_post_1946.groupby(<span class="st">'sexe'</span>)[<span class="st">'nombre'</span>].<span class="bu">sum</span>()</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(births_per_sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sexe
1    30872950
2    29314697
Name: nombre, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_3473/4076629916.py:1: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  births_per_sex = df_first_names_post_1946.groupby('sexe')['nombre'].sum()</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Identify the five years with the highest number of births.</li>
</ul>
<div id="be646b3c" class="cell" data-execution_count="266">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="5ca3c005" class="cell" data-execution_count="267">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>top5_years <span class="op">=</span> df_first_names_post_1946.groupby(<span class="st">'annais'</span>)[<span class="st">'nombre'</span>].<span class="bu">sum</span>().nlargest(<span class="dv">5</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top5_years)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>annais
1964    902522
1971    899440
1972    893901
1963    893425
1949    890585
Name: nombre, dtype: int64</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="part-4-first-name-analysis" class="level4">
<h4 class="anchored" data-anchor-id="part-4-first-name-analysis">Part 4: First name analysis</h4>
<ul>
<li>Identify the total number of unique first names in the DataFrame.</li>
</ul>
<div id="1daa914a" class="cell" data-execution_count="268">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="baad09ae" class="cell" data-execution_count="269">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>total_unique_names <span class="op">=</span> df_first_names[<span class="st">'preusuel'</span>].nunique()</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_unique_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>34175</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Count the number of people with a single-letter first name.</li>
</ul>
<div id="37bc824b" class="cell" data-execution_count="270">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="9c338c52" class="cell" data-execution_count="271">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>single_letter_names <span class="op">=</span> df_first_names[df_first_names[<span class="st">'preusuel'</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">==</span> <span class="dv">1</span>][<span class="st">'nombre'</span>].<span class="bu">sum</span>()</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(single_letter_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>209</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Create a “popularity function” that, for a given first name, displays the year it was most given and the number of times it was given that year.</li>
</ul>
<div id="1b475cea" class="cell" data-execution_count="272">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="da8cca8f" class="cell" data-execution_count="273">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> popularity_by_year(df, first_name):</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame to keep only the rows corresponding to the given first name</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    df_first_name <span class="op">=</span> df[df[<span class="st">'preusuel'</span>] <span class="op">==</span> first_name]</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by year, sum the births, and identify the year with the maximum births</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>    df_agg <span class="op">=</span> df_first_name.groupby(<span class="st">'annais'</span>)[<span class="st">'nombre'</span>].<span class="bu">sum</span>()</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>    max_year <span class="op">=</span> df_agg.idxmax()</span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>    max_n <span class="op">=</span> df_agg[max_year]</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The first name '</span><span class="sc">{</span>first_name<span class="sc">}</span><span class="ss">' was most given in </span><span class="sc">{</span>max_year<span class="sc">}</span><span class="ss">, with </span><span class="sc">{</span>max_n<span class="sc">}</span><span class="ss"> births."</span>)</span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the function with an example</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>popularity_by_year(df_first_names, <span class="st">'ALFRED'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The first name 'ALFRED' was most given in 1910, with 1994 births.</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Create a function that, for a given sex, returns a DataFrame containing the most given first name for each decade.</li>
</ul>
<div id="67a87d18" class="cell" data-execution_count="274">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a> your answer <span class="kw">in</span> this cell</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">  Cell </span><span class="ansi-green-fg">In[274], line 3</span>
<span class="ansi-red-fg">    your answer in this cell</span>
    ^
<span class="ansi-red-fg">IndentationError</span><span class="ansi-red-fg">:</span> unexpected indent
</pre>
</div>
</div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="9901fccc" class="cell" data-execution_count="275">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> popularity_by_decade(df, sex):</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by sex</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    df_sub <span class="op">=</span> df[df[<span class="st">"sexe"</span>] <span class="op">==</span> sex]</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the decade variable</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    df_sub[<span class="st">"decade"</span>] <span class="op">=</span> (df_sub[<span class="st">"annais"</span>] <span class="op">//</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the sum of births for each first name and each decade</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>    df_counts_decade <span class="op">=</span> df_sub.groupby([<span class="st">"preusuel"</span>, <span class="st">"decade"</span>])[<span class="st">"nombre"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the most frequent first name for each decade</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> df_counts_decade.groupby(<span class="st">"decade"</span>)[<span class="st">"nombre"</span>].idxmax()</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the index to obtain the corresponding rows from the df_counts_decade DataFrame</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>    df_popularity_decade <span class="op">=</span> df_counts_decade.loc[idx].set_index(<span class="st">"decade"</span>)</span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_popularity_decade</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the function with an example</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>popularity_by_decade(df_first_names, sex<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_3473/171210111.py:6: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_sub["decade"] = (df_sub["annais"] // 10) * 10</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="275">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">preusuel</th>
<th data-quarto-table-cell-role="th">nombre</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">decade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1900</td>
<td>MARIE</td>
<td>490609</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1910</td>
<td>MARIE</td>
<td>329246</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1920</td>
<td>MARIE</td>
<td>322486</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1930</td>
<td>MARIE</td>
<td>247784</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1940</td>
<td>MARIE</td>
<td>265690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1950</td>
<td>MARIE</td>
<td>217042</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1960</td>
<td>SYLVIE</td>
<td>204773</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1970</td>
<td>SANDRINE</td>
<td>146395</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1980</td>
<td>AURÉLIE</td>
<td>113344</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1990</td>
<td>LAURA</td>
<td>70049</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000</td>
<td>LÉA</td>
<td>77504</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010</td>
<td>EMMA</td>
<td>49094</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020</td>
<td>JADE</td>
<td>7618</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="calculation-of-a-carbon-footprint-per-inhabitant-at-the-municipal-level" class="level3">
<h3 class="anchored" data-anchor-id="calculation-of-a-carbon-footprint-per-inhabitant-at-the-municipal-level">Calculation of a carbon footprint per inhabitant at the municipal level</h3>
<p>The goal of this exercise is to calculate a carbon footprint per inhabitant at the municipal level. To do this, we will need to combine two data sources:</p>
<ul>
<li><p>Legal populations at the municipal level from the population census (<a href="https://www.insee.fr/fr/statistiques/6683037">source</a>)</p></li>
<li><p>Greenhouse gas emissions estimated at the municipal level by ADEME (<a href="https://www.data.gouv.fr/fr/datasets/inventaire-de-gaz-a-effet-de-serre-territorialise/#_">source</a>)</p></li>
</ul>
<p>This exercise constitutes a simplified version of a <a href="https://pythonds.linogaliana.fr/content/manipulation/02b_pandas_TP.html#importer-les-donn%C3%A9es">complete practical exercise on Pandas</a> proposed by Lino Galiana in his <a href="https://pythonds.linogaliana.fr/">course at ENSAE</a>.</p>
<section id="part-1-exploring-the-legal-municipal-populations-data" class="level4">
<h4 class="anchored" data-anchor-id="part-1-exploring-the-legal-municipal-populations-data">Part 1: Exploring the legal municipal populations data</h4>
<ul>
<li>Import the CSV file <code>communes.csv</code>.</li>
<li>Use the <code>.sample()</code>, <code>.info()</code>, and <code>.describe()</code> methods to get an overview of the data.</li>
</ul>
<div id="cb2abeaf" class="cell" data-execution_count="276">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="dbdd1ca5" class="cell" data-execution_count="277">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>df_pop_communes <span class="op">=</span> pd.read_csv(<span class="st">"data/communes.csv"</span>, sep<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>df_pop_communes.sample(<span class="dv">10</span>)</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>df_pop_communes.info()</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>df_pop_communes.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 34995 entries, 0 to 34994
Data columns (total 5 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   DEPCOM  34995 non-null  object
 1   COM     34995 non-null  object
 2   PMUN    34995 non-null  int64 
 3   PCAP    34995 non-null  int64 
 4   PTOT    34995 non-null  int64 
dtypes: int64(3), object(2)
memory usage: 1.3+ MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="277">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PMUN</th>
<th data-quarto-table-cell-role="th">PCAP</th>
<th data-quarto-table-cell-role="th">PTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>34995.000000</td>
<td>34995.000000</td>
<td>34995.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1900.966967</td>
<td>35.340849</td>
<td>1936.307815</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>8583.400244</td>
<td>133.285462</td>
<td>8696.358429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>199.000000</td>
<td>4.000000</td>
<td>203.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>457.000000</td>
<td>9.000000</td>
<td>468.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1159.000000</td>
<td>24.000000</td>
<td>1184.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>479553.000000</td>
<td>5256.000000</td>
<td>484809.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
<ul>
<li>Identify and remove rows corresponding to municipalities without population.</li>
<li>Remove the “PMUN” and “PCAP” columns, which are irrelevant for the analysis.</li>
</ul>
<div id="26e7e9e4" class="cell" data-execution_count="278">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="b0470631" class="cell" data-execution_count="279">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>n_communes_0_pop <span class="op">=</span> df_pop_communes[df_pop_communes[<span class="st">"PTOT"</span>] <span class="op">==</span> <span class="dv">0</span>].shape[<span class="dv">0</span>]</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(n_communes_0_pop)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>df_pop_communes <span class="op">=</span> df_pop_communes[df_pop_communes[<span class="st">"PTOT"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>df_pop_communes <span class="op">=</span> df_pop_communes.drop(columns<span class="op">=</span>[<span class="st">"PMUN"</span>, <span class="st">"PCAP"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6</code></pre>
</div>
</div>
</details>
</div>
<p>Do the municipalities with the longest names also have the smallest populations? To find out: - Create a new variable that contains the number of characters of each municipality using the <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.len.html">str.len()</a> method. - Calculate the correlation between this variable and the total population using the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.corr.html">corr()</a> method.</p>
<div id="0ae5f013" class="cell" data-execution_count="280">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="545ae0b8" class="cell" data-execution_count="281">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>df_pop_communes_stats <span class="op">=</span> df_pop_communes.copy()</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>df_pop_communes_stats[<span class="st">'length'</span>] <span class="op">=</span> df_pop_communes_stats[<span class="st">'COM'</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>df_pop_communes_stats[<span class="st">'length'</span>].corr(df_pop_communes_stats[<span class="st">'PTOT'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="281">
<pre><code>np.float64(0.0037878701156295307)</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="part-2-exploring-the-municipal-emissions-data" class="level4">
<h4 class="anchored" data-anchor-id="part-2-exploring-the-municipal-emissions-data">Part 2: Exploring the municipal emissions data</h4>
<ul>
<li>Import the emissions data from this <a href="https://data.ademe.fr/data-fair/api/v1/datasets/igt-pouvoir-de-rechauffement-global/data-files/IGT%20-%20Pouvoir%20de%20r%C3%A9chauffement%20global.csv">URL</a>.</li>
<li>Use the <code>.sample()</code>, <code>.info()</code>, and <code>.describe()</code> methods to get an overview of the data.</li>
</ul>
<div id="84f4e5cd" class="cell" data-execution_count="282">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="000430ae" class="cell" data-execution_count="283">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>url_ademe <span class="op">=</span> <span class="st">"https://data.ademe.fr/data-fair/api/v1/datasets/igt-pouvoir-de-rechauffement-global/data-files/IGT%20-%20Pouvoir</span><span class="sc">%20d</span><span class="st">e</span><span class="sc">%20r</span><span class="st">%C3%A9chauffement</span><span class="sc">%20g</span><span class="st">lobal.csv"</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>df_emissions <span class="op">=</span> pd.read_csv(url_ademe)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>df_emissions.sample(<span class="dv">10</span>)</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>df_emissions.info()</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>df_emissions.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 35798 entries, 0 to 35797
Data columns (total 12 columns):
 #   Column                           Non-Null Count  Dtype  
---  ------                           --------------  -----  
 0   INSEE commune                    35798 non-null  object 
 1   Commune                          35798 non-null  object 
 2   Agriculture                      35736 non-null  float64
 3   Autres transports                9979 non-null   float64
 4   Autres transports international  2891 non-null   float64
 5   CO2 biomasse hors-total          35798 non-null  float64
 6   Déchets                          35792 non-null  float64
 7   Energie                          34490 non-null  float64
 8   Industrie hors-énergie           34490 non-null  float64
 9   Résidentiel                      35792 non-null  float64
 10  Routier                          35778 non-null  float64
 11  Tertiaire                        35798 non-null  float64
dtypes: float64(10), object(2)
memory usage: 3.3+ MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="283">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>35736.000000</td>
<td>9979.000000</td>
<td>2.891000e+03</td>
<td>35798.000000</td>
<td>35792.000000</td>
<td>3.449000e+04</td>
<td>3.449000e+04</td>
<td>35792.000000</td>
<td>35778.000000</td>
<td>35798.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2459.975760</td>
<td>654.919940</td>
<td>7.692345e+03</td>
<td>1774.381550</td>
<td>410.806329</td>
<td>6.625698e+02</td>
<td>2.423128e+03</td>
<td>1783.677872</td>
<td>3535.501245</td>
<td>1105.165915</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2926.957701</td>
<td>9232.816833</td>
<td>1.137643e+05</td>
<td>7871.341922</td>
<td>4122.472608</td>
<td>2.645571e+04</td>
<td>5.670374e+04</td>
<td>8915.902379</td>
<td>9663.156628</td>
<td>5164.182507</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.003432</td>
<td>0.000204</td>
<td>3.972950e-04</td>
<td>3.758088</td>
<td>0.132243</td>
<td>2.354558e+00</td>
<td>1.052998e+00</td>
<td>1.027266</td>
<td>0.555092</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>797.682631</td>
<td>52.560412</td>
<td>1.005097e+01</td>
<td>197.951108</td>
<td>25.655166</td>
<td>2.354558e+00</td>
<td>6.911213e+00</td>
<td>96.052911</td>
<td>419.700460</td>
<td>94.749885</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1559.381285</td>
<td>106.795928</td>
<td>1.992434e+01</td>
<td>424.849988</td>
<td>54.748653</td>
<td>4.709115e+00</td>
<td>1.382243e+01</td>
<td>227.091193</td>
<td>1070.895593</td>
<td>216.297718</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3007.883903</td>
<td>237.341501</td>
<td>3.298311e+01</td>
<td>1094.749825</td>
<td>110.820941</td>
<td>5.180027e+01</td>
<td>1.520467e+02</td>
<td>749.469293</td>
<td>3098.612157</td>
<td>576.155869</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>98949.317760</td>
<td>513140.971691</td>
<td>3.303394e+06</td>
<td>576394.181208</td>
<td>275500.374439</td>
<td>2.535858e+06</td>
<td>6.765119e+06</td>
<td>410675.902028</td>
<td>586054.672836</td>
<td>288175.400126</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
<ul>
<li>Are there rows with missing values for all emission columns? Check using the <a href="https://pandas.pydata.org/docs/reference/api/pandas.isnull.html">isnull()</a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.all.html">all()</a> methods.</li>
</ul>
<div id="2aa614e0" class="cell" data-execution_count="284">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="a40794d6" class="cell" data-execution_count="285">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>df_emissions_num <span class="op">=</span> df_emissions.select_dtypes([<span class="st">'number'</span>])</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>only_nan <span class="op">=</span> df_emissions_num[df_emissions_num.isnull().<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>only_nan.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="285">
<pre><code>0</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Create a new column that gives the total emissions per municipality.</li>
<li>Display the 10 most emitting municipalities. What do you observe in the results?</li>
</ul>
<div id="ac159060" class="cell" data-execution_count="286">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="61fee731" class="cell" data-execution_count="287">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>df_emissions[<span class="st">'total_emissions'</span>] <span class="op">=</span> df_emissions.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>, numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>df_emissions.sort_values(by<span class="op">=</span><span class="st">"total_emissions"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="287">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">total_emissions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4382</td>
<td>13039</td>
<td>FOS-SUR-MER</td>
<td>305.092893</td>
<td>1893.383189</td>
<td>1.722723e+04</td>
<td>50891.367548</td>
<td>275500.374439</td>
<td>2.296711e+06</td>
<td>6.765119e+06</td>
<td>9466.388806</td>
<td>74631.401993</td>
<td>42068.140058</td>
<td>9.533813e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22671</td>
<td>59183</td>
<td>DUNKERQUE</td>
<td>811.390947</td>
<td>3859.548994</td>
<td>3.327586e+05</td>
<td>71922.181764</td>
<td>23851.780482</td>
<td>1.934988e+06</td>
<td>5.997333e+06</td>
<td>113441.727216</td>
<td>94337.865738</td>
<td>70245.678455</td>
<td>8.643550e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4398</td>
<td>13056</td>
<td>MARTIGUES</td>
<td>855.299300</td>
<td>2712.749275</td>
<td>3.043476e+04</td>
<td>35925.561051</td>
<td>44597.426397</td>
<td>1.363402e+06</td>
<td>2.380185e+06</td>
<td>22530.797276</td>
<td>84624.862481</td>
<td>44394.822725</td>
<td>4.009663e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30560</td>
<td>76476</td>
<td>PORT-JEROME-SUR-SEINE</td>
<td>2736.931327</td>
<td>121.160849</td>
<td>2.086403e+04</td>
<td>22846.964780</td>
<td>78.941581</td>
<td>1.570236e+06</td>
<td>2.005643e+06</td>
<td>21072.566129</td>
<td>9280.824961</td>
<td>15270.357772</td>
<td>3.668151e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31108</td>
<td>77291</td>
<td>LE MESNIL-AMELOT</td>
<td>782.183307</td>
<td>133834.090767</td>
<td>3.303394e+06</td>
<td>3330.404124</td>
<td>111.613197</td>
<td>8.240952e+02</td>
<td>2.418925e+03</td>
<td>1404.400153</td>
<td>11712.541682</td>
<td>13680.471909</td>
<td>3.471492e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31099</td>
<td>77282</td>
<td>MAUREGARD</td>
<td>733.910161</td>
<td>133699.072712</td>
<td>3.303394e+06</td>
<td>193.323752</td>
<td>44.301447</td>
<td>2.354558e+00</td>
<td>6.911213e+00</td>
<td>468.995242</td>
<td>2106.579416</td>
<td>160.309150</td>
<td>3.440809e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30438</td>
<td>76351</td>
<td>LE HAVRE</td>
<td>1168.274940</td>
<td>17358.962736</td>
<td>2.109460e+06</td>
<td>141492.414415</td>
<td>17641.705314</td>
<td>2.653841e+05</td>
<td>4.183445e+05</td>
<td>195864.092574</td>
<td>111174.296228</td>
<td>95695.476436</td>
<td>3.373584e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30428</td>
<td>76341</td>
<td>HARFLEUR</td>
<td>751.297090</td>
<td>157.179958</td>
<td>NaN</td>
<td>10591.477221</td>
<td>67.467130</td>
<td>2.535858e+06</td>
<td>5.107387e+03</td>
<td>8739.638694</td>
<td>29761.043310</td>
<td>5277.162755</td>
<td>2.596310e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31111</td>
<td>77294</td>
<td>MITRY-MORY</td>
<td>1912.746387</td>
<td>89815.529858</td>
<td>2.202275e+06</td>
<td>17540.442778</td>
<td>159.163608</td>
<td>3.510646e+03</td>
<td>1.364685e+04</td>
<td>26418.982148</td>
<td>72891.937473</td>
<td>15163.398499</td>
<td>2.443335e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1987</td>
<td>06088</td>
<td>NICE</td>
<td>305.445236</td>
<td>225204.545951</td>
<td>1.003572e+06</td>
<td>169338.333391</td>
<td>124232.948837</td>
<td>1.186697e+04</td>
<td>3.589365e+04</td>
<td>252857.325855</td>
<td>352836.864314</td>
<td>171766.435376</td>
<td>2.347875e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
<ul>
<li>It seems that the major emission sectors are “Industry excluding energy” and “Other international transport.” To verify if this conjecture holds, calculate the correlation between total emissions and the sectoral emission items using the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.corrwith.html">corrwith()</a> method.</li>
</ul>
<div id="b911c873" class="cell" data-execution_count="288">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="b05b0f56" class="cell" data-execution_count="289">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>df_emissions.corrwith(df_emissions[<span class="st">"total_emissions"</span>], numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="289">
<pre><code>Agriculture                        0.032843
Autres transports                  0.283310
Autres transports international    0.463660
CO2 biomasse hors-total            0.466285
Déchets                            0.409822
Energie                            0.711808
Industrie hors-énergie             0.835432
Résidentiel                        0.444557
Routier                            0.454902
Tertiaire                          0.488895
total_emissions                    1.000000
dtype: float64</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Extract the department number from the municipality code into a new variable.</li>
<li>Calculate the total emissions by department.</li>
<li>Display the top 10 emitting departments. Are the results logical compared to the analysis at the municipal level?</li>
</ul>
<div id="6fdf8f89" class="cell" data-execution_count="290">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="c99723ae" class="cell" data-execution_count="291">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>df_emissions[<span class="st">"dep"</span>] <span class="op">=</span> df_emissions[<span class="st">"INSEE commune"</span>].<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>df_emissions.groupby(<span class="st">"dep"</span>).agg({<span class="st">"total_emissions"</span>: <span class="st">"sum"</span>}).sort_values(by<span class="op">=</span><span class="st">"total_emissions"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="291">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_emissions</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">dep</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>2.657388e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59</td>
<td>2.607500e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>2.159825e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">77</td>
<td>1.818622e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">69</td>
<td>1.250800e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">62</td>
<td>1.207887e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>1.053212e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>1.014781e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">57</td>
<td>1.010131e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>9.352481e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
</section>
<section id="part-3-preliminary-checks-for-merging-data-sources" class="level4">
<h4 class="anchored" data-anchor-id="part-3-preliminary-checks-for-merging-data-sources">Part 3: Preliminary checks for merging data sources</h4>
<p>To perform a merge, it is always preferable to have a join key, i.e., a column common to both sources that uniquely identifies the statistical units. The purpose of this part is to find the relevant join key.</p>
<ul>
<li>Check if the variable containing the municipality names contains duplicates.</li>
</ul>
<div id="9855fa34" class="cell" data-execution_count="292">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="5a0cbb24" class="cell" data-execution_count="293">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>duplicates <span class="op">=</span> df_pop_communes.groupby(<span class="st">'COM'</span>).count()[<span class="st">'DEPCOM'</span>]</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>duplicates <span class="op">=</span> duplicates[duplicates <span class="op">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>duplicates <span class="op">=</span> duplicates.reset_index()</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>duplicates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="293">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COM</th>
<th data-quarto-table-cell-role="th">DEPCOM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abancourt</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Aboncourt</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Abzac</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Achères</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Aiglun</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1451</td>
<td>Étaules</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1452</td>
<td>Éterpigny</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1453</td>
<td>Étréchy</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1454</td>
<td>Étrépilly</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1455</td>
<td>Œuilly</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>1456 rows × 2 columns</p>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Filter in the initial DataFrame the municipalities with duplicated names and sort it by municipality code. Do the duplicates seem problematic?</li>
</ul>
<div id="3018a45e" class="cell" data-execution_count="294">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="ea6f6bb0" class="cell" data-execution_count="295">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>df_pop_communes_duplicates <span class="op">=</span> df_pop_communes[df_pop_communes[<span class="st">"COM"</span>].isin(duplicates[<span class="st">"COM"</span>])]</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>df_pop_communes_duplicates.sort_values(<span class="st">'COM'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="295">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEPCOM</th>
<th data-quarto-table-cell-role="th">COM</th>
<th data-quarto-table-cell-role="th">PTOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">22473</td>
<td>60001</td>
<td>Abancourt</td>
<td>659</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21825</td>
<td>59001</td>
<td>Abancourt</td>
<td>476</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20791</td>
<td>57001</td>
<td>Aboncourt</td>
<td>354</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19453</td>
<td>54003</td>
<td>Aboncourt</td>
<td>105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12327</td>
<td>33001</td>
<td>Abzac</td>
<td>1963</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34450</td>
<td>91226</td>
<td>Étréchy</td>
<td>6634</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30189</td>
<td>77173</td>
<td>Étrépilly</td>
<td>899</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">680</td>
<td>02297</td>
<td>Étrépilly</td>
<td>119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1192</td>
<td>02565</td>
<td>Œuilly</td>
<td>293</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18782</td>
<td>51410</td>
<td>Œuilly</td>
<td>658</td>
</tr>
</tbody>
</table>

<p>3720 rows × 3 columns</p>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Verify that the municipality codes uniquely identify the associated municipality.</li>
</ul>
<div id="19977a91" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="2e636ed7" class="cell" data-execution_count="297">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>(df_pop_communes_duplicates.groupby(<span class="st">"DEPCOM"</span>)[<span class="st">"COM"</span>].nunique() <span class="op">!=</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="297">
<pre><code>np.int64(0)</code></pre>
</div>
</div>
</details>
</div>
<ul>
<li>Display the municipalities present in the population data but not in the emissions data, and vice versa. What do you conclude?</li>
</ul>
<div id="a149a5d3" class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="29232b88" class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observations in the population data but not in the emissions data</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>df_pop_communes[<span class="op">~</span>df_pop_communes[<span class="st">"DEPCOM"</span>].isin(df_emissions[<span class="st">"INSEE commune"</span>])]</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Observations in the emissions data but not in the population data</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>df_emissions[<span class="op">~</span>df_emissions[<span class="st">"INSEE commune"</span>].isin(df_pop_communes[<span class="st">"DEPCOM"</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">total_emissions</th>
<th data-quarto-table-cell-role="th">dep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">53</td>
<td>01059</td>
<td>BRENAZ</td>
<td>2059.625278</td>
<td>NaN</td>
<td>NaN</td>
<td>97.460907</td>
<td>60.369788</td>
<td>2.354558</td>
<td>6.911213</td>
<td>37.806309</td>
<td>442.992259</td>
<td>43.546665</td>
<td>2751.066976</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">83</td>
<td>01091</td>
<td>CHATILLON-EN-MICHAILLE</td>
<td>2716.023992</td>
<td>154.607070</td>
<td>NaN</td>
<td>4479.397305</td>
<td>26.211975</td>
<td>489.748010</td>
<td>1437.532377</td>
<td>2884.723545</td>
<td>24426.607714</td>
<td>2852.127766</td>
<td>39466.979755</td>
<td>01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">89</td>
<td>01097</td>
<td>CHAVORNAY</td>
<td>502.135035</td>
<td>NaN</td>
<td>NaN</td>
<td>119.257319</td>
<td>28.696758</td>
<td>2.354558</td>
<td>6.911213</td>
<td>90.061423</td>
<td>187.213742</td>
<td>103.842046</td>
<td>1040.472094</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">112</td>
<td>01122</td>
<td>CORMARANCHE-EN-BUGEY</td>
<td>1020.579097</td>
<td>NaN</td>
<td>NaN</td>
<td>548.434440</td>
<td>134.359486</td>
<td>35.318366</td>
<td>103.668200</td>
<td>323.757897</td>
<td>1147.594565</td>
<td>383.306355</td>
<td>3697.018406</td>
<td>01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">130</td>
<td>01144</td>
<td>DOMMARTIN</td>
<td>3514.482852</td>
<td>NaN</td>
<td>NaN</td>
<td>524.037265</td>
<td>159.287551</td>
<td>NaN</td>
<td>NaN</td>
<td>348.829080</td>
<td>1529.911692</td>
<td>422.067671</td>
<td>6498.616112</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35189</td>
<td>89484</td>
<td>VOLGRE</td>
<td>383.961261</td>
<td>NaN</td>
<td>NaN</td>
<td>954.348314</td>
<td>46.681823</td>
<td>NaN</td>
<td>NaN</td>
<td>424.365746</td>
<td>10724.104395</td>
<td>168.922776</td>
<td>12702.384315</td>
<td>89</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35262</td>
<td>90073</td>
<td>MOVAL</td>
<td>281.860724</td>
<td>57.129390</td>
<td>NaN</td>
<td>576.938906</td>
<td>56.600057</td>
<td>2.354558</td>
<td>6.911213</td>
<td>295.469174</td>
<td>1439.904381</td>
<td>205.016539</td>
<td>2922.184943</td>
<td>90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35348</td>
<td>91182</td>
<td>COURCOURONNES</td>
<td>24.548795</td>
<td>103.360309</td>
<td>NaN</td>
<td>9623.065698</td>
<td>111.241872</td>
<td>1276.170296</td>
<td>3745.877636</td>
<td>9978.002088</td>
<td>57834.224552</td>
<td>10532.120761</td>
<td>93228.612007</td>
<td>91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35360</td>
<td>91222</td>
<td>ESTOUCHES</td>
<td>1790.002871</td>
<td>NaN</td>
<td>NaN</td>
<td>113.797978</td>
<td>30.548162</td>
<td>2.354558</td>
<td>6.911213</td>
<td>71.011704</td>
<td>523.293194</td>
<td>110.541533</td>
<td>2648.461213</td>
<td>91</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35687</td>
<td>95259</td>
<td>GADANCOURT</td>
<td>312.298700</td>
<td>NaN</td>
<td>NaN</td>
<td>142.113291</td>
<td>11.372909</td>
<td>NaN</td>
<td>NaN</td>
<td>32.440647</td>
<td>2060.981036</td>
<td>41.153991</td>
<td>2600.360573</td>
<td>95</td>
</tr>
</tbody>
</table>

<p>922 rows × 14 columns</p>
</div>
</div>
</div>
</details>
</div>
</section>
<section id="part-4-calculating-a-carbon-footprint-per-inhabitant-for-each-municipality" class="level4">
<h4 class="anchored" data-anchor-id="part-4-calculating-a-carbon-footprint-per-inhabitant-for-each-municipality">Part 4: Calculating a carbon footprint per inhabitant for each municipality</h4>
<ul>
<li>Merge the two DataFrames using the municipality code as the join key. Note: the variables are not named the same on both sides!</li>
</ul>
<div id="4dcda2ba" class="cell" data-execution_count="300">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="18949c6b" class="cell" data-execution_count="301">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>df_emissions_pop <span class="op">=</span> pd.merge(df_pop_communes</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>, df_emissions, how<span class="op">=</span><span class="st">"inner"</span>, left_on<span class="op">=</span><span class="st">"DEPCOM"</span>, right_on<span class="op">=</span><span class="st">"INSEE commune"</span>)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>df_emissions_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="301">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEPCOM</th>
<th data-quarto-table-cell-role="th">COM</th>
<th data-quarto-table-cell-role="th">PTOT</th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">total_emissions</th>
<th data-quarto-table-cell-role="th">dep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L' Abergement-Clémenciat</td>
<td>794</td>
<td>01001</td>
<td>L'ABERGEMENT-CLEMENCIAT</td>
<td>3711.425991</td>
<td>NaN</td>
<td>NaN</td>
<td>432.751835</td>
<td>101.430476</td>
<td>2.354558</td>
<td>6.911213</td>
<td>309.358195</td>
<td>793.156501</td>
<td>367.036172</td>
<td>5724.424941</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L' Abergement-de-Varey</td>
<td>249</td>
<td>01002</td>
<td>L'ABERGEMENT-DE-VAREY</td>
<td>475.330205</td>
<td>NaN</td>
<td>NaN</td>
<td>140.741660</td>
<td>140.675439</td>
<td>2.354558</td>
<td>6.911213</td>
<td>104.866444</td>
<td>348.997893</td>
<td>112.934207</td>
<td>1332.811619</td>
<td>01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>14428</td>
<td>01004</td>
<td>AMBERIEU-EN-BUGEY</td>
<td>499.043526</td>
<td>212.577908</td>
<td>NaN</td>
<td>10313.446515</td>
<td>5314.314445</td>
<td>998.332482</td>
<td>2930.354461</td>
<td>16616.822534</td>
<td>15642.420313</td>
<td>10732.376934</td>
<td>63259.689119</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>Ambérieux-en-Dombes</td>
<td>1723</td>
<td>01005</td>
<td>AMBERIEUX-EN-DOMBES</td>
<td>1859.160954</td>
<td>NaN</td>
<td>NaN</td>
<td>1144.429311</td>
<td>216.217508</td>
<td>94.182310</td>
<td>276.448534</td>
<td>663.683146</td>
<td>1756.341319</td>
<td>782.404357</td>
<td>6792.867439</td>
<td>01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>Ambléon</td>
<td>117</td>
<td>01006</td>
<td>AMBLEON</td>
<td>448.966808</td>
<td>NaN</td>
<td>NaN</td>
<td>77.033834</td>
<td>48.401549</td>
<td>NaN</td>
<td>NaN</td>
<td>43.714019</td>
<td>398.786800</td>
<td>51.681756</td>
<td>1068.584766</td>
<td>01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34871</td>
<td>95676</td>
<td>Villers-en-Arthies</td>
<td>513</td>
<td>95676</td>
<td>VILLERS-EN-ARTHIES</td>
<td>1628.065094</td>
<td>NaN</td>
<td>NaN</td>
<td>165.045396</td>
<td>65.063617</td>
<td>11.772789</td>
<td>34.556067</td>
<td>176.098160</td>
<td>309.627908</td>
<td>235.439109</td>
<td>2625.668140</td>
<td>95</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34872</td>
<td>95678</td>
<td>Villiers-Adam</td>
<td>870</td>
<td>95678</td>
<td>VILLIERS-ADAM</td>
<td>698.630772</td>
<td>NaN</td>
<td>NaN</td>
<td>1331.126598</td>
<td>111.480954</td>
<td>2.354558</td>
<td>6.911213</td>
<td>1395.529811</td>
<td>18759.370071</td>
<td>403.404815</td>
<td>22708.808792</td>
<td>95</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34873</td>
<td>95680</td>
<td>Villiers-le-Bel</td>
<td>27808</td>
<td>95680</td>
<td>VILLIERS-LE-BEL</td>
<td>107.564967</td>
<td>NaN</td>
<td>NaN</td>
<td>8367.174532</td>
<td>225.622903</td>
<td>534.484607</td>
<td>1568.845431</td>
<td>22613.830247</td>
<td>12217.122402</td>
<td>13849.512001</td>
<td>59484.157091</td>
<td>95</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34874</td>
<td>95682</td>
<td>Villiers-le-Sec</td>
<td>188</td>
<td>95682</td>
<td>VILLIERS-LE-SEC</td>
<td>1090.890170</td>
<td>NaN</td>
<td>NaN</td>
<td>326.748418</td>
<td>108.969749</td>
<td>2.354558</td>
<td>6.911213</td>
<td>67.235487</td>
<td>4663.232127</td>
<td>85.657725</td>
<td>6351.999447</td>
<td>95</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34875</td>
<td>95690</td>
<td>Wy-dit-Joli-Village</td>
<td>340</td>
<td>95690</td>
<td>WY-DIT-JOLI-VILLAGE</td>
<td>1495.103542</td>
<td>NaN</td>
<td>NaN</td>
<td>125.236417</td>
<td>97.728612</td>
<td>4.709115</td>
<td>13.822427</td>
<td>117.450851</td>
<td>504.400972</td>
<td>147.867245</td>
<td>2506.319181</td>
<td>95</td>
</tr>
</tbody>
</table>

<p>34876 rows × 17 columns</p>
</div>
</div>
</div>
</details>
</div>
<ul>
<li>Calculate a carbon footprint for each municipality, corresponding to the total emissions of the municipality divided by its total population.</li>
<li>Display the top 10 municipalities with the highest carbon footprints.</li>
<li>Are the results the same as those with total emissions? What do you conclude?</li>
</ul>
<div id="c9ac939e" class="cell" data-execution_count="302">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="ae37de92" class="cell" data-execution_count="303">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>df_emissions_pop[<span class="st">"carbon_footprint"</span>] <span class="op">=</span> df_emissions_pop[<span class="st">"total_emissions"</span>] <span class="op">/</span> df_emissions_pop[<span class="st">"PTOT"</span>]</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>df_emissions_pop.sort_values(<span class="st">"carbon_footprint"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="303">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DEPCOM</th>
<th data-quarto-table-cell-role="th">COM</th>
<th data-quarto-table-cell-role="th">PTOT</th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">total_emissions</th>
<th data-quarto-table-cell-role="th">dep</th>
<th data-quarto-table-cell-role="th">carbon_footprint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">30289</td>
<td>77282</td>
<td>Mauregard</td>
<td>353</td>
<td>77282</td>
<td>MAUREGARD</td>
<td>733.910161</td>
<td>133699.072712</td>
<td>3.303394e+06</td>
<td>193.323752</td>
<td>44.301447</td>
<td>2.354558e+00</td>
<td>6.911213e+00</td>
<td>468.995242</td>
<td>2106.579416</td>
<td>160.309150</td>
<td>3.440809e+06</td>
<td>77</td>
<td>9747.335479</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30298</td>
<td>77291</td>
<td>Le Mesnil-Amelot</td>
<td>1019</td>
<td>77291</td>
<td>LE MESNIL-AMELOT</td>
<td>782.183307</td>
<td>133834.090767</td>
<td>3.303394e+06</td>
<td>3330.404124</td>
<td>111.613197</td>
<td>8.240952e+02</td>
<td>2.418925e+03</td>
<td>1404.400153</td>
<td>11712.541682</td>
<td>13680.471909</td>
<td>3.471492e+06</td>
<td>77</td>
<td>3406.763878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22513</td>
<td>60049</td>
<td>Bazancourt</td>
<td>138</td>
<td>60049</td>
<td>BAZANCOURT</td>
<td>4931.402275</td>
<td>NaN</td>
<td>NaN</td>
<td>130.528462</td>
<td>16.794877</td>
<td>2.354558e+00</td>
<td>3.016750e+05</td>
<td>56.170228</td>
<td>180.537059</td>
<td>60.773916</td>
<td>3.070535e+05</td>
<td>60</td>
<td>2225.025699</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26698</td>
<td>68064</td>
<td>Chalampé</td>
<td>969</td>
<td>68064</td>
<td>CHALAMPE</td>
<td>9.216396</td>
<td>647.802699</td>
<td>3.558269e+01</td>
<td>6332.112195</td>
<td>70576.619047</td>
<td>2.455804e+03</td>
<td>1.042746e+06</td>
<td>1097.958606</td>
<td>2810.388658</td>
<td>1362.287485</td>
<td>1.128073e+06</td>
<td>68</td>
<td>1164.162333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5501</td>
<td>16357</td>
<td>Saint-Vallier</td>
<td>137</td>
<td>16357</td>
<td>SAINT-VALLIER</td>
<td>1946.660150</td>
<td>NaN</td>
<td>NaN</td>
<td>178.823635</td>
<td>18.910767</td>
<td>2.354558e+00</td>
<td>1.513620e+05</td>
<td>73.973099</td>
<td>714.562143</td>
<td>68.430473</td>
<td>1.543657e+05</td>
<td>16</td>
<td>1126.757043</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21085</td>
<td>57314</td>
<td>Héming</td>
<td>500</td>
<td>57314</td>
<td>HEMING</td>
<td>509.670358</td>
<td>167.168713</td>
<td>8.175536e+00</td>
<td>1141.352892</td>
<td>68.237452</td>
<td>3.343472e+02</td>
<td>5.114259e+05</td>
<td>276.118642</td>
<td>3622.271599</td>
<td>850.150203</td>
<td>5.184033e+05</td>
<td>57</td>
<td>1036.806699</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14762</td>
<td>39236</td>
<td>Francheville</td>
<td>56</td>
<td>39236</td>
<td>FRANCHEVILLE</td>
<td>817.850772</td>
<td>NaN</td>
<td>NaN</td>
<td>63.254271</td>
<td>5.157482</td>
<td>2.354558e+00</td>
<td>4.797800e+04</td>
<td>23.798701</td>
<td>103.848909</td>
<td>18.662856</td>
<td>4.901293e+04</td>
<td>39</td>
<td>875.230849</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18517</td>
<td>51377</td>
<td>Montépreux</td>
<td>45</td>
<td>51377</td>
<td>MONTEPREUX</td>
<td>3184.753959</td>
<td>NaN</td>
<td>NaN</td>
<td>195.644289</td>
<td>5.289725</td>
<td>5.886394e+01</td>
<td>2.928200e+04</td>
<td>26.790561</td>
<td>191.338795</td>
<td>19.141391</td>
<td>3.296382e+04</td>
<td>51</td>
<td>732.529393</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13138</td>
<td>34278</td>
<td>Saint-Michel</td>
<td>49</td>
<td>34278</td>
<td>SAINT-MICHEL</td>
<td>4491.844291</td>
<td>NaN</td>
<td>NaN</td>
<td>145.718340</td>
<td>34.912656</td>
<td>2.354558e+00</td>
<td>2.514989e+04</td>
<td>23.599874</td>
<td>450.893244</td>
<td>23.448204</td>
<td>3.032267e+04</td>
<td>34</td>
<td>618.829907</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4333</td>
<td>13039</td>
<td>Fos-sur-Mer</td>
<td>15654</td>
<td>13039</td>
<td>FOS-SUR-MER</td>
<td>305.092893</td>
<td>1893.383189</td>
<td>1.722723e+04</td>
<td>50891.367548</td>
<td>275500.374439</td>
<td>2.296711e+06</td>
<td>6.765119e+06</td>
<td>9466.388806</td>
<td>74631.401993</td>
<td>42068.140058</td>
<td>9.533813e+06</td>
<td>13</td>
<td>609.033668</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="analysis-of-the-evolution-of-a-production-index" class="level3">
<h3 class="anchored" data-anchor-id="analysis-of-the-evolution-of-a-production-index">Analysis of the evolution of a production index</h3>
<p>You have two CSV data sets available in the <code>data/</code> folder: - <code>serie_glaces_valeurs.csv</code> contains the monthly values of the production price index of the French ice cream and sorbet industry. - <code>serie_glaces_metadonnees.csv</code> contains the associated metadata, including the codes indicating the data status.</p>
<p>The goal is to use <code>Pandas</code> to calculate: - the evolution of the index between each period (month) - the evolution of the index on a year-over-year basis (between a given month and the same month the following year).</p>
<section id="part-1-importing-data" class="level4">
<h4 class="anchored" data-anchor-id="part-1-importing-data">Part 1: Importing data</h4>
<ul>
<li>Import the two CSV files into DataFrames. Note: in both cases, there are extraneous rows before the data that need to be skipped using the <code>skiprows</code> parameter of the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">read_csv()</a> function.</li>
<li>Give simple and relevant names to the various variables.</li>
</ul>
<div id="f1759609" class="cell" data-execution_count="304">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="029de366" class="cell" data-execution_count="305">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>df_values <span class="op">=</span> pd.read_csv(<span class="st">'data/serie_glaces_valeurs.csv'</span>, delimiter<span class="op">=</span><span class="st">';'</span>,</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>                        skiprows<span class="op">=</span><span class="dv">4</span>, names<span class="op">=</span>[<span class="st">"period"</span>, <span class="st">"index"</span>, <span class="st">"code"</span>])</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>df_metadata <span class="op">=</span> pd.read_csv(<span class="st">'data/serie_glaces_metadonnees.csv'</span>, delimiter<span class="op">=</span><span class="st">';'</span>,</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>                          skiprows<span class="op">=</span><span class="dv">5</span>, names<span class="op">=</span>[<span class="st">"code"</span>, <span class="st">"meaning"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</section>
<section id="part-2-filtering-relevant-data" class="level4">
<h4 class="anchored" data-anchor-id="part-2-filtering-relevant-data">Part 2: Filtering relevant data</h4>
<ul>
<li>Merge the two DataFrames to retrieve the meanings of the codes present in the data.</li>
<li>Filter the data to keep only the “Normal Value” data.</li>
<li>Remove the columns related to the codes, which we no longer need for the rest.</li>
</ul>
<div id="35c3efe5" class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="1a015bb0" class="cell" data-execution_count="307">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> pd.merge(df_values, df_metadata, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'code'</span>)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_merged[df_merged[<span class="st">'code'</span>] <span class="op">==</span> <span class="st">"A"</span>]</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df_clean[[<span class="st">"period"</span>, <span class="st">"index"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</section>
<section id="part-3-data-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="part-3-data-preprocessing">Part 3: Data preprocessing</h4>
<p>Verify if the types of variables are relevant according to their nature. If not, convert them with the appropriate functions.</p>
<div id="62f39e82" class="cell" data-execution_count="308">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="26ca9da0" class="cell" data-execution_count="309">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>df_clean.info()</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">'period'</span>] <span class="op">=</span> pd.to_datetime(df_clean[<span class="st">'period'</span>])</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">'index'</span>] <span class="op">=</span> pd.to_numeric(df_clean[<span class="st">'index'</span>])</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>df_clean.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 198 entries, 3 to 200
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   period  198 non-null    object
 1   index   198 non-null    object
dtypes: object(2)
memory usage: 4.6+ KB
&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 198 entries, 3 to 200
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype         
---  ------  --------------  -----         
 0   period  198 non-null    datetime64[ns]
 1   index   198 non-null    float64       
dtypes: datetime64[ns](1), float64(1)
memory usage: 4.6 KB</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_3473/4193716240.py:2: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df_clean['period'] = pd.to_datetime(df_clean['period'])</code></pre>
</div>
</div>
</details>
</div>
</section>
<section id="part-4-calculating-periodic-evolution" class="level4">
<h4 class="anchored" data-anchor-id="part-4-calculating-periodic-evolution">Part 4: Calculating periodic evolution</h4>
<ul>
<li>Use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.shift.html">shift()</a> method to create a new column containing the previous month’s index.</li>
<li>Calculate the difference between the current index and the shifted index to obtain the (percentage) evolution from one month to the next.</li>
</ul>
<div id="c3a98481" class="cell" data-execution_count="310">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="d7153d75" class="cell" data-execution_count="311">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">'previous_index'</span>] <span class="op">=</span> df_clean[<span class="st">'index'</span>].shift(<span class="dv">1</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">'evolution'</span>] <span class="op">=</span> ((df_clean[<span class="st">'index'</span>] <span class="op">-</span> df_clean[<span class="st">'previous_index'</span>]) <span class="op">/</span> df_clean[<span class="st">'previous_index'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative method</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">'alternative_evolution'</span>] <span class="op">=</span> df_clean[<span class="st">'index'</span>].pct_change(periods<span class="op">=</span><span class="dv">1</span>) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</section>
<section id="part-5-calculating-year-over-year-evolution" class="level4">
<h4 class="anchored" data-anchor-id="part-5-calculating-year-over-year-evolution">Part 5: Calculating year-over-year evolution</h4>
<p>As you saw in the previous exercise’s solution, the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pct_change.html">pct_change()</a> method allows you to calculate an evolution between two periods. Use this method to calculate a year-over-year evolution for each month.</p>
<div id="56ba5f55" class="cell" data-execution_count="312">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test your answer in this cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<details>
<summary>
Show solution
</summary>
<div id="94c9f1a0" class="cell" data-execution_count="313">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>df_clean[<span class="st">"year_over_year_evolution"</span>] <span class="op">=</span> df_clean[<span class="st">'index'</span>].pct_change(periods<span class="op">=</span><span class="dv">12</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>df_clean.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="313">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">period</th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">previous_index</th>
<th data-quarto-table-cell-role="th">evolution</th>
<th data-quarto-table-cell-role="th">alternative_evolution</th>
<th data-quarto-table-cell-role="th">year_over_year_evolution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-06-01</td>
<td>115.3</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-05-01</td>
<td>112.4</td>
<td>115.3</td>
<td>-2.515178</td>
<td>-2.515178</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2023-04-01</td>
<td>115.5</td>
<td>112.4</td>
<td>2.758007</td>
<td>2.758007</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>2023-03-01</td>
<td>112.9</td>
<td>115.5</td>
<td>-2.251082</td>
<td>-2.251082</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>2023-02-01</td>
<td>105.1</td>
<td>112.9</td>
<td>-6.908769</td>
<td>-6.908769</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>2023-01-01</td>
<td>104.0</td>
<td>105.1</td>
<td>-1.046622</td>
<td>-1.046622</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>2022-12-01</td>
<td>98.3</td>
<td>104.0</td>
<td>-5.480769</td>
<td>-5.480769</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>2022-11-01</td>
<td>100.0</td>
<td>98.3</td>
<td>1.729400</td>
<td>1.729400</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>2022-10-01</td>
<td>98.2</td>
<td>100.0</td>
<td>-1.800000</td>
<td>-1.800000</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>2022-09-01</td>
<td>98.9</td>
<td>98.2</td>
<td>0.712831</td>
<td>0.712831</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>2022-08-01</td>
<td>99.3</td>
<td>98.9</td>
<td>0.404449</td>
<td>0.404449</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>2022-07-01</td>
<td>97.2</td>
<td>99.3</td>
<td>-2.114804</td>
<td>-2.114804</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>2022-06-01</td>
<td>97.3</td>
<td>97.2</td>
<td>0.102881</td>
<td>0.102881</td>
<td>-15.611448</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>2022-05-01</td>
<td>95.0</td>
<td>97.3</td>
<td>-2.363823</td>
<td>-2.363823</td>
<td>-15.480427</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>2022-04-01</td>
<td>96.0</td>
<td>95.0</td>
<td>1.052632</td>
<td>1.052632</td>
<td>-16.883117</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>2022-03-01</td>
<td>94.3</td>
<td>96.0</td>
<td>-1.770833</td>
<td>-1.770833</td>
<td>-16.474756</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>2022-02-01</td>
<td>94.0</td>
<td>94.3</td>
<td>-0.318134</td>
<td>-0.318134</td>
<td>-10.561370</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>2022-01-01</td>
<td>94.6</td>
<td>94.0</td>
<td>0.638298</td>
<td>0.638298</td>
<td>-9.038462</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>2021-12-01</td>
<td>92.6</td>
<td>94.6</td>
<td>-2.114165</td>
<td>-2.114165</td>
<td>-5.798576</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>2021-11-01</td>
<td>92.3</td>
<td>92.6</td>
<td>-0.323974</td>
<td>-0.323974</td>
<td>-7.700000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</details>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>