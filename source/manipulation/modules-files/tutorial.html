<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Formation SSPy  - Manipulation de fichiers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Manipulation de donnÃ©es</a></li><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Manipulation de fichiers</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">Formation SSPy <i class="fa-brands fa-python" aria-label="python"></i></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Fondamentaux du langage</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/types-variables/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Types de base et variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/data-structures1/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structures de donnÃ©es 1 : listes et tuples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/data-structures2/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structures de donnÃ©es 2 : dictionnaires et sets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/tests/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/loops/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Boucles</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/functions/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fonctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/fundamentals/oop/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notions de programmation orientÃ©e objet</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Manipulation de donnÃ©es</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/modules-files/tutorial.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Manipulation de fichiers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/csv-json-files/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Travailler avec des fichiers CSV et JSON</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/numpy/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calcul numÃ©rique avec NumPy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/pandas/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Traiter des donnÃ©es tabulaires avec Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/manipulation/dataviz/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction Ã  la visualisation de donnÃ©es</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Projets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/puissance4/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projet 1 - Puissance 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/meteo/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projet 2 - Interaction avec des APIs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../source/projects/RP/tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projet 3 - Analyse du recensement de la population</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quelques-notions-sur-les-modules-et-les-packages" id="toc-quelques-notions-sur-les-modules-et-les-packages" class="nav-link active" data-scroll-target="#quelques-notions-sur-les-modules-et-les-packages">Quelques notions sur les modules et les <em>packages</em></a>
  <ul class="collapse">
  <li><a href="#terminologie" id="toc-terminologie" class="nav-link" data-scroll-target="#terminologie">Terminologie</a></li>
  <li><a href="#import-de-module" id="toc-import-de-module" class="nav-link" data-scroll-target="#import-de-module">Import de module</a></li>
  <li><a href="#import-de-package" id="toc-import-de-package" class="nav-link" data-scroll-target="#import-de-package">Import de <em>package</em></a></li>
  <li><a href="#installation-de-packages" id="toc-installation-de-packages" class="nav-link" data-scroll-target="#installation-de-packages">Installation de <em>packages</em></a></li>
  </ul></li>
  <li><a href="#manipulation-de-fichiers" id="toc-manipulation-de-fichiers" class="nav-link" data-scroll-target="#manipulation-de-fichiers">Manipulation de fichiers</a>
  <ul class="collapse">
  <li><a href="#interagir-avec-le-systÃ¨me-de-fichiers-local" id="toc-interagir-avec-le-systÃ¨me-de-fichiers-local" class="nav-link" data-scroll-target="#interagir-avec-le-systÃ¨me-de-fichiers-local">Interagir avec le systÃ¨me de fichiers local</a></li>
  <li><a href="#fichiers-texte-et-fichiers-binaires" id="toc-fichiers-texte-et-fichiers-binaires" class="nav-link" data-scroll-target="#fichiers-texte-et-fichiers-binaires">Fichiers texte et fichiers binaires</a></li>
  <li><a href="#ouvrir-un-fichier" id="toc-ouvrir-un-fichier" class="nav-link" data-scroll-target="#ouvrir-un-fichier">Ouvrir un fichier</a></li>
  <li><a href="#lire-un-fichier" id="toc-lire-un-fichier" class="nav-link" data-scroll-target="#lire-un-fichier">Lire un fichier</a></li>
  <li><a href="#Ã©crire-dans-un-fichier" id="toc-Ã©crire-dans-un-fichier" class="nav-link" data-scroll-target="#Ã©crire-dans-un-fichier">Ã‰crire dans un fichier</a></li>
  </ul></li>
  <li><a href="#exÃ©cuter-du-code-depuis-des-fichiers-.py" id="toc-exÃ©cuter-du-code-depuis-des-fichiers-.py" class="nav-link" data-scroll-target="#exÃ©cuter-du-code-depuis-des-fichiers-.py">ExÃ©cuter du code depuis des fichiers <code>.py</code></a>
  <ul class="collapse">
  <li><a href="#les-scripts-python" id="toc-les-scripts-python" class="nav-link" data-scroll-target="#les-scripts-python">Les scripts <code>Python</code></a></li>
  <li><a href="#scripts-et-modules" id="toc-scripts-et-modules" class="nav-link" data-scroll-target="#scripts-et-modules">Scripts et modules</a></li>
  </ul></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices">Exercices</a>
  <ul class="collapse">
  <li><a href="#questions-de-comprÃ©hension" id="toc-questions-de-comprÃ©hension" class="nav-link" data-scroll-target="#questions-de-comprÃ©hension">Questions de comprÃ©hension</a></li>
  <li><a href="#moyenne-et-Ã©cart-type-des-notes-obtenues-Ã -un-examen" id="toc-moyenne-et-Ã©cart-type-des-notes-obtenues-Ã -un-examen" class="nav-link" data-scroll-target="#moyenne-et-Ã©cart-type-des-notes-obtenues-Ã -un-examen">Moyenne et Ã©cart-type des notes obtenues Ã  un examen</a></li>
  <li><a href="#admis-ou-recalÃ©" id="toc-admis-ou-recalÃ©" class="nav-link" data-scroll-target="#admis-ou-recalÃ©">Admis ou recalÃ©</a></li>
  <li><a href="#retardataires" id="toc-retardataires" class="nav-link" data-scroll-target="#retardataires">Retardataires</a></li>
  <li><a href="#scanner-des-fichiers" id="toc-scanner-des-fichiers" class="nav-link" data-scroll-target="#scanner-des-fichiers">Scanner des fichiers</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Manipulation de donnÃ©es</a></li><li class="breadcrumb-item"><a href="../../../source/manipulation/modules-files/tutorial.html">Manipulation de fichiers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Manipulation de fichiers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Dans les tutoriels prÃ©cÃ©dents, nous avons utilisÃ© systÃ©matiquement des variables pour stocker des donnÃ©es et rÃ©aliser des opÃ©rations sur celles-ci. Cette faÃ§on de faire peut suffire dans le cadre dâ€™une session <code>Python</code> donnÃ©e, comme ici dans un notebook Jupyter ou bien dans un programme.</p>
<p>Mais que se passe-t-il par exemple si lâ€™on souhaite conserver les sorties des calculs rÃ©alisÃ©s ou bien des donnÃ©es transformÃ©es une fois la session terminÃ©e ? Il nous faut alors sauvegarder ces Ã©lÃ©ments dans un fichier, Ã  un endroit oÃ¹ ces donnÃ©es vont persister dans le temps en vue dâ€™une utilisation ultÃ©rieure. Dans ce tutoriel, nous allons voir comment <strong>lire et Ã©crire des fichiers avec <code>Python</code></strong>.</p>
<section id="quelques-notions-sur-les-modules-et-les-packages" class="level2">
<h2 class="anchored" data-anchor-id="quelques-notions-sur-les-modules-et-les-packages">Quelques notions sur les modules et les <em>packages</em></h2>
<p>Avant de parler de manipulation de fichiers, nous devons faire un bref dÃ©tour par le monde des modules et des <strong><em>packages</em></strong> (librairies).</p>
<p>Jusquâ€™Ã  maintenant, nous avons essentiellement utilisÃ© des objets et des instructions standards de <code>Python</code>, qui ne nÃ©cessitaient donc pas dâ€™import tiers. Dans ce tutoriel et tous ceux qui vont suivre, nous allons rÃ©aliser des opÃ©rations plus complexes (interagir avec un systÃ¨me de fichiers, faire du calcul vectoriel, manipuler des donnÃ©es tabulaires, etc.) quâ€™il serait trÃ¨s coÃ»teux, inefficient, et avec un potentiel dâ€™erreur Ã©norme, de coder Ã  la main en utilisant les objets de base de <code>Python</code>.</p>
<p>Câ€™est pourquoi nous allons utiliser des <em>packages</em>, sortes de boÃ®tes Ã  outils remplies de <strong>fonctions</strong> et de <strong>classes</strong> dÃ©veloppÃ©es par dâ€™autres (souvent, de maniÃ¨re communautaire) et qui permettent de rÃ©aliser des opÃ©rations complexes Ã  moindre coÃ»t.</p>
<section id="terminologie" class="level3">
<h3 class="anchored" data-anchor-id="terminologie">Terminologie</h3>
<p>CommenÃ§ons par quelques brefs Ã©lÃ©ments de terminologie pour bien se repÃ©rer dans lâ€™Ã©cosystÃ¨me <code>Python</code> :</p>
<ul>
<li><p>un <strong>module</strong> est un fichier texte (portant lâ€™extension .py pour bien marquer le lien Ã  <code>Python</code>) contenant un ensemble de dÃ©finitions (de <strong>classes</strong>, de <strong>fonctions</strong>) et dâ€™instructions, que lâ€™on peut importer dans un environnement <code>Python</code> afin de les utiliser.</p></li>
<li><p>un <strong>package</strong> est un ensemble de modules rÃ©unis dans un mÃªme rÃ©pertoire</p></li>
</ul>
<p>Par exemple, nous allons voir en dÃ©tails dans la prochaine partie lâ€™utilisation de <code>numpy</code>. <code>numpy</code> est un <em>package</em> qui permet de faire du calcul scientifique sur des objets multidimensionnels. Pour ce faire, <code>numpy</code> met Ã  disposition un nombre gigantesque de fonctions et dâ€™outils. Toutes les mettre dans un seul et mÃªme module serait franchement illisible. Ainsi, <code>numpy</code> est structurÃ© en diffÃ©rents modules qui groupent les fonctions rÃ©alisant des opÃ©rations similaires : les fonctions gÃ©nÃ©rant de lâ€™alÃ©atoire dans le module <code>random</code>, celles rÃ©alisant de lâ€™algÃ¨bre linÃ©aire dans le module <code>linalg</code>, etc.</p>
</section>
<section id="import-de-module" class="level3">
<h3 class="anchored" data-anchor-id="import-de-module">Import de module</h3>
<p>Pour pouvoir exploiter les fonctions dâ€™un module et les diffÃ©rents modules qui constituent un <em>package</em>, il nous faut en premier lieu les importer.</p>
<p>La syntaxe est trÃ¨s simple, illustrons lÃ  Ã  travers un exemple.</p>
<div id="09c09e46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>random.randint(<span class="dv">0</span>, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>86</code></pre>
</div>
</div>
<p>Nous avons importÃ© le module <code>random</code> (complet) de la librairie standard de <code>Python</code> via lâ€™instruction <code>import</code>. Ensuite, nous avons fait appel Ã  la fonction <code>randint</code> contenue dans le module <code>random</code>, qui renvoie un nombre alÃ©atoire entre <code>a</code> et <code>b</code> ses paramÃ¨tres.</p>
<p>On aurait pu Ã©galement importer <em>seulement</em> la fonction <code>randint</code> en utilisant la syntaxe <code>from module import fonction</code>. Il nâ€™est alors plus nÃ©cessaire de spÃ©cifier le nom du module lorsquâ€™on appelle la fonction.</p>
<div id="1be341a6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> randint</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>randint(<span class="dv">0</span>, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>40</code></pre>
</div>
</div>
<p>Notons quâ€™une fois quâ€™un import est effectuÃ©, le module importÃ© est disponible pour toute la durÃ©e de la session <code>Python</code>. Il nâ€™y a donc pas besoin dâ€™importer le module avant chaque utilisation dâ€™une de ses fonctions, une fois au dÃ©but de son notebook ou script suffit.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Trop d'imports tue l'import">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Trop dâ€™imports tue lâ€™import
</div>
</div>
<div class="callout-body-container callout-body">
<p>Il arrive parfois de voir la syntaxe <code>from module import *</code> (<code>*</code> sâ€™appelle le <em>wildcard</em>) qui a pour effet dâ€™importer en mÃ©moire <em>toutes</em> les fonctions du module. Si cela permet de gagner du temps, ce nâ€™est pourtant pas une bonne pratique :</p>
<ul>
<li><p>dâ€™une part, cela charge plus de code en mÃ©moire quâ€™il nâ€™est nÃ©cessaire pour notre application ;</p></li>
<li><p>dâ€™autre part, cela limite la lisibilitÃ© du code dans la mesure oÃ¹ lâ€™on ne voit pas explicitement dâ€™oÃ¹ ont Ã©tÃ© importÃ©es les fonctions qui sont utilisÃ©es dans le code.</p></li>
</ul>
</div>
</div>
</section>
<section id="import-de-package" class="level3">
<h3 class="anchored" data-anchor-id="import-de-package">Import de <em>package</em></h3>
<p>Un <em>package</em> est simplement une collection de modules, structurÃ©e selon une arborescence. La syntaxe pour importer un <em>package</em> est identique Ã  celle pour importer un module.</p>
<p>Par exemple, regardons Ã  nouveau comment utiliser la fonction <code>randint</code>, mais cette fois celle du package <code>numpy</code> (qui fait la mÃªme chose).</p>
<div id="7c34592f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f871ba04" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>numpy.random.randint(<span class="dv">0</span>, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>98</code></pre>
</div>
</div>
<p>On a importÃ© le package <code>numpy</code>, qui nous a permis dâ€™accÃ©der via son module <code>random</code> Ã  la fonction <code>randint</code>. LÃ  encore, on aurait pu importer directement la fonction.</p>
<div id="b4f81b3b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> randint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="87916cf5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>randint(<span class="dv">0</span>, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0</code></pre>
</div>
</div>
<p>En pratique, la premiÃ¨re syntaxe est prÃ©fÃ©rable : il est toujours plus lisible de montrer explicitement dâ€™oÃ¹ vient la fonction que lâ€™on appelle. Pour rÃ©duire la verbositÃ©, il est frÃ©quent de donner un <strong><em>alias</em></strong> aux packages que lâ€™on importe. Voici les trois plus frÃ©quents, que lâ€™on rencontrera trÃ¨s souvent dans les tutoriels du prochain chapitre sur la manipulation de donnÃ©es.</p>
<div id="f9a76b0a" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut alors utiliser ces <em>alias</em> pour appeler des modules et des fonctions.</p>
<div id="11f0e27d" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1000</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.sin(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tutorial_files/figure-html/cell-9-output-1.png" width="590" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="installation-de-packages" class="level3">
<h3 class="anchored" data-anchor-id="installation-de-packages">Installation de <em>packages</em></h3>
<p>Jusquâ€™Ã  maintenant, nous avons pu importer sans problÃ¨me les diffÃ©rents packages via lâ€™instruction <code>import</code>. Mais comment ont-ils Ã©tÃ© installÃ©s ? Il faut distinguer deux cas de figure :</p>
<ul>
<li><p>un certain nombre de packages font partie de la <strong>bibilothÃ¨que standard</strong>, ce qui signifie quâ€™ils sont installÃ©s en mÃªme temps que <code>Python</code>. Câ€™est par exemple le cas du package <code>random</code> utilisÃ© plus haut, mais il en existe <a href="https://docs.python.org/fr/3/library/">beaucoup dâ€™autres</a> ;</p></li>
<li><p>les autres packages â€œtiersâ€ sont dÃ©veloppÃ©s par la communautÃ© des utilisateurs de <code>Python</code>, et doivent Ãªtre installÃ©s pour pouvoir Ãªtre utilisÃ©s. Câ€™est notamment le cas de <code>numpy</code> et <code>pandas</code>. Dans notre cas, nous nâ€™avons pas eu Ã  les installer car lâ€™environnement fourni pour la formation contient dÃ©jÃ  lâ€™ensemble des packages nÃ©cessaires pour exÃ©cuter les diffÃ©rents chapitres.</p></li>
</ul>
<p>Illustrons lâ€™installation de package Ã  travers le package <a href="https://pypi.org/project/emoji/">emoji</a>, qui permet de reprÃ©senter des Ã©moticÃ´nes dans les sorties de <code>Python</code>. Pour le coup, celui-ci nâ€™est pas encore installÃ© ; essayer de lâ€™importer produit une <code>ModuleNotFoundError</code>.</p>
<div id="3d876290" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> emoji</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ModuleNotFoundError: No module named 'emoji'</code></pre>
</div>
</div>
<p>Pour installer un package, la commande est simple : <code>pip install nom_du_package</code>. Sans rentrer dans les dÃ©tails, <code>pip</code> est un gestionnaire de packages, installÃ© avec <code>Python</code>, qui sâ€™utilise en ligne de commande (i.e.&nbsp;dans un terminal). Pour pouvoir envoyer une commande au terminal depuis un notebook Jupyter, on rajoute un <code>!</code> devant la commande.</p>
<div id="7aaff7fd" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install emoji</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting emoji
  Downloading emoji-2.10.1-py2.py3-none-any.whl.metadata (5.3 kB)
Downloading emoji-2.10.1-py2.py3-none-any.whl (421 kB)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 0.0/421.5 kB ? eta -:--:--   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸â”â”â” 389.1/421.5 kB 11.5 MB/s eta 0:00:01   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 421.5/421.5 kB 10.5 MB/s eta 0:00:00
Installing collected packages: emoji
Successfully installed emoji-2.10.1

[notice] A new release of pip is available: 23.0.1 -&gt; 24.0
[notice] To update, run: pip install --upgrade pip</code></pre>
</div>
</div>
<p>Il est Ã  prÃ©sent possible dâ€™importer le package et dâ€™utiliser ses fonctions.</p>
<div id="e3215aa7" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> emoji</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(emoji.emojize(<span class="st">'Python est :thumbs_up:'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python est ğŸ‘</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="pip et PyPI">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
pip et PyPI
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>pip</code> est le gestionnaire de paquets standard pour <code>Python</code>. Il permet dâ€™installer, de mettre Ã  jour et de supprimer des packages <code>Python</code> trouvÃ©s dans le <code>Python</code> Package Index (<code>PyPI</code>), un rÃ©pertoire de packages pour la programmation en <code>Python</code>. Ce rÃ©pertoire contient un nombre gigantesque de projets (environ 500,000 Ã  lâ€™heure de lâ€™Ã©criture de ce tutoriel), des plus amateurs aux plus essentiels.</p>
<p>De maniÃ¨re gÃ©nÃ©rale, il est toujours prÃ©fÃ©rable, avant de se lancer dans lâ€™Ã©criture dâ€™une application â€œÃ  la mainâ€, de vÃ©rifier quâ€™un package faisant la mÃªme chose ou presque nâ€™existe pas dÃ©jÃ . Une simple recherche google - de prÃ©fÃ©rence en Anglais - contenant les mots-clÃ©s de ce que lâ€™on cherche Ã  faire permet souvent de sâ€™en assurer.</p>
</div>
</div>
</section>
</section>
<section id="manipulation-de-fichiers" class="level2">
<h2 class="anchored" data-anchor-id="manipulation-de-fichiers">Manipulation de fichiers</h2>
<section id="interagir-avec-le-systÃ¨me-de-fichiers-local" class="level3">
<h3 class="anchored" data-anchor-id="interagir-avec-le-systÃ¨me-de-fichiers-local">Interagir avec le systÃ¨me de fichiers local</h3>
<p>Pour pouvoir lire et Ã©crire des fichiers avec <code>Python</code>, il nous faut dâ€™abord comprendre comment ceux-ci sont reprÃ©sentÃ©s sur le systÃ¨me de fichiers (<em>file system</em>) local, et comment <code>Python</code> interagit avec ce dernier.</p>
<p><strong>Le module <code>pathlib</code></strong></p>
<p>Pour ce faire, nous allons utiliser de maniÃ¨re rÃ©pÃ©tÃ©e le module <code>pathlib</code> et en particulier la classe <code>Path</code>. Ce module permet dâ€™interagir avec le systÃ¨me de fichiers sous forme dâ€™objets, en manipulant des attributs et leurs mÃ©thodes. Pas de panique, nous avons vu tout ce quâ€™il nous fallait savoir Ã  ce propos dans le prÃ©cÃ©dent tutoriel.</p>
<div id="4da72d39" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>PropriÃ©tÃ©s dâ€™un fichier</strong></p>
<p>Un fichier a deux propriÃ©tÃ©s :</p>
<ul>
<li><p>un <strong>nom de fichier</strong></p></li>
<li><p>un <strong>chemin</strong> (<em>path</em>), qui spÃ©cifie sa localisation dans le systÃ¨me de fichiers.</p></li>
</ul>
<p>A titre dâ€™exemple, regardons les fichiers qui se trouvent dans notre rÃ©pertoire courant (par dÃ©faut, le dossier dans lequel se trouve ce notebook). La mÃ©thode Ã  utiliser sâ€™appelle <code>cwd</code>, pour <em>current working directory</em>.</p>
<div id="4e5eb721" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Path.cwd()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files')</code></pre>
</div>
</div>
<p>Le chemin de notre rÃ©pertoire courant est contenu dans un objet <code>PosixPath</code>, ce qui signifie simplement que <code>pathlib</code> a compris que nous Ã©tions sur un environnement de type Unix (les serveurs du SSP Cloud sont sous Linux). Si vous exÃ©cutiez ce notebook en local sur un ordinateur Windows, lâ€™objet serait <code>WindowsPath</code>. ConcrÃ¨tement, cela ne change pas grand chose pour vous mais câ€™est en fait assez important : les systÃ¨mes de fichiers nâ€™utilisent pas les mÃªmes conventions entre les diffÃ©rents environnements (ex : les sÃ©parateurs entre dossiers dans un chemin ne sont pas les mÃªmes), mais <code>pathlib</code> vous permet dâ€™interagir avec ces diffÃ©rents systÃ¨mes de maniÃ¨re harmonisÃ©e.</p>
<p>Maintenant, listons tous les fichiers contenus dans notre rÃ©pertoire courant. On utilise pour cela une seconde mÃ©thode <code>glob</code> qui va simplement renvoyer tous les fichiers dont le nom a une certaine structure. Par exemple, <code>.glob('*.txt')</code> va rÃ©cupÃ©rer tous les fichiers dont lâ€™extension est <code>.txt</code> et <code>.glob('test.*')</code> va rÃ©cupÃ©rer tous les fichiers dont le nom est <code>test</code>, quelle que soit leur extension. Ici, on rÃ©cupÃ¨re tous les fichiers en utilisant des <em>wildcards</em> <code>*</code> aux deux positions.</p>
<p>Cette mÃ©thode renvoie un objet un peu spÃ©cial (un <em>gÃ©nÃ©rateur</em>). Si vous vous rappelez bien, on avait dÃ©jÃ  rencontrÃ© le mÃªme cas avec la fonction <code>range</code>. Il suffit dâ€™appeler la fonction <code>list</code> sur le tout pour afficher les rÃ©sultats de maniÃ¨re lisible.</p>
<div id="e393c389" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Path.cwd().glob(<span class="st">'*.*'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;generator object Path.glob at 0x7f12eda8d0e0&gt;</code></pre>
</div>
</div>
<div id="1a20b52e" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(Path.cwd().glob(<span class="st">'*.*'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>[PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/gamme.txt'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/notes.txt'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/tutorial.qmd'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/write_list.py'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/tutorial.ipynb'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/normalisation.py'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/solutions.py'),
 PosixPath('/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/notes_clean.txt')]</code></pre>
</div>
</div>
<p>On retrouve notre notebook, un fichier qui contient les solutions des exercices du tutoriel, et un certain nombre de fichiers texte qui vont servir dâ€™exemples dans la suite du tutoriel. Si lâ€™on prend le notebook par exemple, on distingue bien :</p>
<ul>
<li><p>son nom de fichier : <code>tutorial.ipynb</code></p></li>
<li><p>son chemin : <code>/home/onyxia/work/formation/</code></p></li>
</ul>
<p><strong>Chemins absolus et chemins relatifs</strong></p>
<p>Il y a deux maniÃ¨res possibles de spÃ©cifier le chemin dâ€™un fichier :</p>
<ul>
<li><p>de maniÃ¨re <strong>absolue</strong>, le chemin commence alors par la racine (<code>/</code> en Unix, <code>C:\</code> en Windows, etc.). Les chemins renvoyÃ©s ci-dessus sont donc absolus.</p></li>
<li><p>de maniÃ¨re <strong>relative</strong>, i.e.&nbsp;relativement au rÃ©pertoire courant du programme <code>Python</code>. DÃ¨s lors quâ€™un chemin ne commence pas par la racine, <code>pathlib</code> va le considÃ©rer relatif.</p></li>
</ul>
<p>Cette distinction va sâ€™avÃ©rer assez importante par la suite, lorsquâ€™il sera question de lire et dâ€™Ã©crire des fichiers.</p>
<p><strong>Former des chemins</strong></p>
<p>En pratique, ce qui nous intÃ©resse est de pouvoir constituer nos propres chemins â€“ quâ€™ils soient absolus ou relatifs au rÃ©pertoire courant â€“ afin de spÃ©cifier oÃ¹ se trouvent les fichiers que nous souhaitons lire ou bien oÃ¹ doivent se trouver les fichiers que lâ€™on souhaite Ã©crire.</p>
<p><code>pathlib</code> offre une syntaxe trÃ¨s intuitive pour constituer des chemins, trÃ¨s similaire Ã  la concatÃ©nation des chaÃ®nes de caractÃ¨res que nous avons dÃ©jÃ  vue. Au lieu dâ€™un <code>+</code>, on va cette fois utiliser un <code>/</code> pour concatÃ©ner les diffÃ©rentes parties dâ€™un chemin.</p>
<p>Par exemple, essayons de reconstruire le chemin complet de ce notebook. On peut commencer par trouver le chemin du <em>home</em> directory, qui est le dossier standard dans lequel se trouvent tous les fichiers de lâ€™utilisateur.</p>
<div id="706bd22f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Path.home()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>PosixPath('/home/runner')</code></pre>
</div>
</div>
<p>On peut alors concatÃ©ner les diffÃ©rents sous-dossier et le nom de fichier du notebook pour obtenir le chemin complet vers celui-ci.</p>
<div id="415ca6c4" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>path_nb <span class="op">=</span> Path.home() <span class="op">/</span> <span class="st">'work'</span> <span class="op">/</span> <span class="st">'formation'</span> <span class="op">/</span> <span class="st">'tutorial.ipynb'</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>path_nb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>PosixPath('/home/runner/work/formation/tutorial.ipynb')</code></pre>
</div>
</div>
<p>On retrouve bien exactement le mÃªme chemin que celui obtenu en listant les fichiers prÃ©sents dans le rÃ©pertoire courant.</p>
<p><strong>Plus sur <code>pathlib</code></strong></p>
<p>Nous nâ€™avons vu quâ€™un aperÃ§u des outils quâ€™offre le module <code>pathlib</code> pour interagir avec le systÃ¨me de fichiers local. La <a href="https://docs.python.org/fr/3/library/pathlib.html">documentation officielle</a> prÃ©sente de maniÃ¨re exhaustive ces possibilitÃ©s. Nous prÃ©senterons dans ce tutoriel et dans les suivants dâ€™autres mÃ©thodes issues de cette librairie, Ã  mesure que lâ€™occasion se prÃ©sente. Pour lâ€™heure, nous en savons suffisamment pour lire et Ã©crire des fichiers sur le systÃ¨me de fichiers.</p>
</section>
<section id="fichiers-texte-et-fichiers-binaires" class="level3">
<h3 class="anchored" data-anchor-id="fichiers-texte-et-fichiers-binaires">Fichiers texte et fichiers binaires</h3>
<p>En programmation, on est gÃ©nÃ©ralement amenÃ©s Ã  manipuler deux grandes familles de fichiers bien diffÃ©rentes :</p>
<ul>
<li><p>les <strong>fichiers texte</strong>. Ils ne contiennent que des caractÃ¨res textuels standards â€“ techniquement, qui respectent le standard <a href="https://fr.wikipedia.org/wiki/Unicode">Unicode</a> â€“ sans informations de <em>formatting</em> (police, couleur, etc.). Les fichiers <em>.txt</em> ou encore les scripts <code>Python</code> finissant en <em>.py</em> sont des exemples de fichiers texte. Ces fichiers peuvent Ãªtre lus avec nâ€™importe quel Ã©diteur de texte.</p></li>
<li><p>les <strong>fichiers binaires</strong>. Ce sont en fait tous les autres types de fichiers : fichiers compressÃ©s (<em>.zip</em>, <em>tar.gz</em>, etc.), documents PDFs, images, programmes, etc. Ouvrir un tel fichier avec un Ã©diteur de texte produit gÃ©nÃ©ralement une grande suite de caractÃ¨res incomprÃ©hensibles, car la reprÃ©sentation textuelle nâ€™est pas adaptÃ©e Ã  ces donnÃ©es.</p></li>
</ul>
<p>Comme vous pouvez lâ€™imaginer, ces deux types de fichier se traitent avec des outils diffÃ©rents. Par ailleurs, du fait de la diversitÃ© des fichiers binaires, chacun de ses fichiers nÃ©cessite un traitement particulier. Dans un contexte de programmation, on est cependant principalement Ã  manipuler du code, qui est une donnÃ©e textuelle. On va donc sâ€™intÃ©resser uniquement Ã  lâ€™<strong>Ã©criture et Ã  la lecture de fichiers texte</strong> dans ce tutoriel, mais il est important de savoir reconnaÃ®tre des donnÃ©es binaires lorsquâ€™on est amenÃ© Ã  en traiter.</p>
</section>
<section id="ouvrir-un-fichier" class="level3">
<h3 class="anchored" data-anchor-id="ouvrir-un-fichier">Ouvrir un fichier</h3>
<p>Demander Ã  <code>Python</code> dâ€™ouvrir un fichier revient Ã  ouvrir une connexion entre lâ€™environnement <code>Python</code> sur lequel vous Ãªtes et le fichier. Tant que cette connexion est ouverte, il est possible de manipuler le fichier.</p>
<p>Pour ouvrir un fichier, on utilise la fonction <code>open</code>. On va par exemple ouvrir le fichier <code>gamme.txt</code> qui a Ã©tÃ© mis dans le rÃ©pertoire courant.</p>
<div id="95f08849" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>path_gamme <span class="op">=</span> Path.cwd() <span class="op">/</span> <span class="st">'gamme.txt'</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>file_in <span class="op">=</span> <span class="bu">open</span>(path_gamme, <span class="st">'r'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>file_in</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>&lt;_io.TextIOWrapper name='/home/runner/work/formation-python-initiation/formation-python-initiation/source/manipulation/modules-files/gamme.txt' mode='r' encoding='UTF-8'&gt;</code></pre>
</div>
</div>
<p>La fonction <code>open</code> renvoie un objet de type <code>_io.TextIOWrapper</code>, qui spÃ©cifie le <strong>mode dâ€™encodage</strong> du fichier et le <strong>mode dâ€™ouverture</strong>.</p>
<p>Lâ€™encodage et le dÃ©codage sont des sujets techniques, que nous nâ€™aborderons pas dans ce tutoriel. Retenons simplement que le mode dâ€™encodage par dÃ©faut est lâ€™<code>UTF-8</code>, et quâ€™il nâ€™y a jamais vraiment de bonne raison de choisir un autre mode.</p>
<p>En revanche, le <strong>mode dâ€™ouverture</strong> est trÃ¨s important. Il y a trois modes principaux :</p>
<ul>
<li><p><code>r</code> : <strong>lecture seule</strong>. Le fichier ne peut quâ€™Ãªtre lu, mais pas modifiÃ©. Câ€™est le mode par dÃ©faut lorsquâ€™on ne spÃ©cifie aucun mode.</p></li>
<li><p><code>w</code> : <strong>Ã©criture</strong>. Il est possible dans ce mode dâ€™Ã©crire sur un fichier. <strong>Attention : si un fichier avec le mÃªme nom existe dÃ©jÃ , il sera automatiquement Ã©crasÃ©.</strong></p></li>
<li><p><code>a</code> : <strong>appending</strong>. Ce mode ne permet que de rajouter des lignes Ã  la fin dâ€™un fichier existant.</p></li>
</ul>
<p>Une fois le fichier ouvert, on peut rÃ©aliser des opÃ©rations sur ce fichier Ã  lâ€™aide de mÃ©thodes attachÃ©es Ã  lâ€™objet qui le reprÃ©sente. On verra dans la section suivante ce que fait la mÃ©thode <code>readlines</code>.</p>
<div id="a91ac5e4" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>file_in.readlines()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>['do\n', 're\n', 'mi\n', 'fa\n', 'sol\n', 'la\n', 'si']</code></pre>
</div>
</div>
<p>Une fois les manipulations terminÃ©es, on ferme la connexion avec la mÃ©thode <code>close</code>. Il nâ€™est alors plus possible de manipuler le fichier.</p>
<div id="b915f86d" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>file_in.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En pratique, on oublie facilement de fermer la connexion Ã  un fichier, ce qui peut crÃ©er des erreurs pÃ©nibles. Il existe une syntaxe qui permet dâ€™Ã©viter ce problÃ¨me en utilisant un <strong>context manager</strong> qui gÃ¨re toute la connexion pour nous.</p>
<div id="56755a36" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path_gamme, <span class="st">'r'</span>) <span class="im">as</span> file_in:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> file_in.readlines()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>lines</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>['do\n', 're\n', 'mi\n', 'fa\n', 'sol\n', 'la\n', 'si']</code></pre>
</div>
</div>
<p>Cette syntaxe est beaucoup plus lisible : grÃ¢ce Ã  lâ€™indentation, on voit clairement les opÃ©rations qui sont effectuÃ©es tant que le fichier est ouvert, et ce dernier est automatiquement fermÃ© dÃ¨s lors que lâ€™on revient au niveau initial dâ€™indentation. On prÃ©fÃ©rera toujours utiliser cette syntaxe si possible, câ€™est une bonne pratique de programmation.</p>
</section>
<section id="lire-un-fichier" class="level3">
<h3 class="anchored" data-anchor-id="lire-un-fichier">Lire un fichier</h3>
<p>Une fois un fichier ouvert, on peut vouloir lire son contenu. Il existe diffÃ©rentes maniÃ¨res de faire. Une mÃ©thode simple et Ã©lÃ©gante est de parcourir le fichier Ã  lâ€™aide dâ€™une boucle, ce qui est rendu possible par le fait que lâ€™objet <code>Python</code> reprÃ©sentant le fichier est <strong>itÃ©rable</strong>.</p>
<div id="4cec279c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path_gamme, <span class="st">'r'</span>) <span class="im">as</span> file_in:</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> file_in:</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(line)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>do

re

mi

fa

sol

la

si</code></pre>
</div>
</div>
<p>Dans notre exemple, nous avons simplement affichÃ© les lignes, mais on peut faire de nombreuses choses Ã  partir des donnÃ©es prÃ©sentes dans le fichier texte : les stocker dans un objet <code>Python</code>, les utiliser pour faire des calculs, ne conserver que les lignes qui rÃ©pondent Ã  une condition donnÃ©e via une instruction <code>if</code>, etc.</p>
<p>Il existe Ã©galement des mÃ©thodes toutes faites pour lire le contenu dâ€™un fichier. La plus basique est la mÃ©thode <code>read</code>, qui retourne lâ€™ensemble du fichier comme une (potentiellement trÃ¨s longue) chaÃ®ne de caractÃ¨res.</p>
<div id="19329863" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path_gamme, <span class="st">'r'</span>) <span class="im">as</span> file_in:</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    txt <span class="op">=</span> file_in.read()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>'do\nre\nmi\nfa\nsol\nla\nsi'</code></pre>
</div>
</div>
<p>Câ€™est rarement trÃ¨s utile : on prÃ©fÃ¨re en gÃ©nÃ©ral rÃ©cupÃ©rer individuellement les lignes dâ€™un fichier. La mÃ©thode <code>readlines</code> parcourt le fichier complet, et renvoie une liste dont les Ã©lÃ©ments sont les lignes du fichier, dans lâ€™ordre dâ€™apparition.</p>
<div id="89b8b56a" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path_gamme, <span class="st">'r'</span>) <span class="im">as</span> file_in:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> file_in.readlines()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>['do\n', 're\n', 'mi\n', 'fa\n', 'sol\n', 'la\n', 'si']</code></pre>
</div>
</div>
<p>Notons que chaque Ã©lÃ©ment de la liste (sauf le dernier) se termine par le caractÃ¨re spÃ©cial <code>\n</code> (â€œretour Ã  la ligneâ€) qui marque simplement la fin de chaque ligne dans un fichier texte. Câ€™est la prÃ©sence (cachÃ©e) de ce mÃªme caractÃ¨re Ã  la fin de chaque appel Ã  la fonction <code>print</code> qui fait que lâ€™on revient Ã  la ligne Ã  chaque fois que lâ€™on utilise un <code>print</code>.</p>
</section>
<section id="Ã©crire-dans-un-fichier" class="level3">
<h3 class="anchored" data-anchor-id="Ã©crire-dans-un-fichier">Ã‰crire dans un fichier</h3>
<p>Lâ€™Ã©criture dans un fichier est trÃ¨s simple, elle sâ€™effectue Ã  lâ€™aide de la mÃ©thode <code>write</code>. Par exemple, Ã©crivons dans un fichier ligne Ã  ligne les diffÃ©rents Ã©lÃ©ments contenus dans une liste.</p>
<div id="3fedfed9" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ex <span class="op">=</span> [<span class="st">"ceci"</span>, <span class="st">"est"</span>, <span class="st">"un"</span>, <span class="st">"exemple"</span>, <span class="st">"trÃ¨s"</span>, <span class="st">"original"</span>]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"test.txt"</span>, <span class="st">"w"</span>) <span class="im">as</span> file_out:</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> elem <span class="kw">in</span> ex:</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        file_out.write(elem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tout semble sâ€™Ãªtre passÃ© sans encombre. On peut vÃ©rifier que notre fichier a bien Ã©tÃ© crÃ©e via lâ€™explorateur de fichier de <code>Jupyter</code> (sur la gauche) ou bien via la commande <code>ls</code> dans le terminal.</p>
<div id="97e21a77" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gamme.txt     notes.txt    solutions.py  tutorial.ipynb  write_list.py
normalisation.py  notes_clean.txt  test.txt  tutorial.qmd</code></pre>
</div>
</div>
<p>Il est bien lÃ . VÃ©rifions maintenant que son contenu est bien celui que lâ€™on souhaitait.</p>
<div id="ae0e03bf" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"test.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> file_out:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(file_out.read())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ceciestunexempletrÃ¨soriginal</code></pre>
</div>
</div>
<p>Les diffÃ©rents Ã©lÃ©ments de notre liste se sont fusionnÃ©s en un seul bloc de texte ! Câ€™est parce que, contrairement Ã  la fonction <code>print</code> par exemple, la fonction <code>write</code> nâ€™ajoute pas automatiquement le caractÃ¨re de retour Ã  la ligne. Il faut lâ€™ajouter manuellement.</p>
<div id="240a0fbd" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"test.txt"</span>, <span class="st">"w"</span>) <span class="im">as</span> file_out:</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> elem <span class="kw">in</span> ex:</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>        file_out.write(elem <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"test.txt"</span>, <span class="st">"r"</span>) <span class="im">as</span> file_out:</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(file_out.read())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ceci
est
un
exemple
trÃ¨s
original
</code></pre>
</div>
</div>
<p>Câ€™est beaucoup mieux.</p>
<p>Quelques remarques supplÃ©mentaires sur lâ€™Ã©criture de fichiers :</p>
<ul>
<li><p>mieux vaut le rÃ©pÃ©ter : <strong>utiliser le mode dâ€™ouverture <code>\w</code> pour un fichier Ã©crase complÃ¨tement son contenu</strong>. Lorsquâ€™on a rÃ©Ã©crit notre fichier avec les sauts de ligne, on a complÃ¨tement Ã©crasÃ© lâ€™ancien.</p></li>
<li><p>pourquoi a-t-on pu mettre juste le nom du fichier dans la fonction <code>open</code> et pas un objet <code>Path</code> comprenant le chemin complet vers le fichier que lâ€™on souhaitait crÃ©er ? Câ€™est parce que <code>Python</code> lâ€™a automatiquement interprÃ©tÃ© comme un <strong>chemin relatif</strong> (Ã  notre rÃ©pertoire courant) du fait de lâ€™absence de racine.</p></li>
<li><p>on ne peut Ã©crire dans un fichier <strong>que des Ã©lÃ©ments de type <code>str</code></strong> (chaÃ®ne de caractÃ¨re). Si un des Ã©lÃ©ments de la liste ci-dessus avait Ã©tÃ© de type <code>int</code> ou <code>float</code> par exemple, il aurait fallu le convertir via la fonction <code>str()</code> avant de lâ€™Ã©crire dans le fichier. Sinon, <code>Python</code> aurait renvoyÃ© une erreur.</p></li>
</ul>
</section>
</section>
<section id="exÃ©cuter-du-code-depuis-des-fichiers-.py" class="level2">
<h2 class="anchored" data-anchor-id="exÃ©cuter-du-code-depuis-des-fichiers-.py">ExÃ©cuter du code depuis des fichiers <code>.py</code></h2>
<p>Jusquâ€™Ã  prÃ©sent dans ce tutoriel, nous avons explorÃ© lâ€™utilisation de packages/modules, quâ€™ils proviennent de la bibliothÃ¨que standard de Python ou soient dÃ©veloppÃ©s par des tiers. Nous avons Ã©galement abordÃ© lâ€™interaction avec le systÃ¨me de fichiers local. Ã€ prÃ©sent, dÃ©couvrons comment combiner ces compÃ©tences en Ã©crivant et exÃ©cutant nos propres scripts et modules Python sous forme de fichiers <code>.py</code>.</p>
<section id="les-scripts-python" class="level3">
<h3 class="anchored" data-anchor-id="les-scripts-python">Les scripts <code>Python</code></h3>
<p>Dans un environnement de notebook <code>Jupyter</code> (comme celui dans lequel vous vous trouvez), le code <code>Python</code> est exÃ©cutÃ© de maniÃ¨re <strong>interactive</strong>, cellule par cellule. Cela est possible car un <em>kernel</em> (noyau) <code>Python</code> tourne en arriÃ¨re-plan pendant tout le long de la session dâ€™utilisation du notebook. Cependant, en dehors de <code>Jupyter</code>, le code est gÃ©nÃ©ralement Ã©crit et exÃ©cutÃ© sous forme de scripts. Un script <code>Python</code> est simplement un fichier texte portant lâ€™extension <code>.py</code> et qui contient une sÃ©rie dâ€™instructions <code>Python</code> qui vont Ãªtre exÃ©cutÃ©es linÃ©airement par lâ€™interprÃ©teur <code>Python</code>.</p>
<p>Le fichier <code>write_list.py</code> reprend une cellule de code vue prÃ©cÃ©demment. Affichons son contenu.</p>
<div id="9bc530bf" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'write_list.py'</span>, <span class="st">'r'</span>) <span class="im">as</span> script:</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(script.read())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ex = ["ceci", "est", "un", "exemple", "trÃ¨s", "original"]

with open("output_script.txt", "w") as file_out:
    for elem in ex:
        file_out.write(elem)

print("SuccÃ¨s !")
</code></pre>
</div>
</div>
<p>Un script <code>Python</code> sâ€™exÃ©cute dans un terminal via la commande <code>python nom_du_script.py</code>. Pour lâ€™exÃ©cuter depuis un notebook <code>Jupyter</code>, on rajoute lÃ  encore un <code>!</code> en dÃ©but de ligne.</p>
<div id="084deeb1" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python write_list.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SuccÃ¨s !</code></pre>
</div>
</div>
<p>Le fichier <code>output_script.txt</code> a bien Ã©tÃ© crÃ©Ã© en local (il faut parfois attendre un peu ou actualiser pour quâ€™il sâ€™affiche) et le message attendu a Ã©tÃ© imprimÃ© dans la sortie de la console.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Notebook vs. scripts">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notebook vs.&nbsp;scripts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Faut-il prÃ©fÃ©rer lâ€™utilisation de notebooks <code>Jupyter</code>, comme dans le cadre de cette formation, ou bien prÃ©fÃ©rer lâ€™exÃ©cution via des scripts ? Il nâ€™y a pas de rÃ©ponse dÃ©finitive Ã  cette question :</p>
<ul>
<li><p>les notebooks permettent une exÃ©cution <strong>interactive</strong>, trÃ¨s pratique pour lâ€™expÃ©rimentation ;</p></li>
<li><p>les scripts rendent plus facile lâ€™automatisation dâ€™une procÃ©dure, dans la mesure oÃ¹ ils sont exÃ©cutÃ©s linÃ©airement et sans requÃ©rir dâ€™actions intermÃ©diaires de la part de lâ€™utilisateur.</p></li>
</ul>
<p>En somme, les notebooks sont trÃ¨s utiles durant la phase de dÃ©veloppement, mais on prÃ©fÃ¨rera les script dÃ¨s lors quâ€™il est question dâ€™automatiser des traitements ou de produire du code visant Ã  tourner en production.</p>
</div>
</div>
</section>
<section id="scripts-et-modules" class="level3">
<h3 class="anchored" data-anchor-id="scripts-et-modules">Scripts et modules</h3>
<p>Comme nous lâ€™avons vu, un <strong>script</strong> est un fichier <code>.py</code> destinÃ© Ã  Ãªtre exÃ©cutÃ© directement. Il contient gÃ©nÃ©ralement un flux de travail complet ou une tÃ¢che automatisÃ©e. Un <strong>module</strong> est Ã©galement un fichier <code>.py</code>, mais qui contient des dÃ©finitions de fonctions et/ou de classes destinÃ©es Ã  Ãªtre utilisÃ©es par dâ€™autres scripts ou modules. Il nâ€™est pas destinÃ© Ã  Ãªtre exÃ©cutÃ© seul mais importÃ© ailleurs. Au dÃ©but de ce tutoriel, nous avons utilisÃ© des modules issus de packages Ã©crits par dâ€™autres. Voyons maintenant comment lâ€™on peut Ã©crire nos propres modules et les importer selon les mÃªmes principes.</p>
<p>Affichons le contenu du fichier <code>normalisation.py</code> qui nous servira dâ€™exemple.</p>
<div id="57c829eb" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'normalisation.py'</span>, <span class="st">'r'</span>) <span class="im">as</span> module:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(module.read())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>import numpy as np


def normalise(x):
    """Normalise un vecteur de valeurs Ã  une moyenne de 0 et un Ã©cart-type de 1."""
    return (x - np.mean(x)) / np.std(x)


if __name__ == "__main__":
    vec = [2, 4, 6, 8, 10]
    vec_norm = normalise(vec)
    print(np.mean(vec), np.var(vec), np.mean(vec_norm), np.var(vec_norm))
</code></pre>
</div>
</div>
<p>La fonction contenue dans ce module peut Ãªtre importÃ©e comme nous lâ€™avons vu dans ce tutoriel. Notons que le module doit lui mÃªme importer les packages/modules nÃ©cessaires au bon fonctionnement des fonctions quâ€™il contient (en lâ€™occurence, <code>numpy</code>).</p>
<p>Pour importer un module local, on utilise lâ€™instruction <code>from</code> suivie du nom du fichier, sans lâ€™extension.</p>
<div id="e079e5ff" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> normalisation</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>x_norm <span class="op">=</span> normalisation.normalise(x)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_norm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-1.41421356 -0.70710678  0.          0.70710678  1.41421356]</code></pre>
</div>
</div>
<p>Enfin, notons quâ€™un fichier <code>.py</code> peut Ã  la fois servir comme module et comme script. Pour diffÃ©rencier les deux usages, on utilise la variable <code>__name__</code>, qui est dÃ©finie par dÃ©faut par <code>Python</code> dÃ¨s lors que lâ€™on utilise un fichier <code>.py</code> :</p>
<ul>
<li><p>si le fichier est utilisÃ© comme un <strong>module</strong> (ex : <code>import mon_fichier</code>), la variable <code>__name__</code> vaut le nom du fichier (ex : <code>mon_fichier</code>)</p></li>
<li><p>si le fichier est utilisÃ© comme un <strong>script</strong> (ex : <code>python mon_fichier.py</code>), la variable <code>__name__</code> vaut <code>__main__</code></p></li>
</ul>
<p>Dans la cellule prÃ©cÃ©dente, le fichier <code>normalisation.py</code> Ã©tait importÃ© comme un module. Dans ce cas, la variable <code>__name__</code> vaut <code>normalisation</code> et câ€™est pourquoi le code sous la condition <code>if</code> nâ€™a pas Ã©tÃ© exÃ©cutÃ©. Lorsque le fichier est exÃ©cutÃ© comme script, ce code est exÃ©cutÃ©.</p>
<div id="c3e7b6ae" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>python normalisation.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.0 8.0 0.0 0.9999999999999998</code></pre>
</div>
</div>
<p>Il est dont trÃ¨s frÃ©quent de croiser la condition <code>if __name__ == "__main__"</code> dans les scripts <code>Python</code>, qui distingue lâ€™usage comme module et lâ€™usage comme script.</p>
</section>
</section>
<section id="exercices" class="level2">
<h2 class="anchored" data-anchor-id="exercices">Exercices</h2>
<section id="questions-de-comprÃ©hension" class="level3">
<h3 class="anchored" data-anchor-id="questions-de-comprÃ©hension">Questions de comprÃ©hension</h3>
<ul>
<li><p>1/ Quâ€™est-ce quâ€™un module ?</p></li>
<li><p>2/ Quâ€™est ce quâ€™un package ?</p></li>
<li><p>3/ Pourquoi nâ€™est-ce pas une bonne pratique dâ€™importer toutes les fonctions dâ€™un module avec la syntaxe <code>from module import *</code></p></li>
<li><p>4/ Quels sont les avantages de la librairie <code>pathlib</code> ?</p></li>
<li><p>5/ Quelles sont les deux propriÃ©tÃ©s dâ€™un fichier qui permettent de repÃ©rer sa position dans le systÃ¨me de fichiers ?</p></li>
<li><p>6/ Quâ€™est-ce que le rÃ©pertoire courant ?</p></li>
<li><p>7/ Quelles sont les deux maniÃ¨res de spÃ©cifier un chemin ? Comment <code>Python</code> fait-il la diffÃ©rence entre les deux ?</p></li>
<li><p>8/ Quels sont les deux grandes familles de fichiers que lâ€™on est amenÃ©s Ã  manipuler en programmation ?</p></li>
<li><p>9/ Quels sont les diffÃ©rents modes dâ€™ouverture dâ€™un fichier ?</p></li>
<li><p>10/ Pourquoi est-il prÃ©fÃ©rable dâ€™utiliser la syntaxe <code>with open(...) as ...</code> pour ouvrir un fichier ?</p></li>
<li><p>11/ Pourquoi peut-on parcourir les lignes dâ€™un fichier Ã  lâ€™aide dâ€™une boucle ?</p></li>
<li><p>12/ Quelle est la diffÃ©rence entre un module et un script ?</p></li>
</ul>
</section>
<section id="moyenne-et-Ã©cart-type-des-notes-obtenues-Ã -un-examen" class="level3">
<h3 class="anchored" data-anchor-id="moyenne-et-Ã©cart-type-des-notes-obtenues-Ã -un-examen">Moyenne et Ã©cart-type des notes obtenues Ã  un examen</h3>
<p><em>Exercice inspirÃ© de : <a href="https://python.sdv.univ-paris-diderot.fr/07_fichiers/">python.sdv.univ-paris-diderot.fr</a></em></p>
<p>Le fichier texte <code>notes.txt</code> se trouve dans votre rÃ©pertoire courant. Il contient les notes obtenues par 50 Ã©lÃ¨ves Ã  un examen. ProblÃ¨me : toutes les notes ont Ã©tÃ© Ã©crites sur une mÃªme ligne, avec un espace Ã  chaque fois. Ouvrez ce fichier et calculez la moyenne et lâ€™Ã©cart-type des notes.</p>
<p>Indices :</p>
<ul>
<li><p>les chaÃ®nes de caractÃ¨re ont une mÃ©thode <code>split</code> qui permet de sÃ©parer du texte selon un caractÃ¨re donnÃ©</p></li>
<li><p>il faudra convertir les notes au format numÃ©rique pour pouvoir leur appliquer des fonctions mathÃ©matiques</p></li>
<li><p>vous pouvez utiliser les fonctions du package <code>numpy</code> pour calculer les statistiques demandÃ©es</p></li>
</ul>
</section>
<section id="admis-ou-recalÃ©" class="level3">
<h3 class="anchored" data-anchor-id="admis-ou-recalÃ©">Admis ou recalÃ©</h3>
<p><em>Exercice inspirÃ© de : <a href="https://python.sdv.univ-paris-diderot.fr/07_fichiers/">python.sdv.univ-paris-diderot.fr</a></em></p>
<p>Le fichier texte <code>notes_clean.txt</code> se trouve dans votre rÃ©pertoire courant. Il contient les notes obtenues par 50 Ã©lÃ¨ves Ã  un examen. Contrairement Ã  lâ€™exercice prÃ©cÃ©dent, les notes sont cette fois bien Ã©crites : une note par ligne.</p>
<p>Ã‰crire un code qui :</p>
<ul>
<li><p>stocke chaque note au format <code>int</code> dans une liste</p></li>
<li><p>rÃ©Ã©crit les notes dans un fichier <code>notes_mentions.txt</code> avec sur chaque ligne la note, suivie dâ€™un espace, suivi de la mention â€œadmisâ€ si la note est supÃ©rieure ou Ã©gale Ã  10, et â€œrecalÃ©â€ sinon.</p></li>
</ul>
<p>Par exemple, les trois premiÃ¨res lignes de ce nouveau fichier devraient Ãªtre :</p>
<pre><code>5 recalÃ©
5 recalÃ©
18 admis</code></pre>
</section>
<section id="retardataires" class="level3">
<h3 class="anchored" data-anchor-id="retardataires">Retardataires</h3>
<p>3 Ã©lÃ¨ves nâ€™avaient pas rendu leur copie dans les temps pour lâ€™examen :</p>
<ul>
<li><p>Miranda a obtenu 16 et a rendu son devoir avec 3 jours de retard</p></li>
<li><p>Paolo a obtenu 11 et a rendu son devoir avec 1 jour de retard</p></li>
<li><p>Isidore a obtenu 3 et a rendu son devoir avec 5 jours de retard.</p></li>
</ul>
<p>Chaque Ã©lÃ¨ve aura une note finale Ã©gale Ã  la note obtenue moins le nombre de jours de retard. Une note ne pouvant Ãªtre nÃ©gative, elle sera remplacÃ©e par 0.</p>
<p>Les informations nÃ©cessaires ont Ã©tÃ© placÃ©es dans une liste dans la cellule suivante. A lâ€™aide dâ€™une boucle sur cette liste, <strong>ajouter</strong> (sans rÃ©Ã©crire complÃ¨tement le fichier !). les notes au fichier <code>notes_clean.txt</code> (sans la mention).</p>
<p>NB : si vous avez Ã©crasÃ© le contenu dâ€™un fichier par erreur, vous pouvez retrouver les fichiers propres sur le <a href="https://github.com/InseeFrLab/formation-python-initiation/tree/main/source/manipulation/modules-files">dÃ©pÃ´t GitHub associÃ© Ã  la formation</a>.</p>
<div id="43cc0462" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>supp <span class="op">=</span> [(<span class="dv">16</span>, <span class="dv">3</span>), (<span class="dv">11</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scanner-des-fichiers" class="level3">
<h3 class="anchored" data-anchor-id="scanner-des-fichiers">Scanner des fichiers</h3>
<p>Ã‰crire un programme qui rÃ©alise les opÃ©rations suivantes :</p>
<ul>
<li><p>dans le rÃ©pertoire courant, lister les chemins des fichiers dont lâ€™extension est <code>.txt</code> (la syntaxe a Ã©tÃ© vue dans la partie sur <code>pathlib</code>)</p></li>
<li><p>faire une boucle qui parcourt ces chemins et ouvre chaque fichier sÃ©quentiellement</p></li>
<li><p>pour chaque fichier, faire un test dâ€™appartenance (rappel de la syntaxe : <code>if pattern in string: ...</code>) pour tester si le fichier contient le mot â€œsolâ€. Si câ€™est le cas, imprimer son chemin absolu dans la console (seul le chemin du fichier <code>gamme.txt</code> devrait donc apparaÃ®tre)</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>